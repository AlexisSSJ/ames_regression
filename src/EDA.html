<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Uriel Alexis Luna López">

<title>EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="EDA_files/libs/clipboard/clipboard.min.js"></script>
<script src="EDA_files/libs/quarto-html/quarto.js"></script>
<script src="EDA_files/libs/quarto-html/popper.min.js"></script>
<script src="EDA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EDA_files/libs/quarto-html/anchor.min.js"></script>
<link href="EDA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EDA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EDA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EDA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EDA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EDA</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Uriel Alexis Luna López </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="analisís-de-las-variables" class="level1">
<h1>Analisís de las variables</h1>
<section id="descripción-de-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="descripción-de-las-variables">Descripción de las variables</h2>
<section id="variables-continuas-y-númericas" class="level3">
<h3 class="anchored" data-anchor-id="variables-continuas-y-númericas">Variables continuas y númericas</h3>
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 69%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th style="text-align: left;">Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lot_Frontage (Continua)</td>
<td style="text-align: left;">Loguitud que conectan la calle con la propiedad (en pies)</td>
</tr>
<tr class="even">
<td>Lot Area (Continua)</td>
<td style="text-align: left;">Tamaño del lote en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Mas Vnr Area (Continua)</td>
<td style="text-align: left;">Área de revestimiento de mampostería en pies cuadrados</td>
</tr>
<tr class="even">
<td>BsmtFin SF 1 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 1 en pies cuadrados</td>
</tr>
<tr class="odd">
<td>BsmtFin SF 2 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 2 en pies cuadrados</td>
</tr>
<tr class="even">
<td>Bsmt Unf SF (Continua)</td>
<td style="text-align: left;">Área sin terminar del sótano en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Total Bsmt SF (Continua)</td>
<td style="text-align: left;">Área total del sótano</td>
</tr>
<tr class="even">
<td>1st Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrqados del primer piso</td>
</tr>
<tr class="odd">
<td>2nd Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados del segundo piso</td>
</tr>
<tr class="even">
<td>Low Qual Area SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados terminados de baja calidad</td>
</tr>
<tr class="odd">
<td>Gr Liv Area (Continua)</td>
<td style="text-align: left;">Superficie habitable sobre el nivel del suelo en pies cuadrados</td>
</tr>
<tr class="even">
<td>Wood Deck SF (Continua)</td>
<td style="text-align: left;">Área de cubierta de madera en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Open Porch SF (Continua)</td>
<td style="text-align: left;">Área abierta del porche en pies cuadrados</td>
</tr>
<tr class="even">
<td>Enclose Porch (Continua)</td>
<td style="text-align: left;">Área cerrada del proche en pies cuadrados</td>
</tr>
<tr class="odd">
<td>3-Ssn Porch (Continua)</td>
<td style="text-align: left;">Área de porche de tres estaciones en pies cuadrados</td>
</tr>
<tr class="even">
<td>Screen Porch (Continua)</td>
<td style="text-align: left;">Área del porche cubierto en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Pool Area (Continua)</td>
<td style="text-align: left;">Área de la piscina en pies cuadrados</td>
</tr>
<tr class="even">
<td>Misc Val (Continua)</td>
<td style="text-align: left;">Valor de la característica miscelanea</td>
</tr>
<tr class="odd">
<td><strong>Sale_Price (Continua)</strong></td>
<td style="text-align: left;">Precio de venta.</td>
</tr>
<tr class="even">
<td>Year Built (Discreta)</td>
<td style="text-align: left;">Año original de construcción</td>
</tr>
<tr class="odd">
<td>Year Remod/Add (Discreta)</td>
<td style="text-align: left;">Fecha de remodelación (la misma que la fecha de construcción si no se ha remodelado)</td>
</tr>
<tr class="even">
<td>Bsmt Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos en el sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños en el sótano</td>
</tr>
<tr class="even">
<td>Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños sobre el nivel del suelo</td>
</tr>
<tr class="even">
<td>Kitchen (Discreta)</td>
<td style="text-align: left;">Concinas sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>TotRmsAbvGrd</td>
<td style="text-align: left;">Total de habitaciones sobre el nivel del suelo (no incluye baños)</td>
</tr>
<tr class="even">
<td>Fireplaces (Discreta)</td>
<td style="text-align: left;">Número de chimeneas</td>
</tr>
<tr class="odd">
<td>Garage Yr Blt (Discreta)</td>
<td style="text-align: left;">Año en que se construyó el garage</td>
</tr>
<tr class="even">
<td>Garage Cars (Discreta)</td>
<td style="text-align: left;">Tamaño del garage en cuanto a capacidad para autos.</td>
</tr>
<tr class="odd">
<td>Mo Sold (Discreta)</td>
<td style="text-align: left;">Mes de la venta (MM)</td>
</tr>
<tr class="even">
<td>Yr Sold (Discreta)</td>
<td style="text-align: left;">Año de la venta (YYYY)</td>
</tr>
</tbody>
</table>
</section>
<section id="varaibles-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="varaibles-categóricas">Varaibles categóricas</h3>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MS_Subclass (Nominal)</td>
<td>Identifica el tipo de vivienda de la venta</td>
</tr>
<tr class="even">
<td>MS_Zoning (Nominal)</td>
<td>Identifica la clasificación de la zona asociada a la venta</td>
</tr>
<tr class="odd">
<td>Street (Nominal)</td>
<td>Tipo de camino de acceso a la propiedad</td>
</tr>
<tr class="even">
<td>Alley (Nominal)</td>
<td>Tipo de callejón de acceso a la propiedad</td>
</tr>
<tr class="odd">
<td>Lot Contour (Nominal)</td>
<td>Planitud de la propiedad</td>
</tr>
<tr class="even">
<td>Lot Config (Nominal)</td>
<td>Configurarición del lote</td>
</tr>
<tr class="odd">
<td>Neightboorhood (Nominal)</td>
<td>Ubicación física dentro de los límites de la ciudad de Ames</td>
</tr>
<tr class="even">
<td>Condition 1 (Nominal)</td>
<td>Proximidad a varias condiciones</td>
</tr>
<tr class="odd">
<td>Condition 2 (Nominal)</td>
<td>Proximidad a varias condiciones (Si más de una es presente)</td>
</tr>
<tr class="even">
<td>Bldg Type (Nominal)</td>
<td>Tipo de vivienda</td>
</tr>
<tr class="odd">
<td>House Style (Nominal)</td>
<td>Estilo de la vivienda</td>
</tr>
<tr class="even">
<td>Roof Style (Nominal)</td>
<td>Tipo de techo</td>
</tr>
<tr class="odd">
<td>Roof Matl (Nominal)</td>
<td>Material del techo</td>
</tr>
<tr class="even">
<td>Exterior 1 (Nominal)</td>
<td>Revestimiento exterior de la casa</td>
</tr>
<tr class="odd">
<td>Exterior 2 (Nominal)</td>
<td>Revestimiento exterior de la casa (Si hay más de un material)</td>
</tr>
<tr class="even">
<td>Mas Vnr Type (Nominal)</td>
<td>Tipo de revestimiento de mampostería</td>
</tr>
<tr class="odd">
<td>Foundation (Nominal)</td>
<td>Tipo de cimentación</td>
</tr>
<tr class="even">
<td>Heating (Nominal)</td>
<td>Tipo de calefacción</td>
</tr>
<tr class="odd">
<td>Central Air (Nominal)</td>
<td>Aire acondicionado centralizado</td>
</tr>
<tr class="even">
<td>Garage Type (Nominal)</td>
<td>Ubicación del garage</td>
</tr>
<tr class="odd">
<td>Misc Feature (Nominal)</td>
<td>Característica miscelánea no cubierta en otras categorías</td>
</tr>
<tr class="even">
<td>Sale Type (Nominal)</td>
<td>Tipo de venta</td>
</tr>
<tr class="odd">
<td>Sale Condition (Nominal)</td>
<td>Condicón de la venta.</td>
</tr>
<tr class="even">
<td>Functional (Ordinal)</td>
<td>Funcionalidad del hogar (suponga que es típico a menos que se justifiquen deducciones)</td>
</tr>
<tr class="odd">
<td>FireplaceQu (Ordinal)</td>
<td>Calidad de las chimeneas</td>
</tr>
<tr class="even">
<td>Lot Shape (Ordinal)</td>
<td>Forma general de la propiedad</td>
</tr>
<tr class="odd">
<td>Pool QC (Ordinal)</td>
<td>Calidad de la piscina</td>
</tr>
<tr class="even">
<td>Utilities (Ordinal)</td>
<td>Tipo de utilidades disponibles</td>
</tr>
<tr class="odd">
<td>Land Slope (Ordinal)</td>
<td>Pendiente de la propiedad</td>
</tr>
<tr class="even">
<td>Overall Qual (Ordinal)</td>
<td>Califica el material general y el acabado de la casa.</td>
</tr>
<tr class="odd">
<td>Overall Cond (Ordinal)</td>
<td>Califica la condición general de la casa</td>
</tr>
<tr class="even">
<td>Exter Qual (Ordinal)</td>
<td>Evalua la calidad materiales de los exteriores</td>
</tr>
<tr class="odd">
<td>Exter Cond (Ordinal)</td>
<td>Evalua la condición presente del materia en el exterior</td>
</tr>
<tr class="even">
<td>Bsmt Qua (Ordinal)</td>
<td>Evalua la altura del sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Cond (Ordinal)</td>
<td>Evalua la condición general del sótano</td>
</tr>
<tr class="even">
<td>Bsmt Exposure (Ordinal)</td>
<td>Se refiere a paredes a nivel de jardín o de salida</td>
</tr>
<tr class="odd">
<td>BsmtFin Type 1 (Ordinal)</td>
<td>Calificación del area terminada del sótano</td>
</tr>
<tr class="even">
<td>BsmtFin Type 2 (Ordinal)</td>
<td>Clasificación del área terminada del sótano (si hay varios tipos)</td>
</tr>
<tr class="odd">
<td>Heating QC (Ordinal)</td>
<td>Calidad y condición de la calefacción</td>
</tr>
<tr class="even">
<td>Electrical (Ordinal)</td>
<td>Sistema electrico</td>
</tr>
<tr class="odd">
<td>Kitchen Qaul (Ordinal)</td>
<td>Calidad de la cocina</td>
</tr>
<tr class="even">
<td>Garage Qual (Ordinal)</td>
<td>Calidad del Garage</td>
</tr>
<tr class="odd">
<td>Garage cond (Ordinal)</td>
<td>Condicón del garage</td>
</tr>
<tr class="even">
<td>Paved Drive (Ordinal)</td>
<td>Camino pavimentado.</td>
</tr>
<tr class="odd">
<td>Garage Finish (Ordnal)</td>
<td>El interior del garage esta terminado</td>
</tr>
<tr class="even">
<td>Fence (Ordinal)</td>
<td>Calidad de la cerca.</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">py_run_file</span>(<span class="st">'Custom_functions_ ames.py'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analísis-de-sale-price" class="level2">
<h2 class="anchored" data-anchor-id="analísis-de-sale-price">Analísis de Sale Price</h2>
<p>A continuación se muestra el split inicial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.one_table_verbs <span class="im">import</span> pull</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mizani.formatters <span class="im">import</span> comma_format, dollar_format</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>ames <span class="op">=</span> pd.read_csv(<span class="st">"../data/ames.csv"</span>) <span class="op">&gt;&gt;</span> mutate (Price_4_GLA<span class="op">=</span> _.Sale_Price<span class="op">/</span>_.Gr_Liv_Area)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ames <span class="op">&gt;&gt;</span>  pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> select(ames, <span class="op">-</span>_.Sale_Price, <span class="op">-</span>_.Price_4_GLA)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>(X <span class="op">&gt;&gt;</span> mutate(wood_prop<span class="op">=</span> _.Wood_Deck_SF<span class="op">/</span>_.Gr_Liv_Area,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>              area_per_car<span class="op">=</span>case_when({</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                              _.Garage_Cars <span class="op">==</span> <span class="dv">0</span>:<span class="dv">0</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                              <span class="va">True</span>:_.Garage_Area<span class="op">/</span> _.Garage_Cars}),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>              last_remod <span class="op">=</span> case_when({</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                              _.Year_Built<span class="op">&gt;</span>_.Year_Remod_Add: <span class="dv">2023</span><span class="op">-</span>_.Year_Remod_Add,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                              <span class="va">True</span>: <span class="dv">2023</span><span class="op">-</span>_.Year_Built}),</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>              Mo_Sold<span class="op">=</span> _.Mo_Sold.astype(<span class="st">'object'</span>)))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>numeric_column <span class="op">=</span> ames <span class="op">&gt;&gt;</span> pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>quartiles <span class="op">=</span> np.percentile(numeric_column, [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>])</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una nueva variable categórica basada en los cuartiles</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a> numeric_column, </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>ames_x_train, ames_x, ames_y_train, ames_y <span class="op">=</span> train_test_split(</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                       X, y, </span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                       test_size <span class="op">=</span> <span class="fl">0.30</span>, </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a> ames_y , </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>ames_x_test, ames_x_val, ames_y_test, ames_y_val <span class="op">=</span> train_test_split(</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>       ames_x, ames_y, </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>       test_size <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>Sale_Price_train <span class="op">=</span> ames_y_train <span class="op">*</span> ames_x_train.Gr_Liv_Area</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>Sale_Price_test <span class="op">=</span> ames_y_test <span class="op">*</span> ames_x_test.Gr_Liv_Area</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>Sale_Price_validation <span class="op">=</span> ames_y_val <span class="op">*</span> ames_x_val.Gr_Liv_Area</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Totales:</span><span class="ch">\t</span><span class="st">'</span>, ames.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Training:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_train.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Testing:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_test.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Validation:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_val.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Totales:     2930 
Training:    2051 
Testing:     586 
Validation:  293</code></pre>
</div>
</div>
<p>Cómo se observa, la distribución de los precios de venta se encuentra sesgada a la derecha, tienendo el 75% de las casas vendidas a un precio menor a $212,075 y aclumulando un la mitad de estos entre $129K y 212K. También en el siguiente qqplot podemos ver que la distribución de los precios de venta no parece seguir una distribución normal.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure()</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>Sale_Price_train, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                annotate(<span class="st">'text'</span>,x<span class="op">=</span><span class="fl">0.3</span>,y<span class="op">=</span><span class="dv">500000</span>, label<span class="op">=</span>summary,ymax<span class="op">=</span><span class="dv">400000</span>)<span class="op">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_dist-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qqplot_Sale_Price-3.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>A diferencia de la distribución de los precios se venta de la casa, el precio por pie cuadrado habitable de la casa parece tener un comportamiento más normal:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> <span class="st">"count: 2344</span><span class="ch">\n</span><span class="st">mean: $180,996.79</span><span class="ch">\n</span><span class="st">std: $81,186.69</span><span class="ch">\n</span><span class="st">Q1: $129,500</span><span class="ch">\n</span><span class="st">Q2:$160,000</span><span class="ch">\n</span><span class="st">Q3: $213,492.50</span><span class="ch">\n</span><span class="st">min: $12,789</span><span class="ch">\n</span><span class="st">max:$755,000"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                <span class="co"># annotate('text',x=0.3,y=500000, label=summary,ymax=400000)+</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_GLA_DIST-5.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>params<span class="op">=</span>{<span class="st">'loc'</span>:ames_y_train.mean(), <span class="st">'scale'</span>:ames_y_train.std()}</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                ggplot(aes(sample<span class="op">=</span>ames_y_train))<span class="op">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>,distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params)<span class="op">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                stat_qq_line(distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params,color <span class="op">=</span> <span class="st">"red"</span>)<span class="op">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                xlab(<span class="st">"Cuantilies de la dist. normal teórica"</span>) <span class="op">+</span> ylab(<span class="st">"Cuantiles de Sale Price"</span>) <span class="op">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">"QQ-Plot N~(mean=180,996.79, sd=81,186.69)"</span>)<span class="op">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                theme_seaborn()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qq%20plot%20new%20y-7.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-continuas-vs-transformación-de-sale_price" class="level2">
<h2 class="anchored" data-anchor-id="variables-continuas-vs-transformación-de-sale_price">Variables Continuas VS Transformación de Sale_Price</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ames_train <span class="op">=</span> ames_x_train.copy()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ames_train[<span class="st">'Sale_Price/Gr_Liv_Area'</span>] <span class="op">=</span> ames_y_train</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>correlation_data <span class="op">=</span> (</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().melt(  ignore_index<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                        var_name<span class="op">=</span><span class="st">'var1'</span>).reset_index() <span class="op">&gt;&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                    select( _.var1,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                            _.var2 <span class="op">==</span> _.index,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                            _.cor <span class="op">==</span> _.value  ) </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>labels<span class="op">=</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span> case_when({_.cor.between(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>):<span class="st">''</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                                    _.cor<span class="op">&gt;</span><span class="fl">0.99991</span>: <span class="st">''</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="va">True</span> :_.cor.<span class="bu">round</span>(<span class="dv">2</span>).astype(<span class="bu">str</span>)})</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        arrange(<span class="op">-</span>_.cor,_.var1) <span class="op">&gt;&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter (_.var1!=_.var2) &gt;&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        mutate(labb<span class="op">=</span>labels)<span class="op">&gt;&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        ggplot(aes(x<span class="op">=</span><span class="st">'var1'</span>, y<span class="op">=</span><span class="st">'var2'</span>, fill<span class="op">=</span> <span class="st">'cor'</span>))<span class="op">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        geom_tile()<span class="op">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        geom_label(aes(label<span class="op">=</span><span class="st">'labb'</span>), size<span class="op">=</span><span class="dv">6</span>)<span class="op">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        scale_fill_gradientn(colors<span class="op">=</span>[<span class="st">'#0092ff'</span>,<span class="st">'#e6d6c7'</span>,<span class="st">'#FF1400'</span>],</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                            limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                            name<span class="op">=</span><span class="st">'Correlación'</span>)<span class="op">+</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        ggtitle(<span class="st">'Mapa de calor de correlaciones para variables continuas'</span>)<span class="op">+</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        xlab(<span class="st">''</span>)<span class="op">+</span>ylab(<span class="st">''</span>)<span class="op">+</span><span class="co">#guides(fill=guide_legend(title="New Legend Title"))+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        theme(axis_text_x<span class="op">=</span>element_text(rotation<span class="op">=</span><span class="dv">90</span>,hjust <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                figure_size<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_heatmap_HCC-9.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Como podemos observar para ser que las varaibles de <code>'BsmtFin_SF_1', 'First_Flr_SF', 'Second_Flr_SF', 'Total_Bsmt_SF'</code> son las que tienen correlaciones más grandes con el precio de venta por el precio por pie cuadrado habitable. En el gráfico sólo se muestran etiquetas de correlaciones que no estan en el intervalo (-0.3.0.3).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().reset_index(drop<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> select(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>],_.index)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>] <span class="op">!=</span> <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> mutate (labels <span class="op">=</span> np.<span class="bu">round</span>(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>], <span class="dv">3</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> arrange(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>, x<span class="op">=</span><span class="st">'index'</span>, fill<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_col()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(aes(label <span class="op">=</span> <span class="st">'labels'</span>) , size<span class="op">=</span><span class="dv">8</span>, va<span class="op">=</span><span class="st">'center'</span>, angle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> ylim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>])</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area vs otras variables'</span>, y<span class="op">=</span><span class="st">''</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_fill_gradient2(low<span class="op">=</span><span class="st">'#4EB043'</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                           mid<span class="op">=</span><span class="st">'#B05F43'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                           high<span class="op">=</span> <span class="st">'#3A3AD5'</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                           midpoint<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                           limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                           name<span class="op">=</span><span class="st">'Correlación'</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme_bw()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_sp/gla-11.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="precios-dependiendo-la-ubicación" class="level2">
<h2 class="anchored" data-anchor-id="precios-dependiendo-la-ubicación">Precios dependiendo la ubicación</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>colors<span class="op">=</span>[<span class="st">'#EC00FF'</span> ,<span class="st">'#0028F1'</span>,<span class="st">'#00F104'</span>,<span class="st">'#FF2D00'</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>(ames_train <span class="op">&gt;&gt;</span> ggplot(aes(x<span class="op">=</span><span class="st">'Latitude'</span>, y<span class="op">=</span><span class="st">'Longitude'</span>, color<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>)) <span class="op">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                geom_point(alpha<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">1.5</span>, stroke<span class="op">=</span><span class="dv">1</span>, shape<span class="op">=</span><span class="st">'2'</span>)<span class="op">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                labs(title<span class="op">=</span><span class="st">'Precios dependiendo de la ubicación geografica'</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                    colour<span class="op">=</span><span class="st">'Precio de venta'</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                    y<span class="op">=</span><span class="st">'Longuitud'</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span> <span class="st">'Latidud'</span>)<span class="op">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                scale_color_gradientn(colors<span class="op">=</span>colors,labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span> theme_538()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/price%20por%20ubi-13.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  ames_train </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> group_by(_.Neighborhood) </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> summarize(media <span class="op">=</span> np.mean(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]), desv<span class="op">=</span>np.std(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> mutate( max_err <span class="op">=</span> _.media  <span class="op">+</span> _.desv, min_err <span class="op">=</span>  _.media  <span class="op">-</span> _.desv)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> arrange(_.media)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot(aes(x<span class="op">=</span><span class="st">'reorder(Neighborhood,media)'</span>, y<span class="op">=</span><span class="st">'media'</span>) ) </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),width<span class="op">=</span><span class="fl">0.3</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>))<span class="op">+</span>geom_point()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_bw()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>coord_flip()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>labs(y<span class="op">=</span><span class="st">'Precio  promedio por pie cuadrado de área habitable'</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/error_bars%20por%20vecindario-15.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-relacionadas-con-el-sótano" class="level2">
<h2 class="anchored" data-anchor-id="variables-relacionadas-con-el-sótano">Variables relacionadas con el sótano</h2>
<p>Se puede ver que se tiene una relación líneal creciente entre <code>Total_Bsmt_SF</code> y <code>Sale_Price\ Gr_Liv_Area</code>, en la siguiente gráfica tambien podemos ver como varios puntos se acumulan en <code>Total_Bsmt_SF = 0</code> debido a que estas casas no cuentan con sótano</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    ames_x_train </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot( aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_point(size<span class="op">=</span><span class="dv">1</span>,alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) )</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">2500</span>])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Total_Bsmt_SF vs  Sale Price/ Gr_Liv_Area'</span>, x<span class="op">=</span><span class="st">'Total_Bsmt_SF'</span>, y<span class="op">=</span><span class="st">'Sale Price/ Gr_Liv_Area'</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_538()</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/price%20vs%20sf%20sotano-17.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>En cuanto a las variables categóricas relacionadas al sótano encontramos lo siguiente:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cat_columns <span class="op">=</span> pd.Series([<span class="st">'Bldg_Type'</span>, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Exposure'</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Central_Air'</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1'</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2'</span>, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical'</span>, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence'</span>, </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation'</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish'</span>, </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type'</span>, </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Feature'</span>, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive'</span>, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC'</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Overall_Cond'</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass'</span>, </span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_Zoning'</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond'</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1'</span>, </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2'</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style'</span>,</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Shape'</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood'</span>])</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> cat_columns[cat_columns.<span class="bu">str</span>.contains(<span class="st">'Bsmt'</span>)]:</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  titulo<span class="op">=</span><span class="st">'Categoría analazada: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category) </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  (ames_train  <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area'</span>, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>, color<span class="op">=</span> <span class="st">'</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category)))</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> geom_point(alpha<span class="op">=</span> <span class="fl">0.5</span>, show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">3000</span>])</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>labs(x<span class="op">=</span><span class="st">'Área total del sótano'</span>, y<span class="op">=</span><span class="st">'Precio por pie cuadrado de área habitable bruta'</span>, title<span class="op">=</span>titulo)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> facet_wrap(<span class="st">'~</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category))<span class="op">+</span>theme_538 ()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-19.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-20.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-21.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-22.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Puntos a considerar:</p>
<ul>
<li><p>En <code>Bsmt_Exposure</code> se puede notar que la relación positiva entre las variables se mantiene, y no parece cambiar si se altera la exposicón del sótano. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
<li><p>En <code>Bsmt_Cond</code> se puede ver que la relación de las variables si cambia dependiendo de la condición del sótano, además en la condición de Excellent y Poor se tienen muy pocas observaciones.</p></li>
<li><p>En <code>Bsmt_Type_1</code> se tienen relaciones demaciado planas en su mayoria, a excepción de GLQ y Unf.</p></li>
<li><p>En <code>Bsmt_Type_2</code> se tiene el mismo caso que en el anterior. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
</ul>
</section>
</section>
<section id="regresión-líneal" class="level1">
<h1>Regresión Líneal</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># def importance_from_model (test_frame, y_obs, selected_columns, pipeline, actual_mse, n_permutations=50 ,trans_pred= False ):</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   performance_losses = []</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   for i in range(test_frame[selected_columns].shape[1]):</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     loss = []</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     for j in range(n_permutations):</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#         test_frame_permuted = test_frame[selected_columns].copy()</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#         test_frame_permuted.iloc[:, i] = np.random.permutation(test_frame_permuted.iloc[:, i])</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#         if trans_pred == False:</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#             y_pred_permuted = pipeline.predict(test_frame_permuted)</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#         else:</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#             y_pred_permuted = pipeline.predict(test_frame_permuted)* test_frame_permuted.Gr_Liv_Area</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#         mse_permuted = mean_squared_error(y_obs, y_pred_permuted)</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#         loss.append(mse_permuted)</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#     performance_losses.append(loss)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   performance_losses = performance_losses/np.sum(performance_losses, axis=0)</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   mean_losses = np.mean(performance_losses, axis=1)</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   std_losses = np.std(performance_losses, axis=1)</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   importance_df = pd.DataFrame({</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   'Variable': selected_columns, </span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   'Mean_Loss': mean_losses, </span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   'Std_Loss': std_losses</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   })</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   return importance_df</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># def adjusted_r2_score(y_true, y_pred, n, p):</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   r2 = r2_score(y_true, y_pred)</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   adjusted_r2 = 1 - (1 - r2) * (n - 1) / (n - p - 1)</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   return adjusted_r2 </span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a><span class="co"># def div_columns(X, c1, c2):</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co">#     X["c1_c2"] = X[c1]/ X[c2]</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     return X</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># def adj_r(y_o, y_p , p, n):</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   r2_adj = 1 - (n - 1) / (n - p - 1) * (1 - r2_score(y_o, y_p))</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co"># def get_metrics (y_pred, y_obs,predictors):</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   me = np.mean(y_obs - y_pred)</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   mae = mean_absolute_error(y_obs, y_pred)</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   mape = mean_absolute_percentage_error(y_obs, y_pred)</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   mse = mean_squared_error(y_obs, y_pred)</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   rmse = np.sqrt(mse)</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   r2 = r2_score(y_obs, y_pred)</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   n = len(y_obs)  # Número de observaciones</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   p = predictors  # Número de predictores </span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   r2_adj = 1 - (n - 1) / (n - p - 1) * (1 - r2)</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   metrics_data = {</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co">#       "Metric": ["ME", "MAE", "MAPE", "MSE", "RMSE", "R2", "R2Adj"],</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="co">#       "Value": [me, mae, mape, mse, rmse, r2, r2_adj]</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   return pd.DataFrame(metrics_data).set_index('Metric')</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a><span class="co"># def rmv_elements (list_of_elements, complete_list):</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   for element in list_of_elements:</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     complete_list.remove(element)</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   return complete_list</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a><span class="co"># def validation_results(x_val,y_val,  pipeline , n_preds):</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   y_pred = pipeline.predict(x_val)</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   ames_test = (</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a><span class="co">#     ames_x_val &gt;&gt;</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(Sale_Price_Pred = y_pred*_.Gr_Liv_Area, Sale_Price =y_val*_.Gr_Liv_Area))</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a><span class="co">#   ##### Métricas de desempeño</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   y_obs = ames_test["Sale_Price"]</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   y_pred = ames_test["Sale_Price_Pred"]</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   return get_metrics(y_pred, y_obs, n_preds)</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A continuación se muestra el modelo de regresión líneal que tuvo un mejor performance de acuerdo a las variables que se estudiaron:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span><span class="bu">sorted</span>( [<span class="st">'Wood_Deck_SF'</span>, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'First_Flr_SF'</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fireplaces'</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Open_Porch_SF'</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Enclosed_Porch'</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Area'</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wood_prop'</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Total_Bsmt_SF'</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Area'</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Gr_Liv_Area'</span>,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'area_per_car'</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'last_remod'</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Full_Bath'</span>, </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Three_season_porch'</span>,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_1'</span>, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_2'</span>, </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Unf_SF'</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Half_Bath'</span>, </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Full_Bath'</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Kitchen_AbvGr'</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Half_Bath'</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mas_Vnr_Area'</span>,</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Val'</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bedroom_AbvGr'</span>])</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">'Bldg_Type'</span>, </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Exposure'</span>, </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Central_Air'</span>,<span class="st">'Mo_Sold'</span>, </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1'</span>, </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2'</span>, </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical'</span>, </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mas_Vnr_Type'</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence'</span>, </span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Exter_Cond'</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation'</span>, </span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish'</span>, </span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type'</span>, </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Misc_Feature', </span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive'</span>, </span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC'</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Overall_Cond'</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass'</span>, </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond'</span>,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1'</span>, </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2'</span>, </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style'</span>,</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Shape'</span>, <span class="co">#'Roof_Style'</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood'</span>]</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>columnas_seleccionadas <span class="op">=</span> num_cols <span class="op">+</span> <span class="bu">sorted</span>(cat_cols <span class="op">+</span> [<span class="st">'Year_Built'</span>,<span class="st">'Garage_Cars'</span>,<span class="st">'Misc_Feature'</span>])</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co">#######################################################################</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>preprocessor_1 <span class="op">=</span> ColumnTransformer(</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler(), num_cols),</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'imputer'</span>,  SimpleImputer(missing_values<span class="op">=</span>np.nan, strategy<span class="op">=</span><span class="st">'mean'</span>), [<span class="st">'Year_Built'</span>,<span class="st">'Garage_Cars'</span>]),</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'OHE'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown<span class="op">=</span><span class="st">'ignore'</span> , sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency<span class="op">=</span><span class="dv">20</span>), cat_cols),</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'OHE_1'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown<span class="op">=</span><span class="st">'ignore'</span> , sparse_output<span class="op">=</span><span class="va">False</span>), [<span class="st">'Misc_Feature'</span>])</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'drop'</span>  </span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>    ).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>interaction_transformer <span class="op">=</span> PolynomialFeatures(degree <span class="op">=</span> <span class="dv">2</span>, interaction_only <span class="op">=</span> <span class="va">True</span>, include_bias <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>interaction_transformer_wb <span class="op">=</span> PolynomialFeatures(degree <span class="op">=</span> <span class="dv">2</span>, interaction_only <span class="op">=</span> <span class="va">True</span>, include_bias <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>drop_cols<span class="op">=</span>[<span class="st">'Neighborhood_Crawford'</span>,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood_infrequent_sklearn'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1_BLQ'</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Exter_Cond_Good'</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_2_Feedr',</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1_RRAe'</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_1_Feedr',</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type_No_Garage'</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_1_PosA',</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Full_Bath'</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Half_Bath'</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_2_RRAe',</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_CBlock'</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass_Two_Story_1946_and_Newer'</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish_No_Garage'</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bldg_Type_TwoFmCon'</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_5'</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive_Partial_Pavement'</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_Typical'</span>,</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC_Fair'</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1_Unf'</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical_SBrkr'</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence_Good_Wood'</span>,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Electrical_Unknown',</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type_Detchd'</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_Slab'</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style_infrequent_sklearn'</span>,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Three_season_porch'</span>,</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2_GLQ'</span>,</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_7'</span>,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Val'</span>,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1_No_Basement'</span>,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_PConc'</span>,</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_12'</span>,</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_10'</span>,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2_No_Basement'</span>,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'last_remod'</span>,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_No_Basement'</span>,</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2_infrequent_sklearn'</span>,</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Exter_Cond_Typical'</span>,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bldg_Type_OneFam'</span>,</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_9'</span>,</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical_infrequent_sklearn'</span>,</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_infrequent_sklearn'</span>,</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_Good'</span>,</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_infrequent_sklearn'</span>,</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bldg_Type_TwnhsE'</span>,</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence_No_Fence'</span>]</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>preprocessor_2<span class="op">=</span>ColumnTransformer(</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  transformers<span class="op">=</span>[</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"selector"</span>, <span class="st">"drop"</span>, drop_cols),</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interaction_1'</span>, interaction_transformer_wb, [<span class="st">'Lot_Area'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions2'</span>, interaction_transformer, [<span class="st">'Year_Built'</span>, <span class="st">'Overall_Cond_Average'</span>]),</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3'</span>, interaction_transformer, [<span class="st">'Full_Bath'</span>, <span class="st">'Bedroom_AbvGr'</span>]),</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.1'</span>, interaction_transformer, [<span class="st">'House_Style_SLvl'</span>, <span class="st">'Overall_Cond_Fair'</span>]),</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.4'</span>, interaction_transformer, [<span class="st">'wood_prop'</span>, <span class="st">'Mas_Vnr_Area'</span>]),</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.2'</span>, interaction_transformer, [<span class="st">'First_Flr_SF'</span>, <span class="st">'last_remod'</span>]),</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.5'</span>, interaction_transformer, [<span class="st">'BsmtFin_SF_1'</span>, <span class="st">'BsmtFin_Type_2_Unf'</span>]),</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions4'</span>, interaction_transformer, [<span class="st">'Misc_Val'</span>, <span class="st">'Misc_Feature_TenC'</span>])</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'passthrough'</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>prep_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep1'</span>,preprocessor_1),</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selec_inter'</span>, preprocessor_2)</span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="co">##### Extracción de coeficientes</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> prep_pipe.fit_transform(ames_x_train)</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>X_train_with_intercept <span class="op">=</span> sm.add_constant(transformed_df)</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(ames_y_train, X_train_with_intercept).fit()</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'statsmodels.iolib.summary.Summary'&gt;
"""
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.813
Model:                            OLS   Adj. R-squared:                  0.802
Method:                 Least Squares   F-statistic:                     71.23
Date:              mar., 07 nov. 2023   Prob (F-statistic):               0.00
Time:                        22:11:54   Log-Likelihood:                -8275.9
No. Observations:                2051   AIC:                         1.679e+04
Df Residuals:                    1932   BIC:                         1.746e+04
Df Model:                         118                                         
Covariance Type:            nonrobust                                         
=========================================================================================================================
                                                            coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------------------------------------
const                                                  9954.2028   2.81e+04      0.354      0.723   -4.51e+04     6.5e+04
Lot_Area                                                  1.9088      0.461      4.141      0.000       1.005       2.813
Gr_Liv_Area                                              -7.2262      1.230     -5.876      0.000      -9.638      -4.814
Lot_Area Gr_Liv_Area                                     -1.0539      0.224     -4.705      0.000      -1.493      -0.615
Year_Built                                               -5.0423     14.247     -0.354      0.723     -32.983      22.898
Overall_Cond_Average                                   -267.5837     67.303     -3.976      0.000    -399.578    -135.590
Year_Built Overall_Cond_Average                           0.1340      0.034      3.916      0.000       0.067       0.201
Full_Bath                                                 0.7345      0.564      1.303      0.193      -0.371       1.840
Bedroom_AbvGr                                            -2.3131      0.478     -4.841      0.000      -3.250      -1.376
Full_Bath Bedroom_AbvGr                                   1.3369      0.293      4.556      0.000       0.761       1.912
House_Style_SLvl                                        -14.2743      5.848     -2.441      0.015     -25.742      -2.806
Overall_Cond_Fair                                       -23.1655      2.600     -8.910      0.000     -28.264     -18.067
House_Style_SLvl Overall_Cond_Fair                    -6.926e-13   1.28e-13     -5.418      0.000   -9.43e-13   -4.42e-13
wood_prop                                                 4.4576      1.179      3.782      0.000       2.146       6.769
Mas_Vnr_Area                                              3.5298      0.525      6.722      0.000       2.500       4.560
wood_prop Mas_Vnr_Area                                    1.1337      0.401      2.828      0.005       0.348       1.920
First_Flr_SF                                             -5.4836      1.169     -4.690      0.000      -7.776      -3.191
last_remod                                             -161.0307    430.727     -0.374      0.709   -1005.770     683.708
First_Flr_SF last_remod                                  -2.7332      0.528     -5.175      0.000      -3.769      -1.697
BsmtFin_SF_1                                              1.6247      1.395      1.165      0.244      -1.111       4.361
BsmtFin_Type_2_Unf                                      -10.6163      2.915     -3.642      0.000     -16.333      -4.900
BsmtFin_SF_1 BsmtFin_Type_2_Unf                          -1.8007      1.391     -1.295      0.196      -4.528       0.927
Misc_Val                                                  0.0354      0.997      0.036      0.972      -1.920       1.991
Misc_Feature_TenC                                        10.9746      3.211      3.418      0.001       4.678      17.271
Misc_Val Misc_Feature_TenC                               32.7714      9.587      3.418      0.001      13.969      51.574
BsmtFin_SF_2                                             -1.5239      0.599     -2.543      0.011      -2.699      -0.349
Bsmt_Unf_SF                                              -4.1558      0.577     -7.206      0.000      -5.287      -3.025
Enclosed_Porch                                            0.5663      0.350      1.620      0.105      -0.119       1.252
Fireplaces                                                1.6314      0.405      4.028      0.000       0.837       2.426
Garage_Area                                               2.5402      1.237      2.054      0.040       0.115       4.966
Half_Bath                                                 0.6041      0.498      1.213      0.225      -0.373       1.581
Kitchen_AbvGr                                            -1.4700      0.443     -3.317      0.001      -2.339      -0.601
Lot_Frontage                                              0.7886      0.374      2.106      0.035       0.054       1.523
Open_Porch_SF                                             0.6814      0.364      1.874      0.061      -0.032       1.395
Total_Bsmt_SF                                             6.3422      0.937      6.767      0.000       4.504       8.180
Wood_Deck_SF                                             -3.9968      1.221     -3.273      0.001      -6.392      -1.602
area_per_car                                             -0.5177      0.598     -0.866      0.387      -1.690       0.655
Garage_Cars                                               3.2875      1.346      2.442      0.015       0.647       5.928
Bldg_Type_Twnhs                                         -10.1083      2.363     -4.278      0.000     -14.742      -5.474
Bsmt_Exposure_Gd                                          6.5801      1.466      4.490      0.000       3.706       9.454
Bsmt_Exposure_Mn                                         -5.7843      1.507     -3.839      0.000      -8.740      -2.829
Bsmt_Exposure_No                                         -4.5949      1.119     -4.106      0.000      -6.790      -2.400
Bsmt_Exposure_No_Basement                               -20.6930      4.182     -4.948      0.000     -28.896     -12.490
Central_Air_Y                                             3.1431      1.613      1.949      0.051      -0.020       6.306
Mo_Sold_2                                                -5.4665      1.618     -3.379      0.001      -8.639      -2.294
Mo_Sold_3                                                -1.8005      1.238     -1.455      0.146      -4.228       0.627
Mo_Sold_4                                                -0.9347      1.133     -0.825      0.410      -3.158       1.288
Mo_Sold_6                                                -1.7218      0.909     -1.894      0.058      -3.504       0.061
Mo_Sold_8                                                -2.2543      1.213     -1.859      0.063      -4.633       0.124
Mo_Sold_11                                               -2.6749      1.504     -1.779      0.075      -5.624       0.274
Condition_1_Feedr                                        -2.2434      2.138     -1.049      0.294      -6.436       1.949
Condition_1_Norm                                          6.2977      1.693      3.720      0.000       2.978       9.618
Condition_1_PosN                                          9.8612      3.146      3.135      0.002       3.691      16.031
Condition_1_RRAn                                          3.6148      2.995      1.207      0.228      -2.259       9.489
Condition_1_infrequent_sklearn                            6.8177      3.618      1.884      0.060      -0.278      13.913
Electrical_FuseF                                          2.6673      2.640      1.010      0.313      -2.511       7.845
Mas_Vnr_Type_Stone                                        5.4492      1.328      4.102      0.000       2.844       8.054
Mas_Vnr_Type_nan                                          4.4596      1.079      4.132      0.000       2.343       6.576
Mas_Vnr_Type_infrequent_sklearn                          -4.2498      3.592     -1.183      0.237     -11.294       2.795
Fence_Minimum_Privacy                                     1.2845      1.050      1.223      0.221      -0.775       3.344
Fence_infrequent_sklearn                                  3.2930      5.162      0.638      0.524      -6.830      13.416
Exter_Cond_infrequent_sklearn                            -6.9654      4.943     -1.409      0.159     -16.660       2.730
Garage_Finish_RFn                                        -3.0914      0.961     -3.215      0.001      -4.977      -1.206
Garage_Finish_Unf                                        -1.1641      1.101     -1.057      0.291      -3.324       0.996
Garage_Type_Basment                                      -3.2631      3.155     -1.034      0.301      -9.452       2.925
Garage_Type_BuiltIn                                      -2.6366      1.644     -1.604      0.109      -5.861       0.588
Garage_Type_infrequent_sklearn                          -10.8081      2.803     -3.855      0.000     -16.306      -5.310
Paved_Drive_Paved                                         3.9465      1.417      2.786      0.005       1.168       6.725
Heating_QC_Good                                          -1.0716      1.001     -1.070      0.285      -3.035       0.892
Heating_QC_Typical                                       -1.4190      0.908     -1.563      0.118      -3.199       0.361
Heating_QC_infrequent_sklearn                           -32.3869      8.865     -3.653      0.000     -49.773     -15.001
Overall_Cond_Below_Average                               -8.1790      1.941     -4.213      0.000     -11.986      -4.372
Overall_Cond_Excellent                                   24.6891      3.173      7.781      0.000      18.466      30.912
Overall_Cond_Good                                         8.3455      1.164      7.170      0.000       6.063      10.628
Overall_Cond_Very_Good                                   10.1981      1.705      5.982      0.000       6.855      13.541
Overall_Cond_infrequent_sklearn                         -31.0955      3.967     -7.838      0.000     -38.876     -23.315
MS_SubClass_One_Story_1945_and_Older                      9.1382      3.325      2.749      0.006       2.618      15.659
MS_SubClass_One_Story_1946_and_Newer_All_Styles           9.4727      2.460      3.850      0.000       4.648      14.298
MS_SubClass_One_Story_PUD_1946_and_Newer                  5.0132      3.020      1.660      0.097      -0.909      10.936
MS_SubClass_One_and_Half_Story_Finished_All_Ages         10.1639      3.750      2.711      0.007       2.810      17.518
MS_SubClass_Split_Foyer                                  15.4305      4.188      3.684      0.000       7.216      23.645
MS_SubClass_Split_or_Multilevel                          16.1814      6.079      2.662      0.008       4.259      28.104
MS_SubClass_Two_Family_conversion_All_Styles_and_Ages     7.7103      3.186      2.420      0.016       1.463      13.958
MS_SubClass_Two_Story_1945_and_Older                      8.7715      2.575      3.406      0.001       3.721      13.822
MS_SubClass_Two_Story_PUD_1946_and_Newer                -11.0851      2.498     -4.438      0.000     -15.984      -6.187
MS_SubClass_infrequent_sklearn                           10.8762      3.441      3.160      0.002       4.127      17.625
BsmtFin_Type_1_GLQ                                        4.0622      1.038      3.912      0.000       2.026       6.099
BsmtFin_Type_1_LwQ                                       -3.1627      1.543     -2.050      0.041      -6.189      -0.136
BsmtFin_Type_1_Rec                                       -2.9560      1.412     -2.093      0.036      -5.725      -0.187
BsmtFin_Type_2_BLQ                                       -8.2931      3.008     -2.757      0.006     -14.192      -2.394
BsmtFin_Type_2_LwQ                                      -11.3195      2.958     -3.827      0.000     -17.120      -5.519
BsmtFin_Type_2_Rec                                       -8.3755      2.894     -2.894      0.004     -14.052      -2.699
House_Style_One_and_Half_Fin                            -13.4808      3.522     -3.828      0.000     -20.388      -6.573
House_Style_SFoyer                                       -5.3045      3.705     -1.432      0.152     -12.570       1.961
House_Style_Two_Story                                    -9.8045      2.880     -3.405      0.001     -15.452      -4.157
Lot_Shape_Regular                                        -4.5797      2.209     -2.074      0.038      -8.911      -0.248
Lot_Shape_Slightly_Irregular                             -4.0496      2.200     -1.840      0.066      -8.365       0.266
Lot_Shape_infrequent_sklearn                            -12.9403      5.171     -2.502      0.012     -23.082      -2.798
Neighborhood_Brookside                                  -11.9410      2.310     -5.169      0.000     -16.472      -7.410
Neighborhood_Clear_Creek                                 -8.9939      3.036     -2.963      0.003     -14.948      -3.040
Neighborhood_College_Creek                               -7.6510      2.003     -3.820      0.000     -11.579      -3.723
Neighborhood_Edwards                                    -14.8820      1.968     -7.561      0.000     -18.742     -11.022
Neighborhood_Gilbert                                     -9.6275      2.332     -4.129      0.000     -14.200      -5.055
Neighborhood_Iowa_DOT_and_Rail_Road                     -19.9033      2.524     -7.886      0.000     -24.853     -14.953
Neighborhood_Meadow_Village                             -16.0440      3.331     -4.817      0.000     -22.577      -9.511
Neighborhood_Mitchell                                   -12.2773      2.323     -5.285      0.000     -16.833      -7.722
Neighborhood_North_Ames                                 -11.1975      1.725     -6.490      0.000     -14.581      -7.814
Neighborhood_Northridge                                   2.3026      2.770      0.831      0.406      -3.130       7.736
Neighborhood_Northridge_Heights                          10.2972      2.272      4.532      0.000       5.841      14.753
Neighborhood_Northwest_Ames                             -12.8044      2.184     -5.862      0.000     -17.088      -8.521
Neighborhood_Old_Town                                   -18.2058      2.085     -8.731      0.000     -22.295     -14.117
Neighborhood_Sawyer                                      -8.4452      2.133     -3.959      0.000     -12.629      -4.262
Neighborhood_Sawyer_West                                -12.0133      2.228     -5.392      0.000     -16.383      -7.644
Neighborhood_Somerset                                     4.8777      2.185      2.232      0.026       0.592       9.164
Neighborhood_South_and_West_of_Iowa_State_University    -10.4442      2.961     -3.527      0.000     -16.251      -4.637
Neighborhood_Stone_Brook                                 14.5690      3.034      4.802      0.000       8.618      20.520
Neighborhood_Timberland                                  -6.5571      2.698     -2.431      0.015     -11.848      -1.266
Misc_Feature_Gar2                                       123.2238     20.560      5.993      0.000      82.902     163.545
Misc_Feature_Othr                                       115.7101     27.049      4.278      0.000      62.663     168.758
Misc_Feature_Shed                                       109.7511     29.862      3.675      0.000      51.185     168.317
Misc_Feature_nan                                        110.2385     30.731      3.587      0.000      49.970     170.507
==============================================================================
Omnibus:                      129.795   Durbin-Watson:                   2.041
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              571.146
Skew:                          -0.046   Prob(JB):                    9.49e-125
Kurtosis:                       5.584   Cond. No.                     1.03e+16
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 1.04e-22. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
"""</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocessor'</span>, preprocessor_1),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'select_interac'</span>, preprocessor_2),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, LinearRegression())])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipeline.fit(ames_x_train, ames_y_train)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">## PREDICCIONES</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [5, 7, 16] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred<span class="op">*</span>_.Gr_Liv_Area, Sale_Price <span class="op">=</span>ames_y_test<span class="op">*</span>_.Gr_Liv_Area)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">##### Métricas de desempeño</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>predictores <span class="op">=</span> transformed_df.columns.to_list()</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>mtrcs_dt <span class="op">=</span>get_metrics(y_pred, y_obs,predictors<span class="op">=</span> <span class="bu">len</span>(transformed_df.columns ))</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(mtrcs_dt)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Value
Metric             
ME           459.52
MAE        17450.23
MAPE           0.10
MSE    788119627.21
RMSE       28073.47
R2             0.88
R2Adj          0.85</code></pre>
</div>
</div>
<p>El modelo muestra una <span class="math inline">\(R^2_{adj}=0.85\)</span> con los datos de test, y tienen un error aproximado del <span class="math inline">\(\pm10\%\)</span> con respecto del precio real.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(ames_x_val)<span class="op">*</span>ames_x_val.Gr_Liv_Area</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred,Sale_Price_validation,<span class="bu">len</span>(transformed_df.columns ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Value
Metric             
ME          -496.29
MAE        17661.52
MAPE           0.11
MSE    716434579.56
RMSE       26766.30
R2             0.89
R2Adj          0.82</code></pre>
</div>
</div>
<p>En cuanto al análisis de los residuos, no parece seguir completamente los supuestos, pues visualmete se puede detectar heterocedasticidad, lo cual puede afectar el preformance del modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### Gráficos de desempeño de modelo</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> y_obs, y <span class="op">=</span> y_pred)) <span class="op">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    geom_point(alpha<span class="op">=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>] ) <span class="op">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>]) <span class="op">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 879 rows containing missing values.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-24-27.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 85'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-24-28.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-24-29.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  geom_linerange(aes(ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> <span class="st">"error"</span>), colour <span class="op">=</span> <span class="st">"purple"</span>) <span class="op">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y <span class="op">=</span> <span class="st">"error"</span>), size <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Precio real"</span>) <span class="op">+</span> ylab(<span class="st">"Error de estimación"</span>) <span class="op">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Relación entre error y precio de venta"</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-24-30.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="regresión-con-knn" class="level1">
<h1>Regresión con Knn</h1>
<section id="cross-validation-con-todas-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation-con-todas-las-variables">Cross validation con todas las variables</h2>
<p>Se hace un cross validation con todas las features que se tienen, em busca de los hiperparámetros adecuados para el modelo, al menos de manera provisional</p>
<section id="preprocesado-de-las-variables" class="level3">
<h3 class="anchored" data-anchor-id="preprocesado-de-las-variables">Preprocesado de las variables</h3>
<p>Para el modelo de KNN se tomará como variable predictiva el precio de venta, sin ninguna transformación. - Variables númericas: _ Estadarización - Variables categóricas: - One hot econding, tomando un mínimo de 15 observaciones en las categorías</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>preprocessor<span class="op">=</span> ColumnTransformer([</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'std'</span>, StandardScaler(), num_cols),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'onehotencoding'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown <span class="op">=</span> <span class="st">'ignore'</span>, sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency<span class="op">=</span><span class="dv">15</span>), cat_cols)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span>, </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> preprocessor.fit_transform(ames_x_train).columns</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_squared_error'</span>: make_scorer(mean_squared_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'r2'</span>: make_scorer(adjusted_r2_score, greater_is_better<span class="op">=</span><span class="va">True</span>, n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_x_train)), p<span class="op">=</span><span class="bu">len</span>(predictors)),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_absolute_error'</span>: make_scorer(mean_absolute_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mape'</span>: make_scorer(mean_absolute_percentage_error, greater_is_better<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">70</span>, <span class="dv">5</span>),</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'cosine'</span>],</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv <span class="op">=</span> Pipeline([</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv.fit(ames_x_train, Sale_Price_train )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resultados-cv" class="level3">
<h3 class="anchored" data-anchor-id="resultados-cv">Resultados CV</h3>
<p>En la siguiente gráfica se puede ver el las estimaciones de las metricas de <span class="math inline">\(R^2_{adj},\space RMSE\text{ y } MAPE\)</span>. La distancia de <span class="math inline">\(manhattan\)</span> parece ser la que tiene mejores resultados en las tres métricas, y el hiper-parámetro <span class="math inline">\(K\)</span> muestra mejores cuando es menor a 25.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> pd.DataFrame(gs_knn_fm_cv.named_steps[<span class="st">'cv'</span>].cv_results_)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> (cv_results </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> select(<span class="op">-</span>_.contains(<span class="st">'split'</span>),<span class="op">-</span>_.params, <span class="op">-</span>_.contains(<span class="st">'time'</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>             <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                  cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'mean_test_mape'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>                  names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                  values_to<span class="op">=</span><span class="st">'value'</span>) <span class="op">&gt;&gt;</span> mutate(value <span class="op">=</span> <span class="bu">abs</span>(_.value))</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  cv_results </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="fl">0.9</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 18 rows containing missing values.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/plot_knn_cv1-35.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="párametros-óptimos-para-el-full-model" class="level3">
<h3 class="anchored" data-anchor-id="párametros-óptimos-para-el-full-model">Párametros óptimos para el full model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">26</span>),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>],</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'cosine'</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv2 <span class="op">=</span> Pipeline([</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=-</span><span class="dv">1</span>))</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv2.fit(ames_x_train, Sale_Price_train )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> pd.DataFrame(gs_knn_fm_cv2.named_steps[<span class="st">'cv'</span>].cv_results_)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> (cv_results </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> select(<span class="op">-</span>_.contains(<span class="st">'split'</span>),<span class="op">-</span>_.params, <span class="op">-</span>_.contains(<span class="st">'time'</span>))</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>             <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                  cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'mean_test_mape'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                  names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                  values_to<span class="op">=</span><span class="st">'value'</span>) <span class="op">&gt;&gt;</span> mutate(value <span class="op">=</span> <span class="bu">abs</span>(_.value))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  cv_results </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-32-37.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Analizando los diferentes resultados se opta por un parametro de <span class="math inline">\(K=10\)</span> pues muestra una buena estimación tanto para <span class="math inline">\(R^2_{adj}\)</span> y <span class="math inline">\(MAPE\)</span>, además, esta elección nos proporcionara un modelo más robusto que otras opciones que parecen arrojar mejores métricas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  cv_results</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> mutate( </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        error_min <span class="op">=</span> case_when({</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>          _.parameter <span class="op">==</span> <span class="st">'mean_test_r2'</span>: _.value <span class="op">-</span> _.std_test_r2,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>          _.parameter <span class="op">==</span> <span class="st">'mean_test_mape'</span>: _.value <span class="op">-</span> _.std_test_mape, <span class="va">True</span>:<span class="dv">1</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        }),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        error_max <span class="op">=</span> case_when({</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>          _.parameter <span class="op">==</span> <span class="st">'mean_test_r2'</span>: _.value <span class="op">+</span> _.std_test_r2,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>          _.parameter <span class="op">==</span> <span class="st">'mean_test_mape'</span>: _.value <span class="op">+</span> _.std_test_mape, <span class="va">True</span>:<span class="dv">1</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                                })</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_n_neighbors.astype(<span class="bu">int</span>) <span class="op">&lt;=</span><span class="dv">15</span>, </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                _.parameter <span class="op">!=</span> <span class="st">'RMSE'</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>                _.param_metric <span class="op">==</span> <span class="st">'manhattan'</span>) </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'error_min'</span>, ymax<span class="op">=</span><span class="st">'error_max'</span>),</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>      position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>),show_legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-33-39.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
</section>
<section id="feature-selection" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection">Feature selection</h2>
<p>Se hara un analísis del preformance del modelo en test, y se analizará la importancia de las variables y se buscara hara una selección de variables de acuerdo a eso mismo.El modelo muestra los siguientes resultados:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>knn_reg <span class="op">=</span> KNeighborsRegressor(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    n_neighbors <span class="op">=</span> <span class="dv">10</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> <span class="st">'uniform'</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    metric <span class="op">=</span><span class="st">'manhattan'</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>knn_<span class="op">=</span> Pipeline([</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>,knn_reg )</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>knn_.fit(ames_x_train , Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('std', StandardScaler(),
                                                  ['Bedroom_AbvGr',
                                                   'BsmtFin_SF_1',
                                                   'BsmtFin_SF_2',
                                                   'Bsmt_Full_Bath',
                                                   'Bsmt_Half_Bath',
                                                   'Bsmt_Unf_SF',
                                                   'Enclosed_Porch',
                                                   'Fireplaces', 'First_Flr_SF',
                                                   'Full_Bath', 'Garage_Area',
                                                   'Garage_Cars', 'Gr_Liv_Area',
                                                   'Half_Bath', 'Kitchen_AbvGr',
                                                   'Latitude', 'Longitude',
                                                   'Lot_Area', 'Lot_Frontage'...
                                                   'Bldg_Type', 'House_Style',
                                                   'Overall_Cond', 'Roof_Style',
                                                   'Roof_Matl', 'Exterior_1st',
                                                   'Exterior_2nd',
                                                   'Mas_Vnr_Type', 'Exter_Cond',
                                                   'Foundation', 'Bsmt_Cond',
                                                   'Bsmt_Exposure',
                                                   'BsmtFin_Type_1',
                                                   'BsmtFin_Type_2', 'Heating',
                                                   'Heating_QC', 'Central_Air',
                                                   'Electrical', ...])],
                                   verbose_feature_names_out=False)),
                ('regressor',
                 KNeighborsRegressor(metric='manhattan', n_neighbors=10))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>y_pred  <span class="op">=</span> knn_.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> preprocessor.get_feature_names_out()</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>metrics <span class="op">=</span> get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(predictors))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Value
Metric              
ME           8328.95
MAE         21891.02
MAPE            0.12
MSE    1272507998.28
RMSE        35672.23
R2              0.80
R2Adj           0.69</code></pre>
</div>
</div>
<p>A continucación se calcula la importancia de variables para el full model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> importance_from_model(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  test_frame <span class="op">=</span> preprocessor.transform(ames_x_test) ,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  y_obs <span class="op">=</span> Sale_Price_test ,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  selected_columns <span class="op">=</span> <span class="bu">list</span>(predictors), </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> knn_reg,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  actual_mse <span class="op">=</span> metrics.loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>] ,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  n_permutations<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  trans_pred<span class="op">=</span> <span class="va">False</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Al tener muchas variables, el efecto en los shuffles es muy pequeño para todas las variables, pero aún as;i es comparable entre ellas, a continuación se muestran los resultados.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>importance_df.iloc[:,<span class="dv">1</span>:].head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Variable  Mean_Loss  Std_Loss
0   Bedroom_AbvGr    0.00456   0.00005
1    BsmtFin_SF_1    0.00457   0.00007
2    BsmtFin_SF_2    0.00461   0.00001
3  Bsmt_Full_Bath    0.00473   0.00005
4  Bsmt_Half_Bath    0.00462   0.00003
5     Bsmt_Unf_SF    0.00459   0.00007
6  Enclosed_Porch    0.00462   0.00004
7      Fireplaces    0.00494   0.00006
8    First_Flr_SF    0.00498   0.00006
9       Full_Bath    0.00472   0.00005</code></pre>
</div>
</div>
<p>En las siguientes gráficas se pueden observar las 15 variables que más afectan al <span class="math inline">\(MSE\)</span>, es decir, las que se podrían considerar más importatntes, y también se muestran las 15 variables con menos impacto al modelo.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span> top_n(<span class="dv">15</span>, _.Mean_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables (TOP 15)'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-38-41.png" class="img-fluid" width="614"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span> top_n(<span class="op">-</span><span class="dv">15</span>, _.Mean_Loss)<span class="op">&gt;&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables (Peores 15)'</span>, x<span class="op">=</span><span class="st">''</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-38-42.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Para poder hacer selección de features, se probaran 200 modelos, donde se irán eliminando variables de acuerdo a su importancia, de la menos importante hacia las que más importancia tienen, posteriormente se elegira el mejor de esos 150 modelos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>vars_importance_order <span class="op">=</span> <span class="bu">list</span>( importance_df <span class="op">&gt;&gt;</span> arrange(_.Mean_Loss) <span class="op">&gt;&gt;</span> pull(<span class="st">'Variable'</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> preprocessor.fit_transform(ames_x_train)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>transformed_test_df <span class="op">=</span> preprocessor.transform(ames_x_test)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>v<span class="op">=</span>[]</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>r2<span class="op">=</span>[]</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>mse_<span class="op">=</span>[]</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>p<span class="op">=</span>[]</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">200</span>):</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  vars_to_train <span class="op">=</span> vars_importance_order[i:]</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  p.append(<span class="bu">len</span>(vars_to_train))</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  knn_reg.fit(transformed_df[vars_to_train], Sale_Price_train)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  pred<span class="op">=</span> knn_reg.predict(transformed_test_df[vars_to_train])</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  mse_.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>])</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  r2.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'R2Adj'</span>].values[<span class="dv">0</span>])</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  v.append(vars_to_train)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>idf <span class="op">=</span> pd.DataFrame({<span class="st">'MSE'</span>:mse_, <span class="st">'R2_adj'</span>:r2,<span class="st">'vars'</span>:v, <span class="st">'predictors'</span>:p})</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>idf.to_csv(<span class="st">'iters_knn_feature_selection.csv'</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>best_features_from_fm <span class="op">=</span> (idf <span class="op">&gt;&gt;</span> mutate(MSE<span class="op">=</span> (_.MSE)<span class="op">**</span>(<span class="fl">0.5</span>) ) <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.MSE <span class="op">&lt;</span> <span class="dv">33500</span>) <span class="op">&gt;&gt;</span> top_n(<span class="dv">1</span>, _.R2_adj) <span class="op">&gt;&gt;</span> pull(<span class="st">'vars'</span>))[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>            MSE  R2_adj  predictors
0 1272507998.28    0.69         217
1 1252918877.06    0.69         216
2 1235138530.90    0.70         215
3 1222218756.31    0.70         214
4 1191222037.92    0.71         213</code></pre>
</div>
</div>
<p>Podemos ver que el mejor modelo podría encontrarse entre 50 y 75 predictores, de acuerdo a los modelos que se probaron, pues entre ese inrevalo el MSE toma valores menores y la <span class="math inline">\(R^2_{adj}\)</span> se mantiene en valores por encima de 0.8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  idf </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>        cols<span class="op">=</span>[<span class="st">'MSE'</span>,<span class="st">'R2_adj'</span> ],names_to<span class="op">=</span><span class="st">'variables'</span>, values_to<span class="op">=</span><span class="st">'value'</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span><span class="st">'predictors'</span>, y<span class="op">=</span><span class="st">'value'</span>))</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  geom_point(alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  facet_wrap(<span class="st">'~variables'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-41-45.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Haciendo un zoom podemos ver que el mejor candidato es el modelo con 63 predictores</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  idf </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> <span class="bu">filter</span>  (_.predictors.between(<span class="dv">10</span>,<span class="dv">63</span>))</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>        cols<span class="op">=</span>[<span class="st">'MSE'</span>,<span class="st">'R2_adj'</span> ],names_to<span class="op">=</span><span class="st">'variables'</span>, values_to<span class="op">=</span><span class="st">'value'</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span><span class="st">'predictors'</span>, y<span class="op">=</span><span class="st">'value'</span>))</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  geom_point(alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  facet_wrap(<span class="st">'~variables'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-42-47.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>array(["['Second_Flr_SF', 'Lot_Area', 'Neighborhood_Timberland', 'Garage_Type_BuiltIn', 'Latitude', 'Half_Bath', 'Screen_Porch', 'Year_Remod_Add', 'Garage_Cars', 'TotRms_AbvGrd', 'Neighborhood_Stone_Brook', 'Full_Bath', 'Garage_Area', 'Open_Porch_SF', 'Bsmt_Full_Bath', 'Mas_Vnr_Area', 'Total_Bsmt_SF', 'Fireplaces', 'Gr_Liv_Area', 'First_Flr_SF']"],
      dtype=object)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>preprocessor<span class="op">=</span> ColumnTransformer([</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'std'</span>, StandardScaler(), num_cols),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'onehotencoding'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown <span class="op">=</span> <span class="st">'ignore'</span>, sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency<span class="op">=</span><span class="dv">15</span>), cat_cols)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span>, </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>selectorr <span class="op">=</span> ColumnTransformer(</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'selector'</span>, <span class="st">'passthrough'</span>,bm_features)],</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span>,</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">77</span>)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">33</span>, <span class="dv">1</span>),</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'cosine'</span> ],</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>final_cv_knn <span class="op">=</span> Pipeline([</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr),</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>final_cv_knn.fit(ames_x_train, Sale_Price_train )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> pd.DataFrame(final_cv_knn.named_steps[<span class="st">'cv'</span>].cv_results_)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> (cv_results </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> select(<span class="op">-</span>_.contains(<span class="st">'split'</span>),<span class="op">-</span>_.params, <span class="op">-</span>_.contains(<span class="st">'time'</span>))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>                  cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'mean_test_mape'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>                  names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                  values_to<span class="op">=</span><span class="st">'value'</span>) <span class="op">&gt;&gt;</span> mutate(value <span class="op">=</span> <span class="bu">abs</span>(_.value))</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  cv_results </span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span><span class="bu">filter</span>(_.param_metric <span class="op">!=</span> <span class="st">'minkowski'</span>)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="fl">0.9</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-46-49.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>knn_reg <span class="op">=</span> KNeighborsRegressor(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    n_neighbors <span class="op">=</span> <span class="dv">14</span>,</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> <span class="st">'distance'</span>,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    metric <span class="op">=</span><span class="st">'manhattan'</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>f_num_knn_reg_fm <span class="op">=</span> Pipeline([</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr ),</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, knn_reg )</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>f_num_knn_reg_fm .fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('std', StandardScaler(),
                                                  ['Bedroom_AbvGr',
                                                   'BsmtFin_SF_1',
                                                   'BsmtFin_SF_2',
                                                   'Bsmt_Full_Bath',
                                                   'Bsmt_Half_Bath',
                                                   'Bsmt_Unf_SF',
                                                   'Enclosed_Porch',
                                                   'Fireplaces', 'First_Flr_SF',
                                                   'Full_Bath', 'Garage_Area',
                                                   'Garage_Cars', 'Gr_Liv_Area',
                                                   'Half_Bath', 'Kitchen_AbvGr',
                                                   'Latitude', 'Longitude',
                                                   'Lot_Area', 'Lot_Frontage'...
                                                   'Latitude', 'Half_Bath',
                                                   'Screen_Porch',
                                                   'Year_Remod_Add',
                                                   'Garage_Cars',
                                                   'TotRms_AbvGrd',
                                                   'Neighborhood_Stone_Brook',
                                                   'Full_Bath', 'Garage_Area',
                                                   'Open_Porch_SF',
                                                   'Bsmt_Full_Bath',
                                                   'Mas_Vnr_Area',
                                                   'Total_Bsmt_SF',
                                                   'Fireplaces', 'Gr_Liv_Area',
                                                   'First_Flr_SF'])],
                                   verbose_feature_names_out=False)),
                ('regressor',
                 KNeighborsRegressor(metric='manhattan', n_neighbors=14,
                                     weights='distance'))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> f_num_knn_reg_fm .predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span> (bm_features))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Value
Metric              
ME           3706.02
MAE         20447.96
MAPE            0.11
MSE    1127868295.91
RMSE        33583.75
R2              0.83
R2Adj           0.82</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>validation_results(x_val<span class="op">=</span>ames_x_val,pipeline<span class="op">=</span>f_num_knn_reg_fm,y_val<span class="op">=</span>Sale_Price_validation,n_preds <span class="op">=</span> <span class="bu">len</span> (bm_features))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Value
Metric             
ME          5781.80
MAE        21022.59
MAPE           0.12
MSE    954774861.42
RMSE       30899.43
R2             0.86
R2Adj          0.85

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [16] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> Sale_Price_test</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span> Sale_Price_test)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> y_obs, y <span class="op">=</span> y_pred)) <span class="op">+</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    geom_point(alpha<span class="op">=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>] ) <span class="op">+</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>]) <span class="op">+</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-48-51.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 81'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-48-52.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-48-53.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  geom_linerange(aes(ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> <span class="st">"error"</span>), colour <span class="op">=</span> <span class="st">"purple"</span>) <span class="op">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y <span class="op">=</span> <span class="st">"error"</span>), size <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Precio real"</span>) <span class="op">+</span> ylab(<span class="st">"Error de estimación"</span>) <span class="op">+</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Relación entre error y precio de venta"</span>)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-48-54.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level1">
<h1>Random Forest</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>rf_gs <span class="op">=</span> pd.read_pickle(<span class="st">'grid_search_random_forest.pkl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> pd.DataFrame(rf_gs.named_steps[<span class="st">'regressor'</span>].cv_results_)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> (cv_results </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> select(<span class="op">-</span>_.contains(<span class="st">'split|tiime'</span>))</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>              <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>             <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                  cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'mean_test_mape'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>                  names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>                  values_to<span class="op">=</span><span class="st">'value'</span>) <span class="op">&gt;&gt;</span> mutate(value <span class="op">=</span> <span class="bu">abs</span>(_.value))</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  cv_results </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_max_features"</span>, y <span class="op">=</span> <span class="st">"value"</span>, color <span class="op">=</span><span class="st">'param_min_samples_leaf'</span> )) </span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_jitter(alpha <span class="op">=</span> <span class="fl">0.5</span>,size<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-50-59.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  cv_results <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_min_samples_leaf <span class="op">&lt;</span><span class="dv">7</span>, _.param_max_features <span class="op">&gt;</span><span class="dv">30</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_max_features"</span>, y <span class="op">=</span> <span class="st">"value"</span>, color <span class="op">=</span><span class="st">'param_min_samples_leaf'</span> )) </span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_boxplot(alpha <span class="op">=</span> <span class="fl">0.5</span>,size<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-51-61.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  cv_results <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_min_samples_leaf <span class="op">&lt;</span><span class="dv">6</span>, _.param_max_features <span class="op">&gt;</span><span class="dv">30</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_max_depth"</span>, y <span class="op">=</span> <span class="st">"value"</span>)) </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_boxplot(alpha <span class="op">=</span> <span class="fl">0.5</span>,size<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-52-63.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>cv_results <span class="op">=</span> pd.DataFrame(rf_gs.named_steps[<span class="st">'regressor'</span>].cv_results_)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  cv_results <span class="op">&gt;&gt;</span> <span class="bu">filter</span> ( _.mean_test_r2<span class="op">&gt;</span><span class="fl">0.8</span>)<span class="op">&gt;&gt;</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  select(_.param_max_depth, _.param_max_features, _.param_min_samples_leaf, </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>         _.param_min_samples_split, _.mean_test_r2) <span class="op">&gt;&gt;</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  pivot_longer(</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">"param_max_depth"</span>, <span class="st">"param_max_features"</span>, <span class="st">"param_min_samples_leaf"</span>, <span class="st">"param_min_samples_split"</span>],</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    names_to<span class="op">=</span><span class="st">"parameter"</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    values_to<span class="op">=</span><span class="st">"value"</span>) <span class="op">&gt;&gt;</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"value"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>)) <span class="op">+</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  geom_point(size <span class="op">=</span> <span class="fl">0.7</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  facet_wrap(<span class="st">"~parameter"</span>, scales <span class="op">=</span> <span class="st">"free_x"</span>) <span class="op">+</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parameter value"</span>) <span class="op">+</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"R^2 promedio"</span>) <span class="op">+</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de Random Forest vs R^2"</span>)</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-53-65.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>prep <span class="op">=</span> ColumnTransformer([</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'dummy'</span>, OneHotEncoder(drop <span class="op">=</span> <span class="st">'first'</span>,handle_unknown  <span class="op">=</span> <span class="st">'ignore'</span>, sparse_output <span class="op">=</span> <span class="va">False</span>), cat_cols),</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'selector'</span> , <span class="st">'passthrough'</span>, num_cols)],</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'drop'</span>,</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span>  rf_gs.named_steps[<span class="st">'regressor'</span>].best_estimator_</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocesado'</span>, prep),</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'rf'</span>, rf_model)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>rf_pipe.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('preprocesado',
                 ColumnTransformer(transformers=[('dummy',
                                                  OneHotEncoder(drop='first',
                                                                handle_unknown='ignore',
                                                                sparse_output=False),
                                                  ['MS_SubClass', 'MS_Zoning',
                                                   'Street', 'Alley',
                                                   'Lot_Shape', 'Land_Contour',
                                                   'Utilities', 'Lot_Config',
                                                   'Land_Slope', 'Neighborhood',
                                                   'Condition_1', 'Condition_2',
                                                   'Bldg_Type', 'House_Style',
                                                   'Overall_Cond', 'Roof_Style'...
                                                   'Latitude', 'Longitude',
                                                   'Lot_Area', 'Lot_Frontage',
                                                   'Mas_Vnr_Area', 'Misc_Val',
                                                   'Open_Porch_SF', 'Pool_Area',
                                                   'Screen_Porch',
                                                   'Second_Flr_SF',
                                                   'Three_season_porch',
                                                   'TotRms_AbvGrd',
                                                   'Total_Bsmt_SF',
                                                   'Wood_Deck_SF', 'Year_Built', ...])],
                                   verbose_feature_names_out=False)),
                ('rf',
                 RandomForestRegressor(max_depth=13, max_features=55,
                                       min_samples_leaf=3,
                                       min_samples_split=6))])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rf_pipe.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="bu">len</span>(rf_pipe.named_steps[<span class="st">'preprocesado'</span>].get_feature_names_out())</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>actual_mse <span class="op">=</span> get_metrics(y_pred, Sale_Price_test, p).iloc[<span class="dv">3</span>,<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="importance" class="level2">
<h2 class="anchored" data-anchor-id="importance">importance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>transformed_test_df <span class="op">=</span> rf_pipe.named_steps[<span class="st">'preprocesado'</span>].transform(ames_x_test)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> importance_from_model(</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  test_frame <span class="op">=</span> transformed_test_df ,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  y_obs <span class="op">=</span> Sale_Price_test,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  selected_columns <span class="op">=</span> <span class="bu">list</span>(rf_pipe.named_steps[<span class="st">'preprocesado'</span>].transform(ames_x_test).columns) ,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> rf_model,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  actual_mse <span class="op">=</span> actual_mse,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  n_permutations <span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  trans_pred <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>importance_df.to_csv(<span class="st">'importance_rf_1.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>transformed_test_df <span class="op">=</span> rf_pipe.named_steps[<span class="st">'preprocesado'</span>].transform(ames_x_test)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>vars_importance_order <span class="op">=</span> <span class="bu">list</span>( importance_df <span class="op">&gt;&gt;</span> arrange(_.Mean_Loss) <span class="op">&gt;&gt;</span> pull(<span class="st">'Variable'</span>))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> rf_pipe.named_steps[<span class="st">'preprocesado'</span>].transform(ames_x_train)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>v<span class="op">=</span>[]</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>r2<span class="op">=</span>[]</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>mse_<span class="op">=</span>[]</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>p<span class="op">=</span>[]</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">260</span>):</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  vars_to_train <span class="op">=</span> vars_importance_order[i:]</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  mf <span class="op">=</span> <span class="bu">max</span>(<span class="dv">55</span><span class="op">-</span>i, <span class="bu">round</span>(<span class="bu">len</span>(vars_to_train)<span class="op">**</span><span class="fl">0.5</span>))</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  rf <span class="op">=</span> RandomForestRegressor(max_depth<span class="op">=</span><span class="dv">13</span>, max_features<span class="op">=</span>mf, min_samples_leaf<span class="op">=</span><span class="dv">3</span>,min_samples_split<span class="op">=</span><span class="dv">6</span>, random_state<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>  p.append(<span class="bu">len</span>(vars_to_train))</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>  rf.fit(transformed_df[vars_to_train], Sale_Price_train)</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>  pred <span class="op">=</span> rf.predict(transformed_test_df[vars_to_train])</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>  mse_.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>])</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>  r2.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'R2Adj'</span>].values[<span class="dv">0</span>])</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>  v.append(vars_to_train)</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>idf <span class="op">=</span> pd.DataFrame({<span class="st">'MSE'</span>:mse_, <span class="st">'R2_adj'</span>:r2,<span class="st">'vars'</span>:v, <span class="st">'predictors'</span>:p})</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>idf.to_csv(<span class="st">'idf_rf.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.read_csv(<span class="st">'importance_rf_1.csv'</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>idf<span class="op">=</span>pd.read_csv(<span class="st">'idf_rf.csv'</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  idf </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &gt;&gt; filter(_.predictors&lt;150)</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>        cols<span class="op">=</span>[<span class="st">'MSE'</span>,<span class="st">'R2_adj'</span> ],names_to<span class="op">=</span><span class="st">'variables'</span>, values_to<span class="op">=</span><span class="st">'value'</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span><span class="st">'predictors'</span>, y<span class="op">=</span><span class="st">'value'</span>))</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  geom_point(alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  facet_wrap(<span class="st">'~variables'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-58-67.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  idf </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.predictors<span class="op">&lt;</span><span class="dv">80</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>        cols<span class="op">=</span>[<span class="st">'MSE'</span>,<span class="st">'R2_adj'</span> ],names_to<span class="op">=</span><span class="st">'variables'</span>, values_to<span class="op">=</span><span class="st">'value'</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span><span class="st">'predictors'</span>, y<span class="op">=</span><span class="st">'value'</span>))</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  geom_point(alpha <span class="op">=</span> <span class="fl">0.5</span>)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  geom_smooth(span<span class="op">=</span><span class="fl">.3</span>)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  facet_wrap(<span class="st">'~variables'</span>, ncol<span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span><span class="st">'free_y'</span>)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.
C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\smoothers.py:330: PlotnineWarning: Confidence intervals are not yet implemented for lowess smoothings.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-58-68.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  idf </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">&gt;&gt;</span> select(<span class="op">-</span>_.<span class="bu">vars</span>) </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">&gt;&gt;</span> mutate (MSE <span class="op">=</span> _.MSE.<span class="bu">round</span>(<span class="dv">2</span>), R2_adj <span class="op">=</span> _.R2_adj.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">&gt;&gt;</span> top_n(<span class="dv">10</span>, _.R2_adj)</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">&gt;&gt;</span> arrange(_.R2_adj, <span class="op">-</span>_.MSE)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Unnamed: 0            MSE  R2_adj  predictors
246         246 918444284.2000  0.8540          17
227         227 887972181.7600  0.8540          36
213         213 866871247.8400  0.8540          50
215         215 864542286.8600  0.8540          48
243         243 901578629.0100  0.8560          20
236         236 890659113.6700  0.8560          27
230         230 872852703.5900  0.8570          33
252         252 904374526.5900  0.8580          11
231         231 869935217.9500  0.8580          32
238         238 864469019.9100  0.8600          25
251         251 872848355.2800  0.8620          12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>bm_features <span class="op">=</span> [<span class="st">'Neighborhood_Stone_Brook'</span>, <span class="st">'Land_Contour_Low'</span>, <span class="st">'Lot_Shape_Regular'</span>, <span class="st">'BsmtFin_Type_1_Unf'</span>, <span class="st">'Neighborhood_Northridge_Heights'</span>, <span class="st">'Overall_Cond_Excellent'</span>, <span class="st">'BsmtFin_Type_1_No_Basement'</span>, <span class="st">'Paved_Drive_Paved'</span>, <span class="st">'Garage_Type_Detchd'</span>, <span class="st">'Bldg_Type_OneFam'</span>, <span class="st">'House_Style_Two_Story'</span>, <span class="st">'Garage_Finish_Unf'</span>, <span class="st">'Garage_Cond_Typical'</span>, <span class="st">'Heating_QC_Typical'</span>, <span class="st">'Bsmt_Exposure_No'</span>, <span class="st">'Kitchen_AbvGr'</span>, <span class="st">'MS_Zoning_Residential_Low_Density'</span>, <span class="st">'Central_Air_Y'</span>, <span class="st">'Bedroom_AbvGr'</span>, <span class="st">'MS_SubClass_Two_Story_1946_and_Newer'</span>, <span class="st">'Half_Bath'</span>, <span class="st">'Neighborhood_Crawford'</span>, <span class="st">'Bsmt_Unf_SF'</span>, <span class="st">'Foundation_CBlock'</span>, <span class="st">'BsmtFin_SF_1'</span>, <span class="st">'Bsmt_Exposure_Gd'</span>, <span class="st">'Longitude'</span>, <span class="st">'Roof_Style_Hip'</span>, <span class="st">'Lot_Frontage'</span>, <span class="st">'Wood_Deck_SF'</span>, <span class="st">'BsmtFin_Type_1_GLQ'</span>, <span class="st">'Bsmt_Full_Bath'</span>, <span class="st">'Roof_Style_Gable'</span>, <span class="st">'Full_Bath'</span>, <span class="st">'Open_Porch_SF'</span>, <span class="st">'Second_Flr_SF'</span>, <span class="st">'Foundation_PConc'</span>, <span class="st">'Mas_Vnr_Area'</span>, <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'Fireplaces'</span>, <span class="st">'Year_Remod_Add'</span>, <span class="st">'Lot_Area'</span>, <span class="st">'Latitude'</span>, <span class="st">'Garage_Area'</span>, <span class="st">'Year_Built'</span>, <span class="st">'Garage_Cars'</span>, <span class="st">'First_Flr_SF'</span>, <span class="st">'last_remod'</span>, <span class="st">'Total_Bsmt_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># (</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   idf       &gt;&gt; filter(_.predictors ==50 )</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             &gt;&gt; pull('vars')</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="co"># )[0]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>selector <span class="op">=</span> ColumnTransformer(</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'select'</span>, <span class="st">'passthrough'</span>, bm_features)],</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>).set_output(transform<span class="op">=</span><span class="st">'pandas'</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>rf_model <span class="op">=</span> RandomForestRegressor(</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>                  n_estimators <span class="op">=</span> <span class="dv">350</span>,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>                  n_jobs<span class="op">=</span><span class="dv">7</span>, </span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>                  max_depth<span class="op">=</span><span class="dv">13</span>, </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>                  max_features<span class="op">=</span><span class="dv">7</span>, </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>                  min_samples_leaf<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>                  min_samples_split<span class="op">=</span><span class="dv">6</span>, </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>                  random_state<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>rf_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocesado'</span>, prep),</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selector),</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'rf'</span>, rf_model)</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>rf_pipe.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('preprocesado',
                 ColumnTransformer(transformers=[('dummy',
                                                  OneHotEncoder(drop='first',
                                                                handle_unknown='ignore',
                                                                sparse_output=False),
                                                  ['MS_SubClass', 'MS_Zoning',
                                                   'Street', 'Alley',
                                                   'Lot_Shape', 'Land_Contour',
                                                   'Utilities', 'Lot_Config',
                                                   'Land_Slope', 'Neighborhood',
                                                   'Condition_1', 'Condition_2',
                                                   'Bldg_Type', 'House_Style',
                                                   'Overall_Cond', 'Roof_Style'...
                                                   'MS_SubClass_Two_Story_1946_and_Newer',
                                                   'Half_Bath',
                                                   'Neighborhood_Crawford',
                                                   'Bsmt_Unf_SF',
                                                   'Foundation_CBlock',
                                                   'BsmtFin_SF_1',
                                                   'Bsmt_Exposure_Gd',
                                                   'Longitude',
                                                   'Roof_Style_Hip',
                                                   'Lot_Frontage',
                                                   'Wood_Deck_SF', ...])],
                                   verbose_feature_names_out=False)),
                ('rf',
                 RandomForestRegressor(max_depth=13, max_features=7,
                                       min_samples_leaf=3, min_samples_split=6,
                                       n_estimators=350, n_jobs=7,
                                       random_state=8))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>importances_df <span class="op">=</span> pd.DataFrame({<span class="st">"Variable"</span> : rf_pipe.named_steps[<span class="st">'rf'</span>].feature_names_in_ , </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Importancia"</span> : rf_pipe.named_steps[<span class="st">'rf'</span>].feature_importances_})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  importances_df <span class="op">&gt;&gt;</span></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Importancia)'</span>, y <span class="op">=</span> <span class="st">"Importancia"</span>)) <span class="op">+</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-62-71.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rf_pipe.predict(ames_x_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [16] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_validation, predictors<span class="op">=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Value
Metric               
ME          3246.9911
MAE        18247.0356
MAPE           0.1084
MSE    885614267.2428
RMSE       29759.2720
R2             0.8688
R2Adj          0.8417</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> rf_pipe.predict(ames_x_val)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [16] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_validation, predictors<span class="op">=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Value
Metric               
ME          3246.9911
MAE        18247.0356
MAPE           0.1084
MSE    885614267.2428
RMSE       29759.2720
R2             0.8688
R2Adj          0.8417</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>