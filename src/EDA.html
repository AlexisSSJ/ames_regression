<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Uriel Alexis Luna López">

<title>EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="EDA_files/libs/clipboard/clipboard.min.js"></script>
<script src="EDA_files/libs/quarto-html/quarto.js"></script>
<script src="EDA_files/libs/quarto-html/popper.min.js"></script>
<script src="EDA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EDA_files/libs/quarto-html/anchor.min.js"></script>
<link href="EDA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EDA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EDA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EDA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EDA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EDA</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Uriel Alexis Luna López </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="analisís-de-las-variables" class="level1">
<h1>Analisís de las variables</h1>
<section id="descripción-de-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="descripción-de-las-variables">Descripción de las variables</h2>
<section id="variables-continuas-y-númericas" class="level3">
<h3 class="anchored" data-anchor-id="variables-continuas-y-númericas">Variables continuas y númericas</h3>
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 69%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th style="text-align: left;">Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lot_Frontage (Continua)</td>
<td style="text-align: left;">Loguitud que conectan la calle con la propiedad (en pies)</td>
</tr>
<tr class="even">
<td>Lot Area (Continua)</td>
<td style="text-align: left;">Tamaño del lote en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Mas Vnr Area (Continua)</td>
<td style="text-align: left;">Área de revestimiento de mampostería en pies cuadrados</td>
</tr>
<tr class="even">
<td>BsmtFin SF 1 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 1 en pies cuadrados</td>
</tr>
<tr class="odd">
<td>BsmtFin SF 2 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 2 en pies cuadrados</td>
</tr>
<tr class="even">
<td>Bsmt Unf SF (Continua)</td>
<td style="text-align: left;">Área sin terminar del sótano en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Total Bsmt SF (Continua)</td>
<td style="text-align: left;">Área total del sótano</td>
</tr>
<tr class="even">
<td>1st Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrqados del primer piso</td>
</tr>
<tr class="odd">
<td>2nd Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados del segundo piso</td>
</tr>
<tr class="even">
<td>Low Qual Area SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados terminados de baja calidad</td>
</tr>
<tr class="odd">
<td>Gr Liv Area (Continua)</td>
<td style="text-align: left;">Superficie habitable sobre el nivel del suelo en pies cuadrados</td>
</tr>
<tr class="even">
<td>Wood Deck SF (Continua)</td>
<td style="text-align: left;">Área de cubierta de madera en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Open Porch SF (Continua)</td>
<td style="text-align: left;">Área abierta del porche en pies cuadrados</td>
</tr>
<tr class="even">
<td>Enclose Porch (Continua)</td>
<td style="text-align: left;">Área cerrada del proche en pies cuadrados</td>
</tr>
<tr class="odd">
<td>3-Ssn Porch (Continua)</td>
<td style="text-align: left;">Área de porche de tres estaciones en pies cuadrados</td>
</tr>
<tr class="even">
<td>Screen Porch (Continua)</td>
<td style="text-align: left;">Área del porche cubierto en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Pool Area (Continua)</td>
<td style="text-align: left;">Área de la piscina en pies cuadrados</td>
</tr>
<tr class="even">
<td>Misc Val (Continua)</td>
<td style="text-align: left;">Valor de la característica miscelanea</td>
</tr>
<tr class="odd">
<td><strong>Sale_Price (Continua)</strong></td>
<td style="text-align: left;">Precio de venta.</td>
</tr>
<tr class="even">
<td>Year Built (Discreta)</td>
<td style="text-align: left;">Año original de construcción</td>
</tr>
<tr class="odd">
<td>Year Remod/Add (Discreta)</td>
<td style="text-align: left;">Fecha de remodelación (la misma que la fecha de construcción si no se ha remodelado)</td>
</tr>
<tr class="even">
<td>Bsmt Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos en el sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños en el sótano</td>
</tr>
<tr class="even">
<td>Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños sobre el nivel del suelo</td>
</tr>
<tr class="even">
<td>Kitchen (Discreta)</td>
<td style="text-align: left;">Concinas sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>TotRmsAbvGrd</td>
<td style="text-align: left;">Total de habitaciones sobre el nivel del suelo (no incluye baños)</td>
</tr>
<tr class="even">
<td>Fireplaces (Discreta)</td>
<td style="text-align: left;">Número de chimeneas</td>
</tr>
<tr class="odd">
<td>Garage Yr Blt (Discreta)</td>
<td style="text-align: left;">Año en que se construyó el garage</td>
</tr>
<tr class="even">
<td>Garage Cars (Discreta)</td>
<td style="text-align: left;">Tamaño del garage en cuanto a capacidad para autos.</td>
</tr>
<tr class="odd">
<td>Mo Sold (Discreta)</td>
<td style="text-align: left;">Mes de la venta (MM)</td>
</tr>
<tr class="even">
<td>Yr Sold (Discreta)</td>
<td style="text-align: left;">Año de la venta (YYYY)</td>
</tr>
</tbody>
</table>
</section>
<section id="varaibles-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="varaibles-categóricas">Varaibles categóricas</h3>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MS_Subclass (Nominal)</td>
<td>Identifica el tipo de vivienda de la venta</td>
</tr>
<tr class="even">
<td>MS_Zoning (Nominal)</td>
<td>Identifica la clasificación de la zona asociada a la venta</td>
</tr>
<tr class="odd">
<td>Street (Nominal)</td>
<td>Tipo de camino de acceso a la propiedad</td>
</tr>
<tr class="even">
<td>Alley (Nominal)</td>
<td>Tipo de callejón de acceso a la propiedad</td>
</tr>
<tr class="odd">
<td>Lot Contour (Nominal)</td>
<td>Planitud de la propiedad</td>
</tr>
<tr class="even">
<td>Lot Config (Nominal)</td>
<td>Configurarición del lote</td>
</tr>
<tr class="odd">
<td>Neightboorhood (Nominal)</td>
<td>Ubicación física dentro de los límites de la ciudad de Ames</td>
</tr>
<tr class="even">
<td>Condition 1 (Nominal)</td>
<td>Proximidad a varias condiciones</td>
</tr>
<tr class="odd">
<td>Condition 2 (Nominal)</td>
<td>Proximidad a varias condiciones (Si más de una es presente)</td>
</tr>
<tr class="even">
<td>Bldg Type (Nominal)</td>
<td>Tipo de vivienda</td>
</tr>
<tr class="odd">
<td>House Style (Nominal)</td>
<td>Estilo de la vivienda</td>
</tr>
<tr class="even">
<td>Roof Style (Nominal)</td>
<td>Tipo de techo</td>
</tr>
<tr class="odd">
<td>Roof Matl (Nominal)</td>
<td>Material del techo</td>
</tr>
<tr class="even">
<td>Exterior 1 (Nominal)</td>
<td>Revestimiento exterior de la casa</td>
</tr>
<tr class="odd">
<td>Exterior 2 (Nominal)</td>
<td>Revestimiento exterior de la casa (Si hay más de un material)</td>
</tr>
<tr class="even">
<td>Mas Vnr Type (Nominal)</td>
<td>Tipo de revestimiento de mampostería</td>
</tr>
<tr class="odd">
<td>Foundation (Nominal)</td>
<td>Tipo de cimentación</td>
</tr>
<tr class="even">
<td>Heating (Nominal)</td>
<td>Tipo de calefacción</td>
</tr>
<tr class="odd">
<td>Central Air (Nominal)</td>
<td>Aire acondicionado centralizado</td>
</tr>
<tr class="even">
<td>Garage Type (Nominal)</td>
<td>Ubicación del garage</td>
</tr>
<tr class="odd">
<td>Misc Feature (Nominal)</td>
<td>Característica miscelánea no cubierta en otras categorías</td>
</tr>
<tr class="even">
<td>Sale Type (Nominal)</td>
<td>Tipo de venta</td>
</tr>
<tr class="odd">
<td>Sale Condition (Nominal)</td>
<td>Condicón de la venta.</td>
</tr>
<tr class="even">
<td>Functional (Ordinal)</td>
<td>Funcionalidad del hogar (suponga que es típico a menos que se justifiquen deducciones)</td>
</tr>
<tr class="odd">
<td>FireplaceQu (Ordinal)</td>
<td>Calidad de las chimeneas</td>
</tr>
<tr class="even">
<td>Lot Shape (Ordinal)</td>
<td>Forma general de la propiedad</td>
</tr>
<tr class="odd">
<td>Pool QC (Ordinal)</td>
<td>Calidad de la piscina</td>
</tr>
<tr class="even">
<td>Utilities (Ordinal)</td>
<td>Tipo de utilidades disponibles</td>
</tr>
<tr class="odd">
<td>Land Slope (Ordinal)</td>
<td>Pendiente de la propiedad</td>
</tr>
<tr class="even">
<td>Overall Qual (Ordinal)</td>
<td>Califica el material general y el acabado de la casa.</td>
</tr>
<tr class="odd">
<td>Overall Cond (Ordinal)</td>
<td>Califica la condición general de la casa</td>
</tr>
<tr class="even">
<td>Exter Qual (Ordinal)</td>
<td>Evalua la calidad materiales de los exteriores</td>
</tr>
<tr class="odd">
<td>Exter Cond (Ordinal)</td>
<td>Evalua la condición presente del materia en el exterior</td>
</tr>
<tr class="even">
<td>Bsmt Qua (Ordinal)</td>
<td>Evalua la altura del sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Cond (Ordinal)</td>
<td>Evalua la condición general del sótano</td>
</tr>
<tr class="even">
<td>Bsmt Exposure (Ordinal)</td>
<td>Se refiere a paredes a nivel de jardín o de salida</td>
</tr>
<tr class="odd">
<td>BsmtFin Type 1 (Ordinal)</td>
<td>Calificación del area terminada del sótano</td>
</tr>
<tr class="even">
<td>BsmtFin Type 2 (Ordinal)</td>
<td>Clasificación del área terminada del sótano (si hay varios tipos)</td>
</tr>
<tr class="odd">
<td>Heating QC (Ordinal)</td>
<td>Calidad y condición de la calefacción</td>
</tr>
<tr class="even">
<td>Electrical (Ordinal)</td>
<td>Sistema electrico</td>
</tr>
<tr class="odd">
<td>Kitchen Qaul (Ordinal)</td>
<td>Calidad de la cocina</td>
</tr>
<tr class="even">
<td>Garage Qual (Ordinal)</td>
<td>Calidad del Garage</td>
</tr>
<tr class="odd">
<td>Garage cond (Ordinal)</td>
<td>Condicón del garage</td>
</tr>
<tr class="even">
<td>Paved Drive (Ordinal)</td>
<td>Camino pavimentado.</td>
</tr>
<tr class="odd">
<td>Garage Finish (Ordnal)</td>
<td>El interior del garage esta terminado</td>
</tr>
<tr class="even">
<td>Fence (Ordinal)</td>
<td>Calidad de la cerca.</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="analísis-de-sale-price" class="level2">
<h2 class="anchored" data-anchor-id="analísis-de-sale-price">Analísis de Sale Price</h2>
<p>A continuación se muestra el split inicial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.one_table_verbs <span class="im">import</span> pull</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mizani.formatters <span class="im">import</span> comma_format, dollar_format</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>ames <span class="op">=</span> pd.read_csv(<span class="st">"../data/ames.csv"</span>) <span class="op">&gt;&gt;</span> mutate (Price_4_GLA<span class="op">=</span> _.Sale_Price<span class="op">/</span>_.Gr_Liv_Area)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ames <span class="op">&gt;&gt;</span>  pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> select(ames, <span class="op">-</span>_.Sale_Price, <span class="op">-</span>_.Price_4_GLA)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>(X <span class="op">&gt;&gt;</span> mutate(wood_prop<span class="op">=</span> _.Wood_Deck_SF<span class="op">/</span>_.Gr_Liv_Area,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>              area_per_car<span class="op">=</span>case_when({</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                              _.Garage_Cars <span class="op">==</span> <span class="dv">0</span>:<span class="dv">0</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                              <span class="va">True</span>:_.Garage_Area<span class="op">/</span> _.Garage_Cars}),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>              last_remod <span class="op">=</span> case_when({</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                              _.Year_Built<span class="op">&gt;</span>_.Year_Remod_Add: <span class="dv">2023</span><span class="op">-</span>_.Year_Remod_Add,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                              <span class="va">True</span>: <span class="dv">2023</span><span class="op">-</span>_.Year_Built}),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>              Mo_Sold<span class="op">=</span> _.Mo_Sold.astype(<span class="st">'object'</span>)))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>numeric_column <span class="op">=</span> ames <span class="op">&gt;&gt;</span> pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>quartiles <span class="op">=</span> np.percentile(numeric_column, [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>])</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una nueva variable categórica basada en los cuartiles</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a> numeric_column, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>ames_x_train, ames_x, ames_y_train, ames_y <span class="op">=</span> train_test_split(</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                       X, y, </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                       test_size <span class="op">=</span> <span class="fl">0.30</span>, </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a> ames_y , </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>ames_x_test, ames_x_val, ames_y_test, ames_y_val <span class="op">=</span> train_test_split(</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>       ames_x, ames_y, </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>       test_size <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>Sale_Price_train <span class="op">=</span> ames_y_train <span class="op">*</span> ames_x_train.Gr_Liv_Area</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>Sale_Price_test <span class="op">=</span> ames_y_test <span class="op">*</span> ames_x_test.Gr_Liv_Area</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>Sale_Price_validation <span class="op">=</span> ames_y_val <span class="op">*</span> ames_x_val.Gr_Liv_Area</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Totales:</span><span class="ch">\t</span><span class="st">'</span>, ames.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Training:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_train.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Testing:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_test.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Validation:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_val.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Totales:     2930 
Training:    2051 
Testing:     586 
Validation:  293</code></pre>
</div>
</div>
<p>Cómo se observa, la distribución de los precios de venta se encuentra sesgada a la derecha, tienendo el 75% de las casas vendidas a un precio menor a $212,075 y aclumulando un la mitad de estos entre $129K y 212K. También en el siguiente qqplot podemos ver que la distribución de los precios de venta no parece seguir una distribución normal.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure()</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>Sale_Price, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                annotate(<span class="st">'text'</span>,x<span class="op">=</span><span class="fl">0.3</span>,y<span class="op">=</span><span class="dv">500000</span>, label<span class="op">=</span>summary,ymax<span class="op">=</span><span class="dv">400000</span>)<span class="op">+</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_dist-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qqplot_Sale_Price-3.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>A diferencia de la distribución de los precios se venta de la casa, el precio por pie cuadrado habitable de la casa parece tener un comportamiento más normal:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> <span class="st">"count: 2344</span><span class="ch">\n</span><span class="st">mean: $180,996.79</span><span class="ch">\n</span><span class="st">std: $81,186.69</span><span class="ch">\n</span><span class="st">Q1: $129,500</span><span class="ch">\n</span><span class="st">Q2:$160,000</span><span class="ch">\n</span><span class="st">Q3: $213,492.50</span><span class="ch">\n</span><span class="st">min: $12,789</span><span class="ch">\n</span><span class="st">max:$755,000"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure()</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">2051</span>)<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                <span class="co"># annotate('text',x=0.3,y=500000, label=summary,ymax=400000)+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_GLA_DIST-5.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>params<span class="op">=</span>{<span class="st">'loc'</span>:ames_y_train.mean(), <span class="st">'scale'</span>:ames_y_train.std()}</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                ggplot(aes(sample<span class="op">=</span>ames_y_train))<span class="op">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>,distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params)<span class="op">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                stat_qq_line(distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params,color <span class="op">=</span> <span class="st">"red"</span>)<span class="op">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                xlab(<span class="st">"Cuantilies de la dist. normal teórica"</span>) <span class="op">+</span> ylab(<span class="st">"Cuantiles de Sale Price"</span>) <span class="op">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">"QQ-Plot N~(mean=180,996.79, sd=81,186.69)"</span>)<span class="op">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                theme_seaborn()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qq%20plot%20new%20y-7.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-continuas-vs-transformación-de-sale_price" class="level2">
<h2 class="anchored" data-anchor-id="variables-continuas-vs-transformación-de-sale_price">Variables Continuas VS Transformación de Sale_Price</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ames_train <span class="op">=</span> ames_x_train.copy()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ames_train[<span class="st">'Sale_Price/Gr_Liv_Area'</span>] <span class="op">=</span> ames_y_train</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>correlation_data <span class="op">=</span> (</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().melt(  ignore_index<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                                        var_name<span class="op">=</span><span class="st">'var1'</span>).reset_index() <span class="op">&gt;&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                    select( _.var1,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                            _.var2 <span class="op">==</span> _.index,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                            _.cor <span class="op">==</span> _.value  ) </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>labels<span class="op">=</span>(</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span> case_when({_.cor.between(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>):<span class="st">''</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                                    _.cor<span class="op">&gt;</span><span class="fl">0.99991</span>: <span class="st">''</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="va">True</span> :_.cor.<span class="bu">round</span>(<span class="dv">2</span>).astype(<span class="bu">str</span>)})</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        arrange(<span class="op">-</span>_.cor,_.var1) <span class="op">&gt;&gt;</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter (_.var1!=_.var2) &gt;&gt;</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        mutate(labb<span class="op">=</span>labels)<span class="op">&gt;&gt;</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        ggplot(aes(x<span class="op">=</span><span class="st">'var1'</span>, y<span class="op">=</span><span class="st">'var2'</span>, fill<span class="op">=</span> <span class="st">'cor'</span>))<span class="op">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        geom_tile()<span class="op">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        geom_label(aes(label<span class="op">=</span><span class="st">'labb'</span>), size<span class="op">=</span><span class="dv">6</span>)<span class="op">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        scale_fill_gradientn(colors<span class="op">=</span>[<span class="st">'#0092ff'</span>,<span class="st">'#e6d6c7'</span>,<span class="st">'#FF1400'</span>],</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                            limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                            name<span class="op">=</span><span class="st">'Correlación'</span>)<span class="op">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>        ggtitle(<span class="st">'Mapa de calor de correlaciones para variables continuas'</span>)<span class="op">+</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>        xlab(<span class="st">''</span>)<span class="op">+</span>ylab(<span class="st">''</span>)<span class="op">+</span><span class="co">#guides(fill=guide_legend(title="New Legend Title"))+</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>        theme(axis_text_x<span class="op">=</span>element_text(rotation<span class="op">=</span><span class="dv">90</span>,hjust <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>                figure_size<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_heatmap_HCC-9.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Como podemos observar para ser que las varaibles de <code>'BsmtFin_SF_1', 'First_Flr_SF', 'Second_Flr_SF', 'Total_Bsmt_SF'</code> son las que tienen correlaciones más grandes con el precio de venta por el precio por pie cuadrado habitable. En el gráfico sólo se muestran etiquetas de correlaciones que no estan en el intervalo (-0.3.0.3).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().reset_index(drop<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> select(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>],_.index)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>] <span class="op">!=</span> <span class="dv">1</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> mutate (labels <span class="op">=</span> np.<span class="bu">round</span>(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>], <span class="dv">3</span>))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> arrange(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>])</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>, x<span class="op">=</span><span class="st">'index'</span>, fill<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_col()</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(aes(label <span class="op">=</span> <span class="st">'labels'</span>) , size<span class="op">=</span><span class="dv">8</span>, va<span class="op">=</span><span class="st">'center'</span>, angle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> ylim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area vs otras variables'</span>, y<span class="op">=</span><span class="st">''</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_fill_gradient2(low<span class="op">=</span><span class="st">'#4EB043'</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                           mid<span class="op">=</span><span class="st">'#B05F43'</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                           high<span class="op">=</span> <span class="st">'#3A3AD5'</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                           midpoint<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                           limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                           name<span class="op">=</span><span class="st">'Correlación'</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme_bw()</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_sp/gla-11.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="precios-dependiendo-la-ubicación" class="level2">
<h2 class="anchored" data-anchor-id="precios-dependiendo-la-ubicación">Precios dependiendo la ubicación</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>colors<span class="op">=</span>[<span class="st">'#EC00FF'</span> ,<span class="st">'#0028F1'</span>,<span class="st">'#00F104'</span>,<span class="st">'#FF2D00'</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>(ames_train <span class="op">&gt;&gt;</span> ggplot(aes(x<span class="op">=</span><span class="st">'Latitude'</span>, y<span class="op">=</span><span class="st">'Longitude'</span>, color<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>)) <span class="op">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                geom_point(alpha<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="fl">1.5</span>, stroke<span class="op">=</span><span class="dv">1</span>, shape<span class="op">=</span><span class="st">'2'</span>)<span class="op">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                labs(title<span class="op">=</span><span class="st">'Precios dependiendo de la ubicación geografica'</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                    colour<span class="op">=</span><span class="st">'Precio de venta'</span>, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                    y<span class="op">=</span><span class="st">'Longuitud'</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                    x<span class="op">=</span> <span class="st">'Latidud'</span>)<span class="op">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                scale_color_gradientn(colors<span class="op">=</span>colors,labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span> theme_538()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/price%20por%20ubi-13.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  ames_train </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> group_by(_.Neighborhood) </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> summarize(media <span class="op">=</span> np.mean(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]), desv<span class="op">=</span>np.std(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> mutate( max_err <span class="op">=</span> _.media  <span class="op">+</span> _.desv, min_err <span class="op">=</span>  _.media  <span class="op">-</span> _.desv)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> arrange(_.media)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot(aes(x<span class="op">=</span><span class="st">'reorder(Neighborhood,media)'</span>, y<span class="op">=</span><span class="st">'media'</span>) ) </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),width<span class="op">=</span><span class="fl">0.3</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>))<span class="op">+</span>geom_point()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_bw()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>coord_flip()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>labs(y<span class="op">=</span><span class="st">'Precio  promedio por pie cuadrado de área habitable'</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/error_bars%20por%20vecindario-15.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-relacionadas-con-el-sótano" class="level2">
<h2 class="anchored" data-anchor-id="variables-relacionadas-con-el-sótano">Variables relacionadas con el sótano</h2>
<p>Se puede ver que se tiene una relación líneal creciente entre <code>Total_Bsmt_SF</code> y <code>Sale_Price\ Gr_Liv_Area</code>, en la siguiente gráfica tambien podemos ver como varios puntos se acumulan en <code>Total_Bsmt_SF = 0</code> debido a que estas casas no cuentan con sótano</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ames_x_train </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot( aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_point(size<span class="op">=</span><span class="dv">1</span>,alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">2500</span>])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Total_Bsmt_SF vs  Sale Price/ Gr_Liv_Area'</span>, x<span class="op">=</span><span class="st">'Total_Bsmt_SF'</span>, y<span class="op">=</span><span class="st">'Sale Price/ Gr_Liv_Area'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_538()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/price%20vs%20sf%20sotano-17.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>En cuanto a las variables categóricas relacionadas al sótano encontramos lo siguiente:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cat_columns <span class="op">=</span> pd.Series([<span class="st">'Bldg_Type'</span>, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Exposure'</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Central_Air'</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1'</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2'</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical'</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence'</span>, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation'</span>, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish'</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type'</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Feature'</span>, </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive'</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC'</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Overall_Cond'</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass'</span>, </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_Zoning'</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond'</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1'</span>, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2'</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style'</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Shape'</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood'</span>])</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> cat_columns[cat_columns.<span class="bu">str</span>.contains(<span class="st">'Bsmt'</span>)]:</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  titulo<span class="op">=</span><span class="st">'Categoría analazada: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category) </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  (ames_train  <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area'</span>, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>, color<span class="op">=</span> <span class="st">'</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category)))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> geom_point(alpha<span class="op">=</span> <span class="fl">0.5</span>, show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">3000</span>])</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>labs(x<span class="op">=</span><span class="st">'Área total del sótano'</span>, y<span class="op">=</span><span class="st">'Precio por pie cuadrado de área habitable bruta'</span>, title<span class="op">=</span>titulo)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> facet_wrap(<span class="st">'~</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category))<span class="op">+</span>theme_538 ()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-19.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-20.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-21.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-22.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Puntos a considerar:</p>
<ul>
<li><p>En <code>Bsmt_Exposure</code> se puede notar que la relación positiva entre las variables se mantiene, y no parece cambiar si se altera la exposicón del sótano. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
<li><p>En <code>Bsmt_Cond</code> se puede ver que la relación de las variables si cambia dependiendo de la condición del sótano, además en la condición de Excellent y Poor se tienen muy pocas observaciones.</p></li>
<li><p>En <code>Bsmt_Type_1</code> se tienen relaciones demaciado planas en su mayoria, a excepción de GLQ y Unf.</p></li>
<li><p>En <code>Bsmt_Type_2</code> se tiene el mismo caso que en el anterior. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
</ul>
</section>
</section>
<section id="regresión-líneal" class="level1">
<h1>Regresión Líneal</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> importance_from_model (test_frame, y_obs, selected_columns, pipeline, actual_mse, n_permutations<span class="op">=</span><span class="dv">50</span> ,trans_pred<span class="op">=</span> <span class="va">False</span> ):</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  performance_losses <span class="op">=</span> []</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_frame[selected_columns].shape[<span class="dv">1</span>]):</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> []</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_permutations):</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        test_frame_permuted <span class="op">=</span> test_frame[selected_columns].copy()</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        test_frame_permuted.iloc[:, i] <span class="op">=</span> np.random.permutation(test_frame_permuted.iloc[:, i])</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> trans_pred <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>            y_pred_permuted <span class="op">=</span> pipeline.predict(test_frame_permuted)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>            y_pred_permuted <span class="op">=</span> pipeline.predict(test_frame_permuted)<span class="op">*</span> test_frame_permuted.Gr_Liv_Area</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        mse_permuted <span class="op">=</span> mean_squared_error(y_obs, y_pred_permuted)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        loss.append(mse_permuted)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    performance_losses.append(loss)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  performance_losses <span class="op">=</span> performance_losses<span class="op">/</span>np.<span class="bu">sum</span>(performance_losses, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  mean_losses <span class="op">=</span> np.mean(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  std_losses <span class="op">=</span> np.std(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Variable'</span>: selected_columns, </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Mean_Loss'</span>: mean_losses, </span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Std_Loss'</span>: std_losses</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> importance_df</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjusted_r2_score(y_true, y_pred, n, p):</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  adjusted_r2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> r2) <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> adjusted_r2 </span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> div_columns(X, c1, c2):</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    X[<span class="st">"c1_c2"</span>] <span class="op">=</span> X[c1]<span class="op">/</span> X[c2]</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adj_r(y_o, y_p , p, n):</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>  r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2_score(y_o, y_p))</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_metrics (y_pred, y_obs,predictors):</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>  mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred)</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  mse <span class="op">=</span> mean_squared_error(y_obs, y_pred)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_obs, y_pred)</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  n <span class="op">=</span> <span class="bu">len</span>(y_obs)  <span class="co"># Número de observaciones</span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> predictors  <span class="co"># Número de predictores </span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2)</span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  metrics_data <span class="op">=</span> {</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R2"</span>, <span class="st">"R2Adj"</span>],</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pd.DataFrame(metrics_data).set_index(<span class="st">'Metric'</span>)</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmv_elements (list_of_elements, complete_list):</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> element <span class="kw">in</span> list_of_elements:</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    complete_list.remove(element)</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> complete_list</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> validation_results(x_val,y_val,  pipeline , n_preds):</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> pipeline.predict(x_val)</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>  ames_test <span class="op">=</span> (</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>    ames_x_val <span class="op">&gt;&gt;</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>    mutate(Sale_Price_Pred <span class="op">=</span> y_pred<span class="op">*</span>_.Gr_Liv_Area, Sale_Price <span class="op">=</span>y_val<span class="op">*</span>_.Gr_Liv_Area))</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>  <span class="co">##### Métricas de desempeño</span></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> get_metrics(y_pred, y_obs, n_preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>A continuación se muestra el modelo de regresión líneal que tuvo un mejor performance de acuerdo a las variables que se estudiaron:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span><span class="bu">sorted</span>( [<span class="st">'Wood_Deck_SF'</span>, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'First_Flr_SF'</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fireplaces'</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Open_Porch_SF'</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Enclosed_Porch'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Area'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wood_prop'</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Total_Bsmt_SF'</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Area'</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Gr_Liv_Area'</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'area_per_car'</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'last_remod'</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Full_Bath'</span>, </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Three_season_porch'</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_1'</span>, </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_2'</span>, </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Unf_SF'</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Half_Bath'</span>, </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Full_Bath'</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Kitchen_AbvGr'</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Half_Bath'</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mas_Vnr_Area'</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Val'</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bedroom_AbvGr'</span>])</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">'Bldg_Type'</span>, </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Exposure'</span>, </span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Central_Air'</span>,<span class="st">'Mo_Sold'</span>, </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1'</span>, </span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2'</span>, </span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical'</span>, </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mas_Vnr_Type'</span>,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence'</span>, </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Exter_Cond'</span>,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation'</span>, </span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish'</span>, </span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type'</span>, </span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Misc_Feature', </span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive'</span>, </span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC'</span>,</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Overall_Cond'</span>,</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass'</span>, </span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond'</span>,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1'</span>, </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2'</span>, </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style'</span>,</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Shape'</span>, <span class="co">#'Roof_Style'</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood'</span>]</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>columnas_seleccionadas <span class="op">=</span> num_cols <span class="op">+</span> <span class="bu">sorted</span>(cat_cols <span class="op">+</span> [<span class="st">'Year_Built'</span>,<span class="st">'Garage_Cars'</span>,<span class="st">'Misc_Feature'</span>])</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> ColumnSelector(columnas_seleccionadas)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>ames_x_train_selected <span class="op">=</span> pipe.fit_transform(ames_x_train)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>ames_train_selected <span class="op">=</span> pd.DataFrame(</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  ames_x_train_selected, </span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  columns <span class="op">=</span> columnas_seleccionadas</span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>ames_test_selected <span class="op">=</span> pd.DataFrame(</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>  pipe.transform(ames_x_test), </span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  columns <span class="op">=</span> columnas_seleccionadas</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>ames_validation_selected <span class="op">=</span> pd.DataFrame(</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>  pipe.transform(ames_x_val), </span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>  columns <span class="op">=</span> columnas_seleccionadas</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a><span class="co">#######################################################################</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>preprocessor_1 <span class="op">=</span> ColumnTransformer(</span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler(), num_cols),</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'imputer'</span>,  SimpleImputer(missing_values<span class="op">=</span>np.nan, strategy<span class="op">=</span><span class="st">'mean'</span>), [<span class="st">'Year_Built'</span>,<span class="st">'Garage_Cars'</span>]),</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'OHE'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown<span class="op">=</span><span class="st">'ignore'</span> , sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency<span class="op">=</span><span class="dv">20</span>), cat_cols),</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'OHE_1'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown<span class="op">=</span><span class="st">'ignore'</span> , sparse_output<span class="op">=</span><span class="va">False</span>), [<span class="st">'Misc_Feature'</span>])</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>  <span class="co"># Mantener las columnas restantes sin cambios</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>ames_x_train_trans <span class="op">=</span> pd.DataFrame(</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  preprocessor_1.fit_transform(ames_train_selected),</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>preprocessor_1.get_feature_names_out()</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>ames_x_test_trans <span class="op">=</span> pd.DataFrame(</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  preprocessor_1.transform(ames_test_selected),</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>preprocessor_1.get_feature_names_out()</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [5, 7, 16] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ames_x_val_trans <span class="op">=</span> pd.DataFrame(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  preprocessor_1.transform(ames_validation_selected),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>preprocessor_1.get_feature_names_out()</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PolynomialFeatures</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>interaction_transformer <span class="op">=</span> PolynomialFeatures(degree <span class="op">=</span> <span class="dv">2</span>, interaction_only <span class="op">=</span> <span class="va">True</span>, include_bias <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>interaction_transformer_wb <span class="op">=</span> PolynomialFeatures(degree <span class="op">=</span> <span class="dv">2</span>, interaction_only <span class="op">=</span> <span class="va">True</span>, include_bias <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>drop_cols<span class="op">=</span>[<span class="st">'Neighborhood_Crawford'</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood_infrequent_sklearn'</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1_BLQ'</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Exter_Cond_Good'</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_2_Feedr',</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1_RRAe'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_1_Feedr',</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type_No_Garage'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_1_PosA',</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Full_Bath'</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Half_Bath'</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Condition_2_RRAe',</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_CBlock'</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass_Two_Story_1946_and_Newer'</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish_No_Garage'</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bldg_Type_TwoFmCon'</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_5'</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive_Partial_Pavement'</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_Typical'</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC_Fair'</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1_Unf'</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical_SBrkr'</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence_Good_Wood'</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>            <span class="co"># 'Electrical_Unknown',</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type_Detchd'</span>,</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_Slab'</span>,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style_infrequent_sklearn'</span>,</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Three_season_porch'</span>,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2_GLQ'</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_7'</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Val'</span>,</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1_No_Basement'</span>,</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_PConc'</span>,</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_12'</span>,</span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_10'</span>,</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2_No_Basement'</span>,</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>            <span class="st">'last_remod'</span>,</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_No_Basement'</span>,</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2_infrequent_sklearn'</span>,</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Exter_Cond_Typical'</span>,</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bldg_Type_OneFam'</span>,</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mo_Sold_9'</span>,</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical_infrequent_sklearn'</span>,</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_infrequent_sklearn'</span>,</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond_Good'</span>,</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation_infrequent_sklearn'</span>,</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bldg_Type_TwnhsE'</span>,</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence_No_Fence'</span>]</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>preprocessor_2<span class="op">=</span>ColumnTransformer(</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  transformers<span class="op">=</span>[</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"selector"</span>, <span class="st">"drop"</span>, drop_cols),</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interaction_1'</span>, interaction_transformer_wb, [<span class="st">'Lot_Area'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions2'</span>, interaction_transformer, [<span class="st">'Year_Built'</span>, <span class="st">'Overall_Cond_Average'</span>]),</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3'</span>, interaction_transformer, [<span class="st">'Full_Bath'</span>, <span class="st">'Bedroom_AbvGr'</span>]),</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.1'</span>, interaction_transformer, [<span class="st">'House_Style_SLvl'</span>, <span class="st">'Overall_Cond_Fair'</span>]),</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.4'</span>, interaction_transformer, [<span class="st">'wood_prop'</span>, <span class="st">'Mas_Vnr_Area'</span>]),</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.2'</span>, interaction_transformer, [<span class="st">'First_Flr_SF'</span>, <span class="st">'last_remod'</span>]),</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions3.5'</span>, interaction_transformer, [<span class="st">'BsmtFin_SF_1'</span>, <span class="st">'BsmtFin_Type_2_Unf'</span>]),</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'interactions4'</span>, interaction_transformer, [<span class="st">'Misc_Val'</span>, <span class="st">'Misc_Feature_TenC'</span>])</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'passthrough'</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>preprocessor_2.fit(ames_x_train_trans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ColumnTransformer(remainder='passthrough',
                  transformers=[('selector', 'drop',
                                 ['Neighborhood_Crawford',
                                  'Neighborhood_infrequent_sklearn',
                                  'BsmtFin_Type_1_BLQ', 'Exter_Cond_Good',
                                  'Condition_1_RRAe', 'Garage_Type_No_Garage',
                                  'Bsmt_Full_Bath', 'Bsmt_Half_Bath',
                                  'Foundation_CBlock',
                                  'MS_SubClass_Two_Story_1946_and_Newer',
                                  'Garage_Finish_No_Garage',
                                  'Bldg_Type_TwoF...
                                 PolynomialFeatures(include_bias=False,
                                                    interaction_only=True),
                                 ['First_Flr_SF', 'last_remod']),
                                ('interactions3.5',
                                 PolynomialFeatures(include_bias=False,
                                                    interaction_only=True),
                                 ['BsmtFin_SF_1', 'BsmtFin_Type_2_Unf']),
                                ('interactions4',
                                 PolynomialFeatures(include_bias=False,
                                                    interaction_only=True),
                                 ['Misc_Val', 'Misc_Feature_TenC'])],
                  verbose_feature_names_out=False)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> <span class="bu">list</span>(preprocessor_2.get_feature_names_out())</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">##### Extracción de coeficientes</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  preprocessor_2.fit_transform(ames_x_train_trans ),</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  columns<span class="op">=</span>feature_names</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>X_train_with_intercept <span class="op">=</span> sm.add_constant(transformed_df)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(ames_y_train, X_train_with_intercept).fit()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>model.summary()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'statsmodels.iolib.summary.Summary'&gt;
"""
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       0.813
Model:                            OLS   Adj. R-squared:                  0.802
Method:                 Least Squares   F-statistic:                     71.23
Date:              jue., 02 nov. 2023   Prob (F-statistic):               0.00
Time:                        16:50:28   Log-Likelihood:                -8275.9
No. Observations:                2051   AIC:                         1.679e+04
Df Residuals:                    1932   BIC:                         1.746e+04
Df Model:                         118                                         
Covariance Type:            nonrobust                                         
=========================================================================================================================
                                                            coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------------------------------------
const                                                  9954.2028   2.81e+04      0.354      0.723   -4.51e+04     6.5e+04
Lot_Area                                                  1.9088      0.461      4.141      0.000       1.005       2.813
Gr_Liv_Area                                              -7.2262      1.230     -5.876      0.000      -9.638      -4.814
Lot_Area Gr_Liv_Area                                     -1.0539      0.224     -4.705      0.000      -1.493      -0.615
Year_Built                                               -5.0423     14.247     -0.354      0.723     -32.983      22.898
Overall_Cond_Average                                   -267.5837     67.303     -3.976      0.000    -399.578    -135.590
Year_Built Overall_Cond_Average                           0.1340      0.034      3.916      0.000       0.067       0.201
Full_Bath                                                 0.7345      0.564      1.303      0.193      -0.371       1.840
Bedroom_AbvGr                                            -2.3131      0.478     -4.841      0.000      -3.250      -1.376
Full_Bath Bedroom_AbvGr                                   1.3369      0.293      4.556      0.000       0.761       1.912
House_Style_SLvl                                        -14.2743      5.848     -2.441      0.015     -25.742      -2.806
Overall_Cond_Fair                                       -23.1655      2.600     -8.910      0.000     -28.264     -18.067
House_Style_SLvl Overall_Cond_Fair                    -6.926e-13   1.28e-13     -5.418      0.000   -9.43e-13   -4.42e-13
wood_prop                                                 4.4576      1.179      3.782      0.000       2.146       6.769
Mas_Vnr_Area                                              3.5298      0.525      6.722      0.000       2.500       4.560
wood_prop Mas_Vnr_Area                                    1.1337      0.401      2.828      0.005       0.348       1.920
First_Flr_SF                                             -5.4836      1.169     -4.690      0.000      -7.776      -3.191
last_remod                                             -161.0307    430.727     -0.374      0.709   -1005.770     683.708
First_Flr_SF last_remod                                  -2.7332      0.528     -5.175      0.000      -3.769      -1.697
BsmtFin_SF_1                                              1.6247      1.395      1.165      0.244      -1.111       4.361
BsmtFin_Type_2_Unf                                      -10.6163      2.915     -3.642      0.000     -16.333      -4.900
BsmtFin_SF_1 BsmtFin_Type_2_Unf                          -1.8007      1.391     -1.295      0.196      -4.528       0.927
Misc_Val                                                  0.0354      0.997      0.036      0.972      -1.920       1.991
Misc_Feature_TenC                                        10.9746      3.211      3.418      0.001       4.678      17.271
Misc_Val Misc_Feature_TenC                               32.7714      9.587      3.418      0.001      13.969      51.574
BsmtFin_SF_2                                             -1.5239      0.599     -2.543      0.011      -2.699      -0.349
Bsmt_Unf_SF                                              -4.1558      0.577     -7.206      0.000      -5.287      -3.025
Enclosed_Porch                                            0.5663      0.350      1.620      0.105      -0.119       1.252
Fireplaces                                                1.6314      0.405      4.028      0.000       0.837       2.426
Garage_Area                                               2.5402      1.237      2.054      0.040       0.115       4.966
Half_Bath                                                 0.6041      0.498      1.213      0.225      -0.373       1.581
Kitchen_AbvGr                                            -1.4700      0.443     -3.317      0.001      -2.339      -0.601
Lot_Frontage                                              0.7886      0.374      2.106      0.035       0.054       1.523
Open_Porch_SF                                             0.6814      0.364      1.874      0.061      -0.032       1.395
Total_Bsmt_SF                                             6.3422      0.937      6.767      0.000       4.504       8.180
Wood_Deck_SF                                             -3.9968      1.221     -3.273      0.001      -6.392      -1.602
area_per_car                                             -0.5177      0.598     -0.866      0.387      -1.690       0.655
Garage_Cars                                               3.2875      1.346      2.442      0.015       0.647       5.928
Bldg_Type_Twnhs                                         -10.1083      2.363     -4.278      0.000     -14.742      -5.474
Bsmt_Exposure_Gd                                          6.5801      1.466      4.490      0.000       3.706       9.454
Bsmt_Exposure_Mn                                         -5.7843      1.507     -3.839      0.000      -8.740      -2.829
Bsmt_Exposure_No                                         -4.5949      1.119     -4.106      0.000      -6.790      -2.400
Bsmt_Exposure_No_Basement                               -20.6930      4.182     -4.948      0.000     -28.896     -12.490
Central_Air_Y                                             3.1431      1.613      1.949      0.051      -0.020       6.306
Mo_Sold_2                                                -5.4665      1.618     -3.379      0.001      -8.639      -2.294
Mo_Sold_3                                                -1.8005      1.238     -1.455      0.146      -4.228       0.627
Mo_Sold_4                                                -0.9347      1.133     -0.825      0.410      -3.158       1.288
Mo_Sold_6                                                -1.7218      0.909     -1.894      0.058      -3.504       0.061
Mo_Sold_8                                                -2.2543      1.213     -1.859      0.063      -4.633       0.124
Mo_Sold_11                                               -2.6749      1.504     -1.779      0.075      -5.624       0.274
Condition_1_Feedr                                        -2.2434      2.138     -1.049      0.294      -6.436       1.949
Condition_1_Norm                                          6.2977      1.693      3.720      0.000       2.978       9.618
Condition_1_PosN                                          9.8612      3.146      3.135      0.002       3.691      16.031
Condition_1_RRAn                                          3.6148      2.995      1.207      0.228      -2.259       9.489
Condition_1_infrequent_sklearn                            6.8177      3.618      1.884      0.060      -0.278      13.913
Electrical_FuseF                                          2.6673      2.640      1.010      0.313      -2.511       7.845
Mas_Vnr_Type_Stone                                        5.4492      1.328      4.102      0.000       2.844       8.054
Mas_Vnr_Type_nan                                          4.4596      1.079      4.132      0.000       2.343       6.576
Mas_Vnr_Type_infrequent_sklearn                          -4.2498      3.592     -1.183      0.237     -11.294       2.795
Fence_Minimum_Privacy                                     1.2845      1.050      1.223      0.221      -0.775       3.344
Fence_infrequent_sklearn                                  3.2930      5.162      0.638      0.524      -6.830      13.416
Exter_Cond_infrequent_sklearn                            -6.9654      4.943     -1.409      0.159     -16.660       2.730
Garage_Finish_RFn                                        -3.0914      0.961     -3.215      0.001      -4.977      -1.206
Garage_Finish_Unf                                        -1.1641      1.101     -1.057      0.291      -3.324       0.996
Garage_Type_Basment                                      -3.2631      3.155     -1.034      0.301      -9.452       2.925
Garage_Type_BuiltIn                                      -2.6366      1.644     -1.604      0.109      -5.861       0.588
Garage_Type_infrequent_sklearn                          -10.8081      2.803     -3.855      0.000     -16.306      -5.310
Paved_Drive_Paved                                         3.9465      1.417      2.786      0.005       1.168       6.725
Heating_QC_Good                                          -1.0716      1.001     -1.070      0.285      -3.035       0.892
Heating_QC_Typical                                       -1.4190      0.908     -1.563      0.118      -3.199       0.361
Heating_QC_infrequent_sklearn                           -32.3869      8.865     -3.653      0.000     -49.773     -15.001
Overall_Cond_Below_Average                               -8.1790      1.941     -4.213      0.000     -11.986      -4.372
Overall_Cond_Excellent                                   24.6891      3.173      7.781      0.000      18.466      30.912
Overall_Cond_Good                                         8.3455      1.164      7.170      0.000       6.063      10.628
Overall_Cond_Very_Good                                   10.1981      1.705      5.982      0.000       6.855      13.541
Overall_Cond_infrequent_sklearn                         -31.0955      3.967     -7.838      0.000     -38.876     -23.315
MS_SubClass_One_Story_1945_and_Older                      9.1382      3.325      2.749      0.006       2.618      15.659
MS_SubClass_One_Story_1946_and_Newer_All_Styles           9.4727      2.460      3.850      0.000       4.648      14.298
MS_SubClass_One_Story_PUD_1946_and_Newer                  5.0132      3.020      1.660      0.097      -0.909      10.936
MS_SubClass_One_and_Half_Story_Finished_All_Ages         10.1639      3.750      2.711      0.007       2.810      17.518
MS_SubClass_Split_Foyer                                  15.4305      4.188      3.684      0.000       7.216      23.645
MS_SubClass_Split_or_Multilevel                          16.1814      6.079      2.662      0.008       4.259      28.104
MS_SubClass_Two_Family_conversion_All_Styles_and_Ages     7.7103      3.186      2.420      0.016       1.463      13.958
MS_SubClass_Two_Story_1945_and_Older                      8.7715      2.575      3.406      0.001       3.721      13.822
MS_SubClass_Two_Story_PUD_1946_and_Newer                -11.0851      2.498     -4.438      0.000     -15.984      -6.187
MS_SubClass_infrequent_sklearn                           10.8762      3.441      3.160      0.002       4.127      17.625
BsmtFin_Type_1_GLQ                                        4.0622      1.038      3.912      0.000       2.026       6.099
BsmtFin_Type_1_LwQ                                       -3.1627      1.543     -2.050      0.041      -6.189      -0.136
BsmtFin_Type_1_Rec                                       -2.9560      1.412     -2.093      0.036      -5.725      -0.187
BsmtFin_Type_2_BLQ                                       -8.2931      3.008     -2.757      0.006     -14.192      -2.394
BsmtFin_Type_2_LwQ                                      -11.3195      2.958     -3.827      0.000     -17.120      -5.519
BsmtFin_Type_2_Rec                                       -8.3755      2.894     -2.894      0.004     -14.052      -2.699
House_Style_One_and_Half_Fin                            -13.4808      3.522     -3.828      0.000     -20.388      -6.573
House_Style_SFoyer                                       -5.3045      3.705     -1.432      0.152     -12.570       1.961
House_Style_Two_Story                                    -9.8045      2.880     -3.405      0.001     -15.452      -4.157
Lot_Shape_Regular                                        -4.5797      2.209     -2.074      0.038      -8.911      -0.248
Lot_Shape_Slightly_Irregular                             -4.0496      2.200     -1.840      0.066      -8.365       0.266
Lot_Shape_infrequent_sklearn                            -12.9403      5.171     -2.502      0.012     -23.082      -2.798
Neighborhood_Brookside                                  -11.9410      2.310     -5.169      0.000     -16.472      -7.410
Neighborhood_Clear_Creek                                 -8.9939      3.036     -2.963      0.003     -14.948      -3.040
Neighborhood_College_Creek                               -7.6510      2.003     -3.820      0.000     -11.579      -3.723
Neighborhood_Edwards                                    -14.8820      1.968     -7.561      0.000     -18.742     -11.022
Neighborhood_Gilbert                                     -9.6275      2.332     -4.129      0.000     -14.200      -5.055
Neighborhood_Iowa_DOT_and_Rail_Road                     -19.9033      2.524     -7.886      0.000     -24.853     -14.953
Neighborhood_Meadow_Village                             -16.0440      3.331     -4.817      0.000     -22.577      -9.511
Neighborhood_Mitchell                                   -12.2773      2.323     -5.285      0.000     -16.833      -7.722
Neighborhood_North_Ames                                 -11.1975      1.725     -6.490      0.000     -14.581      -7.814
Neighborhood_Northridge                                   2.3026      2.770      0.831      0.406      -3.130       7.736
Neighborhood_Northridge_Heights                          10.2972      2.272      4.532      0.000       5.841      14.753
Neighborhood_Northwest_Ames                             -12.8044      2.184     -5.862      0.000     -17.088      -8.521
Neighborhood_Old_Town                                   -18.2058      2.085     -8.731      0.000     -22.295     -14.117
Neighborhood_Sawyer                                      -8.4452      2.133     -3.959      0.000     -12.629      -4.262
Neighborhood_Sawyer_West                                -12.0133      2.228     -5.392      0.000     -16.383      -7.644
Neighborhood_Somerset                                     4.8777      2.185      2.232      0.026       0.592       9.164
Neighborhood_South_and_West_of_Iowa_State_University    -10.4442      2.961     -3.527      0.000     -16.251      -4.637
Neighborhood_Stone_Brook                                 14.5690      3.034      4.802      0.000       8.618      20.520
Neighborhood_Timberland                                  -6.5571      2.698     -2.431      0.015     -11.848      -1.266
Misc_Feature_Gar2                                       123.2238     20.560      5.993      0.000      82.902     163.545
Misc_Feature_Othr                                       115.7101     27.049      4.278      0.000      62.663     168.758
Misc_Feature_Shed                                       109.7511     29.862      3.675      0.000      51.185     168.317
Misc_Feature_nan                                        110.2385     30.731      3.587      0.000      49.970     170.507
==============================================================================
Omnibus:                      129.795   Durbin-Watson:                   2.041
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              571.146
Skew:                          -0.046   Prob(JB):                    9.49e-125
Kurtosis:                       5.584   Cond. No.                     1.03e+16
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 1.04e-22. This might indicate that there are
strong multicollinearity problems or that the design matrix is singular.
"""</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocessor'</span>, preprocessor_2),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, LinearRegression())])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipeline.fit(ames_x_train_trans, ames_y_train)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">## PREDICCIONES</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline.predict(ames_x_test_trans)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred<span class="op">*</span>_.Gr_Liv_Area, Sale_Price <span class="op">=</span>ames_y_test<span class="op">*</span>_.Gr_Liv_Area)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">##### Métricas de desempeño</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>predictores <span class="op">=</span> transformed_df.columns.to_list()</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>mtrcs_dt <span class="op">=</span>get_metrics(y_pred, y_obs,predictors<span class="op">=</span> <span class="bu">len</span>(transformed_df.columns ))</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>metrics_df <span class="op">=</span> pd.DataFrame(mtrcs_dt)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(metrics_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Value
Metric             
ME           459.52
MAE        17450.23
MAPE           0.10
MSE    788119627.20
RMSE       28073.47
R2             0.88
R2Adj          0.85</code></pre>
</div>
</div>
<p>El modelo muestra una <span class="math inline">\(R^2_{adj}=0.85\)</span> con los datos de test, y tienen un error aproximado del <span class="math inline">\(\pm10\%\)</span> con respecto del precio real.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>validation_results(ames_x_val_trans, ames_y_val, pipeline, <span class="bu">len</span>(transformed_df.columns ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Value
Metric             
ME          -496.29
MAE        17661.52
MAPE           0.11
MSE    716434579.56
RMSE       26766.30
R2             0.89
R2Adj          0.82</code></pre>
</div>
</div>
<p>En cuanto al análisis de los residuos, no parece seguir completamente los supuestos, pues visualmete se puede detectar heterocedasticidad, lo cual puede afectar el preformance del modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### Gráficos de desempeño de modelo</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> y_obs, y <span class="op">=</span> y_pred)) <span class="op">+</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    geom_point(alpha<span class="op">=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>] ) <span class="op">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>]) <span class="op">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-23-27.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 85'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-23-28.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-23-29.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  geom_linerange(aes(ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> <span class="st">"error"</span>), colour <span class="op">=</span> <span class="st">"purple"</span>) <span class="op">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y <span class="op">=</span> <span class="st">"error"</span>), size <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Precio real"</span>) <span class="op">+</span> ylab(<span class="st">"Error de estimación"</span>) <span class="op">+</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Relación entre error y precio de venta"</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-23-30.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="regresión-con-knn" class="level1">
<h1>Regresión con Knn</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mlxtend.feature_selection <span class="im">import</span> ColumnSelector</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, mean_absolute_percentage_error</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, make_scorer</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, KFold, cross_val_score, cross_validate</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils <span class="im">import</span> shuffle</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.one_table_verbs <span class="im">import</span> pull</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mizani.formatters <span class="im">import</span> comma_format, dollar_format</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> siuba <span class="im">import</span> <span class="op">*</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> VotingRegressor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>cat_cols <span class="op">=</span> [<span class="st">'MS_SubClass'</span>, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">'MS_Zoning'</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Street'</span>, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Alley'</span>, </span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Lot_Shape'</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Land_Contour'</span>, </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Utilities'</span>, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Lot_Config'</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Land_Slope'</span>, </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Neighborhood'</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Condition_1'</span>,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Condition_2'</span>, </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Bldg_Type'</span>, </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">'House_Style'</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Overall_Cond'</span>, </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Roof_Style'</span>, </span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Roof_Matl'</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Exterior_1st'</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Exterior_2nd'</span>, </span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Mas_Vnr_Type'</span>, </span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Exter_Cond'</span>,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Foundation'</span>, </span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Bsmt_Cond'</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Bsmt_Exposure'</span>, </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>                <span class="st">'BsmtFin_Type_1'</span>, </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>                <span class="st">'BsmtFin_Type_2'</span>, </span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Heating'</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Heating_QC'</span>, </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Central_Air'</span>, </span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Electrical'</span>, </span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Functional'</span>, </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Garage_Type'</span>,</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Garage_Finish'</span>, </span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Garage_Cond'</span>, </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Paved_Drive'</span>, </span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Pool_QC'</span>, </span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Fence'</span>,</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Misc_Feature'</span>,</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Mo_Sold'</span>, </span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 'Sale_Type', </span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 'Sale_Condition'</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>                ]</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span>[ <span class="st">'Bedroom_AbvGr'</span>,</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_1'</span>,</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_2'</span>,</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Full_Bath'</span>,</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Half_Bath'</span>,</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Unf_SF'</span>,</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Enclosed_Porch'</span>,</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fireplaces'</span>,</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>            <span class="st">'First_Flr_SF'</span>,</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Full_Bath'</span>,</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Area'</span>,</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Cars'</span>,</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Gr_Liv_Area'</span>,</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Half_Bath'</span>,</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Kitchen_AbvGr'</span>,</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Latitude'</span>,</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Longitude'</span>,</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Area'</span>,</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mas_Vnr_Area'</span>,</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Val'</span>,</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Open_Porch_SF'</span>,</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Pool_Area'</span>,</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Screen_Porch'</span>,</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Second_Flr_SF'</span>,</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Three_season_porch'</span>,</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>            <span class="st">'TotRms_AbvGrd'</span>,</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Total_Bsmt_SF'</span>,</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Wood_Deck_SF'</span>,</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Year_Built'</span>,</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Year_Remod_Add'</span>,</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Year_Sold'</span>,</span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>            <span class="st">'area_per_car'</span>,</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>            <span class="st">'last_remod'</span>,</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>            <span class="st">'wood_prop'</span>]  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="knn-usando-unicamente-variables-categóricas" class="level2">
<h2 class="anchored" data-anchor-id="knn-usando-unicamente-variables-categóricas">KNN usando unicamente variables categóricas</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>preprocessor <span class="op">=</span> ColumnTransformer(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'onehotencoding'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown <span class="op">=</span> <span class="st">'ignore'</span>, sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency<span class="op">=</span><span class="dv">15</span>), cat_cols)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'drop'</span>  <span class="co"># Mantener las columnas restantes sin cambios</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> preprocessor.fit_transform(ames_x_train) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_squared_error'</span>: make_scorer(mean_squared_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'r2'</span>: make_scorer(adjusted_r2_score, greater_is_better<span class="op">=</span><span class="va">True</span>, n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_x_train)), p<span class="op">=</span><span class="bu">len</span>(num_cols)),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_absolute_error'</span>: make_scorer(mean_absolute_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mape'</span>: make_scorer(mean_absolute_percentage_error, greater_is_better<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">4</span>, <span class="dv">20</span>,),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [ <span class="st">'distance'</span>],</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'manhattan'</span>, <span class="st">'hamming'</span>, <span class="st">'cosine'</span>, <span class="st">'chebyshev'</span>]</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>pipline_knn_cv<span class="op">=</span>Pipeline([</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span> , GridSearchCV(</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor(), </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>      )]</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pipline_knn_cv.fit(ames_x_train, Sale_Price_train)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pd.to_pickle(pipline_knn_cv,<span class="st">'pipline_cateogrico_knn_cv.pkl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>pipline_knn_cv <span class="op">=</span> pd.read_pickle(<span class="st">'pipline_cateogrico_knn_cv.pkl'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipline_knn_cv.named_steps[<span class="st">'cv'</span>].cv_results_</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>best_knn_cat <span class="op">=</span> pipline_knn_cv.named_steps[<span class="st">'cv'</span>].best_estimator_</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>summary_num_cv <span class="op">=</span> (</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(results) <span class="op">&gt;&gt;</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  select(<span class="op">-</span>_.contains(<span class="st">"split"</span>), <span class="op">-</span>_.contains(<span class="st">"time"</span>), <span class="op">-</span>_.params)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  summary_num_cv </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> arrange(_.rank_test_r2) </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> select(_.contains(<span class="st">'r2'</span>), _.contains(<span class="st">'param'</span>)) </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mean_test_r2  std_test_r2  ...  param_n_neighbors param_weights
4           0.72         0.07  ...                  8      distance
7           0.72         0.06  ...                 11      distance
39          0.71         0.05  ...                 11      distance
6           0.71         0.06  ...                 10      distance
40          0.71         0.05  ...                 12      distance
9           0.71         0.05  ...                 13      distance
10          0.71         0.05  ...                 14      distance
34          0.71         0.07  ...                  6      distance
5           0.71         0.06  ...                  9      distance
8           0.71         0.06  ...                 12      distance

[10 rows x 6 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>summary_plot <span class="op">=</span> (</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  summary_num_cv </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.mean_test_r2<span class="op">&gt;</span><span class="dv">0</span>, _.param_n_neighbors<span class="op">&gt;</span><span class="dv">5</span>) <span class="op">&gt;&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) <span class="op">+</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  geom_point() <span class="op">+</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"R^2 promedio"</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipline_knn_cv.named_steps[<span class="st">'cv'</span>].cv_results_</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>best_knn_cat <span class="op">=</span> pipline_knn_cv.named_steps[<span class="st">'cv'</span>].best_estimator_</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>summary_num_cv <span class="op">=</span> (</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(results) <span class="op">&gt;&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  select(<span class="op">-</span>_.contains(<span class="st">"split"</span>), <span class="op">-</span>_.contains(<span class="st">"time"</span>), <span class="op">-</span>_.params)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  summary_num_cv </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> arrange(_.rank_test_r2) </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> select(_.contains(<span class="st">'r2'</span>), _.contains(<span class="st">'param'</span>)) </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mean_test_r2  std_test_r2  ...  param_n_neighbors param_weights
4           0.72         0.07  ...                  8      distance
7           0.72         0.06  ...                 11      distance
39          0.71         0.05  ...                 11      distance
6           0.71         0.06  ...                 10      distance
40          0.71         0.05  ...                 12      distance
9           0.71         0.05  ...                 13      distance
10          0.71         0.05  ...                 14      distance
34          0.71         0.07  ...                  6      distance
5           0.71         0.06  ...                  9      distance
8           0.71         0.06  ...                 12      distance

[10 rows x 6 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>summary_plot <span class="op">=</span> (</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  summary_num_cv </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.mean_test_r2<span class="op">&gt;</span><span class="dv">0</span>, _.param_n_neighbors<span class="op">&gt;</span><span class="dv">4</span>) <span class="op">&gt;&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  mutate(min_err<span class="op">=</span>_.mean_test_r2<span class="op">-</span>_.std_test_r2,max_err<span class="op">=</span>_.mean_test_r2<span class="op">+</span>_.std_test_r2 ) <span class="op">&gt;&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) <span class="op">+</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>                  position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>),show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"R^2 promedio"</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>knn_cat_best<span class="op">=</span>KNeighborsRegressor(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>           n_neighbors <span class="op">=</span> <span class="dv">15</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>           weights <span class="op">=</span><span class="st">'distance'</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>           metric<span class="op">=</span><span class="st">'hamming'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>knn_cat_best.fit(transformed_df, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>KNeighborsRegressor(metric='hamming', n_neighbors=15, weights='distance')</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>test_transformed <span class="op">=</span> preprocessor.transform(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>pred<span class="op">=</span> knn_cat_best.predict(test_transformed)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> <span class="bu">len</span>(preprocessor.get_feature_names_out())</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>mse<span class="op">=</span> get_metrics(y_pred<span class="op">=</span>pred, y_obs<span class="op">=</span>Sale_Price_test, predictors<span class="op">=</span>predictors) .loc[<span class="st">'MSE'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>importance <span class="op">=</span> importance_from_model(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  test_transformed ,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  Sale_Price_test,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">list</span>(preprocessor.get_feature_names_out()),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  knn_cat_best,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  actual_mse <span class="op">=</span> mse,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  n_permutations <span class="op">=</span> <span class="dv">50</span> ,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  trans_pred <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>pd.to_pickle(importance,<span class="st">'importance_cat_knn.pkl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                            Variable  Mean_Loss  Std_Loss
21      Lot_Shape_Slightly_Irregular       0.01      0.00
88              Exterior_1st_HdBoard       0.01      0.00
89              Exterior_1st_MetalSd       0.01      0.00
176                        Mo_Sold_6       0.01      0.00
177                        Mo_Sold_7       0.01      0.00
..                               ...        ...       ...
82                    Roof_Style_Hip       0.01      0.00
122                 Bsmt_Exposure_No       0.01      0.00
120                 Bsmt_Exposure_Gd       0.01      0.00
108                 Mas_Vnr_Type_nan       0.01      0.00
46   Neighborhood_Northridge_Heights       0.01      0.00

[183 rows x 3 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  importance <span class="op">&gt;&gt;</span> top_n(<span class="dv">20</span>, _.Mean_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-37-35.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  importance <span class="op">&gt;&gt;</span> top_n(<span class="op">-</span><span class="dv">20</span>, _.Mean_Loss)<span class="op">&gt;&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-38-37.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>vars_importance_order <span class="op">=</span><span class="bu">list</span>( importance <span class="op">&gt;&gt;</span> arrange(_.Mean_Loss) <span class="op">&gt;&gt;</span> pull(<span class="st">'Variable'</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>v<span class="op">=</span>[]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>r2<span class="op">=</span>[]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>mse_<span class="op">=</span>[]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">150</span>):</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  vars_to_train <span class="op">=</span> vars_importance_order[i:]</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  knn_cat_best.fit(transformed_df[vars_to_train], Sale_Price_train)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  pred<span class="op">=</span> knn_cat_best.predict(test_transformed[vars_to_train])</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  mse_.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>])</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  r2.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'R2Adj'</span>].values[<span class="dv">0</span>])</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  v.append(vars_to_train)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>idf <span class="op">=</span> pd.DataFrame({<span class="st">'MSE'</span>:mse_, <span class="st">'R2_adj'</span>:r2,<span class="st">'vars'</span>:v})</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>best_features_from_cat <span class="op">=</span> (idf <span class="op">&gt;&gt;</span> top_n(<span class="op">-</span><span class="dv">1</span>, _.MSE) <span class="op">&gt;&gt;</span> pull (<span class="st">'vars'</span>))[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>['Condition_1_infrequent_sklearn', 'Exterior_2nd_Stucco', 'Mo_Sold_10', 'MS_SubClass_Two_Story_PUD_1946_and_Newer', 'Mo_Sold_5', 'Neighborhood_Sawyer_West', 'Heating_QC_Typical', 'Functional_Mod', 'Neighborhood_Brookside', 'Lot_Config_FR2', 'Garage_Cond_Typical', 'Alley_Paved', 'Neighborhood_Mitchell', 'Exterior_2nd_Plywood', 'Neighborhood_Veenker', 'Neighborhood_Northridge', 'Mo_Sold_8', 'Overall_Cond_Below_Average', 'House_Style_infrequent_sklearn', 'BsmtFin_Type_1_Unf', 'Fence_No_Fence', 'Exter_Cond_Good', 'Misc_Feature_nan', 'Mo_Sold_4', 'MS_SubClass_One_Story_1945_and_Older', 'Condition_1_Feedr', 'MS_SubClass_infrequent_sklearn', 'Exterior_1st_infrequent_sklearn', 'Neighborhood_Sawyer', 'Mo_Sold_11', 'Overall_Cond_Fair', 'House_Style_Two_Story', 'Central_Air_Y', 'Lot_Config_CulDSac', 'Exterior_2nd_VinylSd', 'MS_Zoning_Floating_Village_Residential', 'Roof_Matl_infrequent_sklearn', 'Neighborhood_Clear_Creek', 'BsmtFin_Type_1_No_Basement', 'Mo_Sold_3', 'Neighborhood_Somerset', 'Overall_Cond_Excellent', 'BsmtFin_Type_1_BLQ', 'Exterior_1st_VinylSd', 'Bsmt_Exposure_No_Basement', 'MS_SubClass_One_Story_1946_and_Newer_All_Styles', 'Heating_QC_Good', 'Neighborhood_Edwards', 'Paved_Drive_Paved', 'Bsmt_Cond_No_Basement', 'MS_SubClass_One_and_Half_Story_Finished_All_Ages', 'Neighborhood_Old_Town', 'Bsmt_Exposure_Mn', 'Bldg_Type_OneFam', 'Foundation_PConc', 'Land_Contour_Low', 'BsmtFin_Type_2_No_Basement', 'Exterior_1st_Plywood', 'Functional_Typ', 'Exterior_2nd_Wd Sdng', 'Electrical_SBrkr', 'House_Style_SLvl', 'Neighborhood_North_Ames', 'MS_Zoning_Residential_Low_Density', 'Land_Slope_Mod', 'MS_SubClass_Two_Story_1946_and_Newer', 'Exterior_1st_BrkFace', 'Exterior_2nd_BrkFace', 'MS_SubClass_Split_or_Multilevel', 'Mo_Sold_9', 'Condition_1_Norm', 'Exter_Cond_Typical', 'Garage_Type_BuiltIn', 'MS_Zoning_Residential_Medium_Density', 'Neighborhood_Stone_Brook', 'Mas_Vnr_Type_BrkFace', 'MS_SubClass_Two_Story_1945_and_Older', 'Neighborhood_Crawford', 'Neighborhood_Gilbert', 'Lot_Config_Inside', 'Neighborhood_College_Creek', 'Exterior_1st_Wd Sdng', 'Exterior_1st_CemntBd', 'Garage_Type_Detchd', 'Exterior_2nd_CmentBd', 'Land_Contour_Lvl', 'Lot_Shape_Regular', 'Overall_Cond_Average', 'Mas_Vnr_Type_Stone', 'Garage_Finish_Unf', 'Roof_Style_Gable', 'BsmtFin_Type_1_GLQ', 'Roof_Style_Hip', 'Bsmt_Exposure_No', 'Bsmt_Exposure_Gd', 'Mas_Vnr_Type_nan', 'Neighborhood_Northridge_Heights']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>selectorr<span class="op">=</span> ColumnTransformer([(<span class="st">'selector'</span>, <span class="st">'passthrough'</span>, best_features_from_cat)],</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>          remainder<span class="op">=</span> <span class="st">'drop'</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>          verbose_feature_names_out<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">4</span>, <span class="dv">30</span>),</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [ <span class="st">'distance'</span>,<span class="st">'uniform'</span>],</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'manhattan'</span>, <span class="st">'hamming'</span>, <span class="st">'cosine'</span>, <span class="st">'chebyshev'</span>]</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>final_cat_knn_pipeline_cv <span class="op">=</span> Pipeline([</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr),</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    KNeighborsRegressor(), </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    param_grid, </span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    cv<span class="op">=</span>kf, </span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    scoring<span class="op">=</span>scoring, </span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    verbose<span class="op">=</span><span class="dv">2</span>, </span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    n_jobs<span class="op">=</span><span class="dv">7</span>))]</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>final_cat_knn_pipeline_cv.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(final_cat_knn_pipeline_cv.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_metric <span class="op">!=</span> <span class="st">'chebyshev'</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>            _.param_weights <span class="op">==</span> <span class="st">'distance'</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>            _.param_metric <span class="op">!=</span> <span class="st">'cosine'</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>            _.param_n_neighbors <span class="op">&gt;</span><span class="dv">12</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> mutate(min_err<span class="op">=</span>_.mean_test_r2<span class="op">-</span>_.std_test_r2,max_err<span class="op">=</span>_.mean_test_r2<span class="op">+</span>_.std_test_r2 )</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) <span class="op">+</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>                  position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>),show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  ylim([<span class="fl">0.6</span>,<span class="fl">0.8</span>])<span class="op">+</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-43-39.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>f_cat_knn_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, KNeighborsRegressor(</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>            n_neighbors <span class="op">=</span> <span class="dv">22</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>            weights <span class="op">=</span><span class="st">'distance'</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>            metric<span class="op">=</span><span class="st">'hamming'</span>))]</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>f_cat_knn_pipeline.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('onehotencoding',
                                                  OneHotEncoder(drop='first',
                                                                handle_unknown='ignore',
                                                                min_frequency=15,
                                                                sparse_output=False),
                                                  ['MS_SubClass', 'MS_Zoning',
                                                   'Street', 'Alley',
                                                   'Lot_Shape', 'Land_Contour',
                                                   'Utilities', 'Lot_Config',
                                                   'Land_Slope', 'Neighborhood',
                                                   'Condition_1', 'Condition_2',
                                                   'Bldg_Type', 'House_Style',
                                                   'Overall_...
                                                   'BsmtFin_Type_1_Unf',
                                                   'Fence_No_Fence',
                                                   'Exter_Cond_Good',
                                                   'Misc_Feature_nan',
                                                   'Mo_Sold_4',
                                                   'MS_SubClass_One_Story_1945_and_Older',
                                                   'Condition_1_Feedr',
                                                   'MS_SubClass_infrequent_sklearn',
                                                   'Exterior_1st_infrequent_sklearn',
                                                   'Neighborhood_Sawyer',
                                                   'Mo_Sold_11', ...])],
                                   verbose_feature_names_out=False)),
                ('cv',
                 KNeighborsRegressor(metric='hamming', n_neighbors=22,
                                     weights='distance'))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span>  f_cat_knn_pipeline.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(selectorr.get_feature_names_out()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           7612.3266
MAE         30040.3574
MAPE            0.1606
MSE    2119753752.5500
RMSE        46040.7836
R2              0.6724
R2Adj           0.6073</code></pre>
</div>
</div>
</section>
<section id="knn-con-variables-númericas" class="level2">
<h2 class="anchored" data-anchor-id="knn-con-variables-númericas">KNN con variables númericas</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>preprocessor<span class="op">=</span> ColumnTransformer([</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'std'</span>, StandardScaler(), num_cols)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span>, </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">105</span>, <span class="dv">5</span>),</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'minkowski'</span>,<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'hamming'</span>, <span class="st">'cosine'</span>, <span class="st">'chebyshev'</span>],</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'p'</span>: <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">10</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>gs_knn_cv <span class="op">=</span> Pipeline([</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>gs_knn_cv.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(gs_knn_cv.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &gt;&gt; filter(_.param_metric != 'chebyshev',</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           _.param_weights == 'distance',</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           _.param_metric != 'cosine',</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># _.param_n_neighbors &gt;12)</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &gt;&gt; mutate(min_err=_.mean_test_r2-_.std_test_r2,max_err=_.mean_test_r2+_.std_test_r2 )</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>, size<span class="op">=</span><span class="st">'param_p'</span>)) <span class="op">+</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_errorbar(aes(ymin='min_err', ymax='max_err'),</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># position=position_dodge(width=0.7),show_legend=False) +</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim([0.6,0.8])+</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\scales\scale_size.py:49: PlotnineWarning: Using size for a discrete variable is not advised.
C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 84 rows containing missing values.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-47-41.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">20</span>),</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'minkowski'</span>,<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'hamming'</span>, <span class="st">'cosine'</span>, <span class="st">'chebyshev'</span>],</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'p'</span>: <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">10</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>gs_knn_cv2 <span class="op">=</span> Pipeline([</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>gs_knn_cv2.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gs_knn_cv.named_steps['cv'].cv_results_</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(gs_knn_cv2.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_metric <span class="op">==</span> <span class="st">'manhattan'</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>            _.param_weights <span class="op">==</span> <span class="st">'distance'</span>,_.param_n_neighbors<span class="op">&gt;</span><span class="dv">9</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> mutate(min_err<span class="op">=</span>_.mean_test_r2<span class="op">-</span>_.std_test_r2,max_err<span class="op">=</span>_.mean_test_r2<span class="op">+</span>_.std_test_r2 )</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) <span class="op">+</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>                  position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>),show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim([0.6,0.8])+</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-50-43.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>fst_knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, KNeighborsRegressor(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    n_neighbors <span class="op">=</span> <span class="dv">16</span>,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> <span class="st">'distance'</span>,</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    metric <span class="op">=</span><span class="st">'manhattan'</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    )]</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>fst_knn_pipe.fit(ames_x_train , Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('std', StandardScaler(),
                                                  ['Bedroom_AbvGr',
                                                   'BsmtFin_SF_1',
                                                   'BsmtFin_SF_2',
                                                   'Bsmt_Full_Bath',
                                                   'Bsmt_Half_Bath',
                                                   'Bsmt_Unf_SF',
                                                   'Enclosed_Porch',
                                                   'Fireplaces', 'First_Flr_SF',
                                                   'Full_Bath', 'Garage_Area',
                                                   'Garage_Cars', 'Gr_Liv_Area',
                                                   'Half_Bath', 'Kitchen_AbvGr',
                                                   'Latitude', 'Longitude',
                                                   'Lot_Area', 'Lot_Frontage',
                                                   'Mas_Vnr_Area', 'Misc_Val',
                                                   'Open_Porch_SF', 'Pool_Area',
                                                   'Screen_Porch',
                                                   'Second_Flr_SF',
                                                   'Three_season_porch',
                                                   'TotRms_AbvGrd',
                                                   'Total_Bsmt_SF',
                                                   'Wood_Deck_SF', 'Year_Built', ...])],
                                   verbose_feature_names_out=False)),
                ('regressor',
                 KNeighborsRegressor(metric='manhattan', n_neighbors=16,
                                     weights='distance'))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>y_pred  <span class="op">=</span> fst_knn_pipe.predict(ames_x_test)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(preprocessor.get_feature_names_out()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           7227.3248
MAE         20821.5875
MAPE            0.1107
MSE    1209723375.5859
RMSE        34781.0778
R2              0.8131
R2Adj           0.8012</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(preprocessor.get_feature_names_out()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           7227.3248
MAE         20821.5875
MAPE            0.1107
MSE    1209723375.5859
RMSE        34781.0778
R2              0.8131
R2Adj           0.8012</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span>importance_from_model(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  test_frame <span class="op">=</span> ames_x_test,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  y_obs <span class="op">=</span> Sale_Price_test ,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  selected_columns <span class="op">=</span> num_cols, </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> fst_knn_pipe,</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  actual_mse <span class="op">=</span>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(preprocessor.get_feature_names_out())).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>] ,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  n_permutations<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  trans_pred<span class="op">=</span> <span class="va">False</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pd.to_pickle(importance_df, 'knn_num_importance_df.pkl')</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> pd.read_pickle(<span class="st">'knn_num_importance_df.pkl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span><span class="co"># top_n(-20, _.Mean_Loss)&gt;&gt;</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-54-45.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>vars_importance_order <span class="op">=</span><span class="bu">list</span>( importance_df <span class="op">&gt;&gt;</span> arrange(_.Mean_Loss) <span class="op">&gt;&gt;</span> pull(<span class="st">'Variable'</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>knn_reg<span class="op">=</span>KNeighborsRegressor(</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>      n_neighbors <span class="op">=</span> <span class="dv">16</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>      weights <span class="op">=</span> <span class="st">'distance'</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>      metric <span class="op">=</span><span class="st">'manhattan'</span>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>v<span class="op">=</span>[]</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>r2<span class="op">=</span>[]</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>mse_<span class="op">=</span>[]</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">30</span>):</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>  vars_to_train <span class="op">=</span> vars_importance_order[i:]</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>  selectorr <span class="op">=</span> ColumnTransformer([(<span class="st">'selector'</span>, <span class="st">'passthrough'</span>, vars_to_train)],</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>          remainder<span class="op">=</span> <span class="st">'drop'</span>,</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>          verbose_feature_names_out<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  fst_knn_pipe <span class="op">=</span> Pipeline([</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'selector'</span>, selectorr),</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'regressor'</span>, knn_reg)</span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>  fst_knn_pipe.fit(ames_x_train, Sale_Price_train)</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>  pred<span class="op">=</span>  fst_knn_pipe.predict( ames_x_test )</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a>  mse_.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>])</span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a>  r2.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'R2Adj'</span>].values[<span class="dv">0</span>])</span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>  v.append(vars_to_train)</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>idf <span class="op">=</span> pd.DataFrame({<span class="st">'MSE'</span>:mse_, <span class="st">'R2_adj'</span>:r2,<span class="st">'vars'</span>:v})</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a>best_features_from_num <span class="op">=</span> (idf <span class="op">&gt;&gt;</span> top_n(<span class="op">-</span><span class="dv">1</span>, _.MSE) <span class="op">&gt;&gt;</span> pull (<span class="st">'vars'</span>))[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>selectorr <span class="op">=</span> ColumnTransformer([(<span class="st">'selector'</span>, <span class="st">'passthrough'</span>, best_features_from_num)],</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>          remainder<span class="op">=</span> <span class="st">'drop'</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>          verbose_feature_names_out<span class="op">=</span><span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">105</span>, <span class="dv">5</span>),</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'minkowski'</span>,<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'hamming'</span>, <span class="st">'cosine'</span>, <span class="st">'chebyshev'</span>],</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'p'</span>: <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">10</span>)</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>scnd_knn_pipe_cv <span class="op">=</span> Pipeline([</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr),</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>scnd_knn_pipe_cv.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(scnd_knn_pipe_cv.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &gt;&gt; filter(_.param_metric != 'chebyshev',</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           _.param_weights == 'distance',</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           _.param_metric != 'cosine',</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># _.param_n_neighbors &gt;12)</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &gt;&gt; mutate(min_err=_.mean_test_r2-_.std_test_r2,max_err=_.mean_test_r2+_.std_test_r2 )</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>, size<span class="op">=</span><span class="st">'param_p'</span>)) <span class="op">+</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_errorbar(aes(ymin='min_err', ymax='max_err'),</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># position=position_dodge(width=0.7),show_legend=False) +</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim([0.6,0.8])+</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\scales\scale_size.py:49: PlotnineWarning: Using size for a discrete variable is not advised.
C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 84 rows containing missing values.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-59-47.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">53</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">4</span>, <span class="dv">30</span>),</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [ <span class="st">'manhattan'</span>, <span class="st">'euclidean'</span>, ]</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>scnd_knn_pipe_cv2 <span class="op">=</span> Pipeline([</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr),</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>scnd_knn_pipe_cv2.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(scnd_knn_pipe_cv2.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_weights <span class="op">==</span> <span class="st">'distance'</span>,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>            _.param_metric <span class="op">!=</span> <span class="st">'euclidean'</span>,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>            _.param_n_neighbors <span class="op">&lt;</span><span class="dv">10</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> mutate(min_err<span class="op">=</span>_.mean_test_r2<span class="op">-</span>_.std_test_r2,max_err<span class="op">=</span>_.mean_test_r2<span class="op">+</span>_.std_test_r2 )</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) <span class="op">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>                  position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>),show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim([0.6,0.8])+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-62-49.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>knn_reg<span class="op">=</span>KNeighborsRegressor(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>      n_neighbors <span class="op">=</span> <span class="dv">8</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>      weights <span class="op">=</span> <span class="st">'distance'</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>      metric <span class="op">=</span><span class="st">'manhattan'</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>f_num_knn_reg <span class="op">=</span> Pipeline([</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr ),</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, knn_reg)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>f_num_knn_reg.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('std', StandardScaler(),
                                                  ['Bedroom_AbvGr',
                                                   'BsmtFin_SF_1',
                                                   'BsmtFin_SF_2',
                                                   'Bsmt_Full_Bath',
                                                   'Bsmt_Half_Bath',
                                                   'Bsmt_Unf_SF',
                                                   'Enclosed_Porch',
                                                   'Fireplaces', 'First_Flr_SF',
                                                   'Full_Bath', 'Garage_Area',
                                                   'Garage_Cars', 'Gr_Liv_Area',
                                                   'Half_Bath', 'Kitchen_AbvGr',
                                                   'Latitude', 'Longitude',
                                                   'Lot_Area', 'Lot_Frontage'...
                                                   'Lot_Area', 'Kitchen_AbvGr',
                                                   'Second_Flr_SF',
                                                   'Mas_Vnr_Area', 'Half_Bath',
                                                   'Bsmt_Full_Bath',
                                                   'Open_Porch_SF',
                                                   'Year_Remod_Add',
                                                   'TotRms_AbvGrd', 'Full_Bath',
                                                   'Garage_Cars', 'Garage_Area',
                                                   'Fireplaces',
                                                   'Total_Bsmt_SF',
                                                   'First_Flr_SF',
                                                   'Gr_Liv_Area'])],
                                   verbose_feature_names_out=False)),
                ('regressor',
                 KNeighborsRegressor(metric='manhattan', n_neighbors=8,
                                     weights='distance'))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> f_num_knn_reg.predict(ames_x_test)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span> (best_features_from_num))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           3433.8515
MAE         20129.8082
MAPE            0.1121
MSE    1131108975.2421
RMSE        33631.9636
R2              0.8252
R2Adj           0.8197</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>voting <span class="op">=</span> VotingRegressor(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'knn_num'</span>, f_num_knn_reg),</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'knn_cat'</span>,f_cat_knn_pipeline)],</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  weights <span class="op">=</span>[<span class="fl">.80</span>,<span class="fl">.1</span>]</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>voting.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VotingRegressor(estimators=[('knn_num',
                             Pipeline(steps=[('prep',
                                              ColumnTransformer(transformers=[('std',
                                                                               StandardScaler(),
                                                                               ['Bedroom_AbvGr',
                                                                                'BsmtFin_SF_1',
                                                                                'BsmtFin_SF_2',
                                                                                'Bsmt_Full_Bath',
                                                                                'Bsmt_Half_Bath',
                                                                                'Bsmt_Unf_SF',
                                                                                'Enclosed_Porch',
                                                                                'Fireplaces',
                                                                                'First_Flr_SF',
                                                                                'Full_Bath',
                                                                                'Garage_Area',
                                                                                'Garage_Cars',
                                                                                'Gr_Liv_Area',
                                                                                'Half_Bath',
                                                                                'Kitchen_AbvGr',
                                                                                'Latitude...
                                                                                'Exter_Cond_Good',
                                                                                'Misc_Feature_nan',
                                                                                'Mo_Sold_4',
                                                                                'MS_SubClass_One_Story_1945_and_Older',
                                                                                'Condition_1_Feedr',
                                                                                'MS_SubClass_infrequent_sklearn',
                                                                                'Exterior_1st_infrequent_sklearn',
                                                                                'Neighborhood_Sawyer',
                                                                                'Mo_Sold_11', ...])],
                                                                verbose_feature_names_out=False)),
                                             ('cv',
                                              KNeighborsRegressor(metric='hamming',
                                                                  n_neighbors=22,
                                                                  weights='distance'))]))],
                weights=[0.8, 0.1])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> voting.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span> (best_features_from_num))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           3898.1265
MAE         19886.6143
MAPE            0.1099
MSE    1116068443.3835
RMSE        33407.6106
R2              0.8275
R2Adj           0.8220</code></pre>
</div>
</div>
</section>
<section id="knn-con-todas-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="knn-con-todas-las-variables">KNN con todas las variables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">###################################################</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co">##############  Full model ########################</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co">###################################################</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_squared_error'</span>: make_scorer(mean_squared_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'r2'</span>: make_scorer(adjusted_r2_score, greater_is_better<span class="op">=</span><span class="va">True</span>, n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_x_train)), p<span class="op">=</span><span class="bu">len</span>(num_cols)),</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_absolute_error'</span>: make_scorer(mean_absolute_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mape'</span>: make_scorer(mean_absolute_percentage_error, greater_is_better<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>preprocessor<span class="op">=</span> ColumnTransformer([</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'std'</span>, StandardScaler(), num_cols),</span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'onehotencoding'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown <span class="op">=</span> <span class="st">'ignore'</span>, sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency<span class="op">=</span><span class="dv">15</span>), cat_cols)</span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span>, </span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">105</span>, <span class="dv">5</span>),</span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'minkowski'</span>,<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'hamming'</span>, <span class="st">'cosine'</span>, <span class="st">'chebyshev'</span>],</span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a> <span class="st">'p'</span>: <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">10</span>)</span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv <span class="op">=</span> Pipeline([</span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb99-40"><a href="#cb99-40" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb99-41"><a href="#cb99-41" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb99-42"><a href="#cb99-42" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb99-43"><a href="#cb99-43" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb99-44"><a href="#cb99-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-45"><a href="#cb99-45" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv.fit(ames_x_train, Sale_Price_train )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(gs_knn_fm_cv.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &gt;&gt; filter(_.param_metric != 'chebyshev',</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           _.param_weights == 'distance',</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           _.param_metric != 'cosine',</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># _.param_n_neighbors &gt;12)</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># &gt;&gt; mutate(min_err=_.mean_test_r2-_.std_test_r2,max_err=_.mean_test_r2+_.std_test_r2 )</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>, size<span class="op">=</span><span class="st">'param_p'</span>)) <span class="op">+</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_errorbar(aes(ymin='min_err', ymax='max_err'),</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># position=position_dodge(width=0.7),show_legend=False) +</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim([0.6,0.8])+</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\scales\scale_size.py:49: PlotnineWarning: Using size for a discrete variable is not advised.
C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 84 rows containing missing values.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-67-51.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">20</span>),</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'cosine'</span>]</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv2 <span class="op">=</span> Pipeline([</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>gs_knn_fm_cv2.fit(ames_x_train, Sale_Price_train )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(gs_knn_fm_cv2.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_metric <span class="op">!=</span> <span class="st">'chebyshev'</span>,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>            _.param_weights <span class="op">==</span> <span class="st">'distance'</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           _.param_metric != 'cosine',</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># _.param_n_neighbors &gt;12)</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> mutate(min_err<span class="op">=</span>_.mean_test_r2<span class="op">-</span>_.std_test_r2,max_err<span class="op">=</span>_.mean_test_r2<span class="op">+</span>_.std_test_r2 )</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) <span class="op">+</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),</span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>                  position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>),show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim([0.6,0.8])+</span></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-70-53.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>fst_knn_fm__pipe <span class="op">=</span> Pipeline([</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, KNeighborsRegressor(</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    n_neighbors <span class="op">=</span> <span class="dv">8</span>,</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> <span class="st">'distance'</span>,</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    metric <span class="op">=</span><span class="st">'manhattan'</span>)</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    )]</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>fst_knn_fm__pipe.fit(ames_x_train , Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('std', StandardScaler(),
                                                  ['Bedroom_AbvGr',
                                                   'BsmtFin_SF_1',
                                                   'BsmtFin_SF_2',
                                                   'Bsmt_Full_Bath',
                                                   'Bsmt_Half_Bath',
                                                   'Bsmt_Unf_SF',
                                                   'Enclosed_Porch',
                                                   'Fireplaces', 'First_Flr_SF',
                                                   'Full_Bath', 'Garage_Area',
                                                   'Garage_Cars', 'Gr_Liv_Area',
                                                   'Half_Bath', 'Kitchen_AbvGr',
                                                   'Latitude', 'Longitude',
                                                   'Lot_Area', 'Lot_Frontage'...
                                                   'Overall_Cond', 'Roof_Style',
                                                   'Roof_Matl', 'Exterior_1st',
                                                   'Exterior_2nd',
                                                   'Mas_Vnr_Type', 'Exter_Cond',
                                                   'Foundation', 'Bsmt_Cond',
                                                   'Bsmt_Exposure',
                                                   'BsmtFin_Type_1',
                                                   'BsmtFin_Type_2', 'Heating',
                                                   'Heating_QC', 'Central_Air',
                                                   'Electrical', ...])],
                                   verbose_feature_names_out=False)),
                ('regressor',
                 KNeighborsRegressor(metric='manhattan', n_neighbors=8,
                                     weights='distance'))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>y_pred  <span class="op">=</span> fst_knn_fm__pipe.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(preprocessor.get_feature_names_out()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           7794.5597
MAE         21234.1380
MAPE            0.1126
MSE    1214652949.2341
RMSE        34851.8715
R2              0.8123
R2Adj           0.7008</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(preprocessor.get_feature_names_out() ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           7794.5597
MAE         21234.1380
MAPE            0.1126
MSE    1214652949.2341
RMSE        34851.8715
R2              0.8123
R2Adj           0.7008</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>knn_reg <span class="op">=</span> KNeighborsRegressor(</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    n_neighbors <span class="op">=</span> <span class="dv">8</span>,</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> <span class="st">'distance'</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    metric <span class="op">=</span><span class="st">'manhattan'</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>knn_reg.fit(preprocessor.fit_transform(ames_x_train), Sale_Price_train)</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>importance_df <span class="op">=</span> importance_from_model(</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  test_frame <span class="op">=</span> transformed_test_df,</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  y_obs <span class="op">=</span> Sale_Price_test ,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  selected_columns <span class="op">=</span> transformed_test_df.columns.to_list(), </span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  pipeline <span class="op">=</span> knn_reg,</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>  actual_mse <span class="op">=</span>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(preprocessor.get_feature_names_out())).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>] ,</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>  n_permutations<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>  trans_pred<span class="op">=</span> <span class="va">False</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span> top_n(<span class="dv">30</span>, _.Mean_Loss)<span class="op">&gt;&gt;</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-74-55.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">&gt;&gt;</span> top_n(<span class="op">-</span><span class="dv">30</span>, _.Mean_Loss)<span class="op">&gt;&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>  coord_flip()</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-74-56.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>vars_importance_order <span class="op">=</span> <span class="bu">list</span>( importance_df <span class="op">&gt;&gt;</span> arrange(_.Mean_Loss) <span class="op">&gt;&gt;</span> pull(<span class="st">'Variable'</span>))</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> preprocessor.fit_transform(ames_x_train)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>v<span class="op">=</span>[]</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>r2<span class="op">=</span>[]</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>mse_<span class="op">=</span>[]</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">150</span>):</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  vars_to_train <span class="op">=</span> vars_importance_order[i:]</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>  knn_reg.fit(transformed_df[vars_to_train], Sale_Price_train)</span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>  pred<span class="op">=</span> knn_reg.predict(transformed_test_df[vars_to_train])</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>  mse_.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>])</span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>  r2.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'R2Adj'</span>].values[<span class="dv">0</span>])</span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>  v.append(vars_to_train)</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>idf <span class="op">=</span> pd.DataFrame({<span class="st">'MSE'</span>:mse_, <span class="st">'R2_adj'</span>:r2,<span class="st">'vars'</span>:v})</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>best_features_from_fm <span class="op">=</span> (idf <span class="op">&gt;&gt;</span> mutate(MSE<span class="op">=</span> (_.MSE)<span class="op">**</span>(<span class="fl">0.5</span>) ) <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.MSE <span class="op">&lt;</span> <span class="dv">33500</span>) <span class="op">&gt;&gt;</span> top_n(<span class="dv">1</span>, _.R2_adj) <span class="op">&gt;&gt;</span> pull(<span class="st">'vars'</span>))[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>preprocessor<span class="op">=</span> ColumnTransformer([</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'std'</span>, StandardScaler(), num_cols),</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'onehotencoding'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown <span class="op">=</span> <span class="st">'ignore'</span>, sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency<span class="op">=</span><span class="dv">15</span>), cat_cols)</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span>, </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>selectorr <span class="op">=</span> ColumnTransformer(</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'selector'</span>, <span class="st">'passthrough'</span>,best_features_from_fm)],</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>  remainder <span class="op">=</span> <span class="st">'drop'</span>,</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out<span class="op">=</span> <span class="va">False</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span><span class="dv">10</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">77</span>)</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">1</span>),</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'minkowski'</span>,<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>, <span class="st">'hamming'</span>, <span class="st">'cosine'</span>, <span class="st">'chebyshev'</span>],</span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a> <span class="st">'p'</span>: <span class="bu">range</span>(<span class="dv">3</span>,<span class="dv">10</span>)</span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>final_cv_knn <span class="op">=</span> Pipeline([</span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>, preprocessor),</span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr),</span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'cv'</span>, GridSearchCV(</span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(), </span>
<span id="cb120-31"><a href="#cb120-31" aria-hidden="true" tabindex="-1"></a>      param_grid, </span>
<span id="cb120-32"><a href="#cb120-32" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf, </span>
<span id="cb120-33"><a href="#cb120-33" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring, </span>
<span id="cb120-34"><a href="#cb120-34" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb120-35"><a href="#cb120-35" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>, </span>
<span id="cb120-36"><a href="#cb120-36" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>))</span>
<span id="cb120-37"><a href="#cb120-37" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb120-38"><a href="#cb120-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-39"><a href="#cb120-39" aria-hidden="true" tabindex="-1"></a>final_cv_knn.fit(ames_x_train, Sale_Price_train )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  pd.DataFrame(final_cv_knn.named_steps[<span class="st">'cv'</span>].cv_results_) </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.param_metric <span class="op">!=</span> <span class="st">'chebyshev'</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>            _.param_weights <span class="op">==</span> <span class="st">'distance'</span>,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>            _.param_metric <span class="op">==</span> <span class="st">'manhattan'</span>,</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>            _.param_metric <span class="op">!=</span> <span class="st">'hamming'</span>,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>            _.param_n_neighbors <span class="op">&lt;</span><span class="dv">22</span>)</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> mutate(min_err<span class="op">=</span>_.mean_test_r2<span class="op">-</span>_.std_test_r2,max_err<span class="op">=</span>_.mean_test_r2<span class="op">+</span>_.std_test_r2 )</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">&gt;&gt;</span> ggplot(aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"mean_test_r2"</span>, </span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>             shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) <span class="op">+</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="dv">1</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>)) <span class="op">+</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>                  position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.7</span>),show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Parametrización de KNN vs R^2"</span>) <span class="op">+</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ylim([0.6,0.8])+</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Parámetro: Número de vecinos cercanos"</span>) <span class="op">+</span></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">'R ^2 ajustada promedio'</span>)</span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_point : Removed 7 rows containing missing values.
C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\layer.py:364: PlotnineWarning: geom_errorbar : Removed 7 rows containing missing values.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-79-59.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>f_num_knn_reg_fm <span class="op">=</span> Pipeline([</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'prep'</span>,preprocessor),</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'selector'</span>, selectorr ),</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, final_cv_knn.named_steps[<span class="st">'cv'</span>].best_estimator_)</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>f_num_knn_reg_fm .fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('prep',
                 ColumnTransformer(transformers=[('std', StandardScaler(),
                                                  ['Bedroom_AbvGr',
                                                   'BsmtFin_SF_1',
                                                   'BsmtFin_SF_2',
                                                   'Bsmt_Full_Bath',
                                                   'Bsmt_Half_Bath',
                                                   'Bsmt_Unf_SF',
                                                   'Enclosed_Porch',
                                                   'Fireplaces', 'First_Flr_SF',
                                                   'Full_Bath', 'Garage_Area',
                                                   'Garage_Cars', 'Gr_Liv_Area',
                                                   'Half_Bath', 'Kitchen_AbvGr',
                                                   'Latitude', 'Longitude',
                                                   'Lot_Area', 'Lot_Frontage'...
                                                   'Lot_Area', 'Kitchen_AbvGr',
                                                   'Second_Flr_SF',
                                                   'Mas_Vnr_Area', 'Half_Bath',
                                                   'Bsmt_Full_Bath',
                                                   'Open_Porch_SF',
                                                   'Year_Remod_Add',
                                                   'TotRms_AbvGrd', 'Full_Bath',
                                                   'Garage_Cars', 'Garage_Area',
                                                   'Fireplaces',
                                                   'Total_Bsmt_SF',
                                                   'First_Flr_SF',
                                                   'Gr_Liv_Area'])],
                                   verbose_feature_names_out=False)),
                ('regressor',
                 KNeighborsRegressor(metric='manhattan', n_neighbors=4, p=3,
                                     weights='distance'))])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> f_num_knn_reg_fm .predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span> (best_features_from_fm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           2937.5947
MAE         20591.1171
MAPE            0.1154
MSE    1340900233.6616
RMSE        36618.3046
R2              0.7928
R2Adj           0.7300</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>voting <span class="op">=</span> VotingRegressor(</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'knn_num'</span>, f_num_knn_reg),</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'knn_fm'</span>, f_num_knn_reg_fm)],</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  weights  <span class="op">=</span> [<span class="fl">0.9</span>, <span class="fl">0.1</span>]</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> <span class="bu">list</span>(f_num_knn_reg.named_steps[<span class="st">'selector'</span>].get_feature_names_out())</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>m3 <span class="op">=</span> <span class="bu">list</span>(f_num_knn_reg_fm.named_steps[<span class="st">'selector'</span>].get_feature_names_out())</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span><span class="bu">list</span>( <span class="bu">set</span>(m1<span class="op">+</span>m3 ))</span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a>voting.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>VotingRegressor(estimators=[('knn_num',
                             Pipeline(steps=[('prep',
                                              ColumnTransformer(transformers=[('std',
                                                                               StandardScaler(),
                                                                               ['Bedroom_AbvGr',
                                                                                'BsmtFin_SF_1',
                                                                                'BsmtFin_SF_2',
                                                                                'Bsmt_Full_Bath',
                                                                                'Bsmt_Half_Bath',
                                                                                'Bsmt_Unf_SF',
                                                                                'Enclosed_Porch',
                                                                                'Fireplaces',
                                                                                'First_Flr_SF',
                                                                                'Full_Bath',
                                                                                'Garage_Area',
                                                                                'Garage_Cars',
                                                                                'Gr_Liv_Area',
                                                                                'Half_Bath',
                                                                                'Kitchen_AbvGr',
                                                                                'Latitude...
                                                                                'Second_Flr_SF',
                                                                                'Mas_Vnr_Area',
                                                                                'Half_Bath',
                                                                                'Bsmt_Full_Bath',
                                                                                'Open_Porch_SF',
                                                                                'Year_Remod_Add',
                                                                                'TotRms_AbvGrd',
                                                                                'Full_Bath',
                                                                                'Garage_Cars',
                                                                                'Garage_Area',
                                                                                'Fireplaces',
                                                                                'Total_Bsmt_SF',
                                                                                'First_Flr_SF',
                                                                                'Gr_Liv_Area'])],
                                                                verbose_feature_names_out=False)),
                                             ('regressor',
                                              KNeighborsRegressor(metric='manhattan',
                                                                  n_neighbors=4,
                                                                  p=3,
                                                                  weights='distance'))]))],
                weights=[0.9, 0.1])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> voting.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [0, 11, 16, 17, 18, 19, 26] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, Sale_Price_test, <span class="bu">len</span>(predictors) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Value
Metric                
ME           3384.2258
MAE         20073.4752
MAPE            0.1118
MSE    1142817664.2163
RMSE        33805.5863
R2              0.8234
R2Adj           0.8178</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> Sale_Price_test</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">=</span> (</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  ames_x_test <span class="op">&gt;&gt;</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span> Sale_Price_test)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> y_obs, y <span class="op">=</span> y_pred)) <span class="op">+</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>    geom_point(alpha<span class="op">=</span><span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>] ) <span class="op">+</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>), limits <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">600000</span>]) <span class="op">+</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)</span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-82-61.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 89'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-82-62.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>)</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-82-63.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>ames_test <span class="op">&gt;&gt;</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  geom_linerange(aes(ymin <span class="op">=</span> <span class="dv">0</span>, ymax <span class="op">=</span> <span class="st">"error"</span>), colour <span class="op">=</span> <span class="st">"purple"</span>) <span class="op">+</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  geom_point(aes(y <span class="op">=</span> <span class="st">"error"</span>), size <span class="op">=</span> <span class="fl">0.05</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>) <span class="op">+</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  geom_abline(intercept <span class="op">=</span> <span class="dv">0</span>, slope <span class="op">=</span> <span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Precio real"</span>) <span class="op">+</span> ylab(<span class="st">"Error de estimación"</span>) <span class="op">+</span></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Relación entre error y precio de venta"</span>)</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-82-64.png" class="img-fluid" width="614"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># validation_results(</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="co">#       x_val = ames_x_val,</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co">#       y_val = Sale_Price_validation, </span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co">#       pipeline = voting, </span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       n_preds=18)</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>      </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>