<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Uriel Alexis Luna López">

<title>EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="EDA_files/libs/clipboard/clipboard.min.js"></script>
<script src="EDA_files/libs/quarto-html/quarto.js"></script>
<script src="EDA_files/libs/quarto-html/popper.min.js"></script>
<script src="EDA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EDA_files/libs/quarto-html/anchor.min.js"></script>
<link href="EDA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EDA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EDA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EDA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EDA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EDA</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Uriel Alexis Luna López </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="analisís-de-las-variables" class="level1">
<h1>Analisís de las variables</h1>
<section id="descripción-de-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="descripción-de-las-variables">Descripción de las variables</h2>
<section id="variables-continuas-y-númericas" class="level3">
<h3 class="anchored" data-anchor-id="variables-continuas-y-númericas">Variables continuas y númericas</h3>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 74%">
</colgroup>
<thead>
<tr class="header">
<th><h1 id="variable">Variable</h1></th>
<th style="text-align: left;">Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lot_Frontage (Continua)</td>
<td style="text-align: left;">Loguitud que conectan la calle con la propiedad (en pies)</td>
</tr>
<tr class="even">
<td>Lot Area (Continua)</td>
<td style="text-align: left;">Tamaño del lote en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Mas Vnr Area (Continua)</td>
<td style="text-align: left;">Área de revestimiento de mampostería en pies cuadrados</td>
</tr>
<tr class="even">
<td>BsmtFin SF 1 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 1 en pies cuadrados</td>
</tr>
<tr class="odd">
<td>BsmtFin SF 2 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 2 en pies cuadrados</td>
</tr>
<tr class="even">
<td>Bsmt Unf SF (Continua)</td>
<td style="text-align: left;">Área sin terminar del sótano en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Total Bsmt SF (Continua)</td>
<td style="text-align: left;">Área total del sótano</td>
</tr>
<tr class="even">
<td>1st Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrqados del primer piso</td>
</tr>
<tr class="odd">
<td>2nd Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados del segundo piso</td>
</tr>
<tr class="even">
<td>Low Qual Area SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados terminados de baja calidad</td>
</tr>
<tr class="odd">
<td>Gr Liv Area (Continua)</td>
<td style="text-align: left;">Superficie habitable sobre el nivel del suelo en pies cuadrados</td>
</tr>
<tr class="even">
<td>Wood Deck SF (Continua)</td>
<td style="text-align: left;">Área de cubierta de madera en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Open Porch SF (Continua)</td>
<td style="text-align: left;">Área abierta del porche en pies cuadrados</td>
</tr>
<tr class="even">
<td>Enclose Porch (Continua)</td>
<td style="text-align: left;">Área cerrada del proche en pies cuadrados</td>
</tr>
<tr class="odd">
<td>3-Ssn Porch (Continua)</td>
<td style="text-align: left;">Área de porche de tres estaciones en pies cuadrados</td>
</tr>
<tr class="even">
<td>Screen Porch (Continua)</td>
<td style="text-align: left;">Área del porche cubierto en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Pool Area (Continua)</td>
<td style="text-align: left;">Área de la piscina en pies cuadrados</td>
</tr>
<tr class="even">
<td>Misc Val (Continua)</td>
<td style="text-align: left;">Valor de la característica miscelanea</td>
</tr>
<tr class="odd">
<td><strong>Sale_Price (Continua)</strong></td>
<td style="text-align: left;">Precio de venta.</td>
</tr>
<tr class="even">
<td>Year Built (Discreta)</td>
<td style="text-align: left;">Año original de construcción</td>
</tr>
<tr class="odd">
<td>Year Remod/Add (Discreta)</td>
<td style="text-align: left;">Fecha de remodelación (la misma que la fecha de construcción si no se ha remodelado)</td>
</tr>
<tr class="even">
<td>Bsmt Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos en el sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños en el sótano</td>
</tr>
<tr class="even">
<td>Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños sobre el nivel del suelo</td>
</tr>
<tr class="even">
<td>Kitchen (Discreta)</td>
<td style="text-align: left;">Concinas sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>TotRmsAbvGrd</td>
<td style="text-align: left;">Total de habitaciones sobre el nivel del suelo (no incluye baños)</td>
</tr>
<tr class="even">
<td>Fireplaces (Discreta)</td>
<td style="text-align: left;">Número de chimeneas</td>
</tr>
<tr class="odd">
<td>Garage Yr Blt (Discreta)</td>
<td style="text-align: left;">Año en que se construyó el garage</td>
</tr>
<tr class="even">
<td>Garage Cars (Discreta)</td>
<td style="text-align: left;">Tamaño del garage en cuanto a capacidad para autos.</td>
</tr>
<tr class="odd">
<td>Mo Sold (Discreta)</td>
<td style="text-align: left;">Mes de la venta (MM)</td>
</tr>
<tr class="even">
<td>Yr Sold (Discreta)</td>
<td style="text-align: left;">Año de la venta (YYYY)</td>
</tr>
</tbody>
</table>
</section>
<section id="varaibles-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="varaibles-categóricas">Varaibles categóricas</h3>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MS_Subclass (Nominal)</td>
<td>Identifica el tipo de vivienda de la venta</td>
</tr>
<tr class="even">
<td>MS_Zoning (Nominal)</td>
<td>Identifica la clasificación de la zona asociada a la venta</td>
</tr>
<tr class="odd">
<td>Street (Nominal)</td>
<td>Tipo de camino de acceso a la propiedad</td>
</tr>
<tr class="even">
<td>Alley (Nominal)</td>
<td>Tipo de callejón de acceso a la propiedad</td>
</tr>
<tr class="odd">
<td>Lot Contour (Nominal)</td>
<td>Planitud de la propiedad</td>
</tr>
<tr class="even">
<td>Lot Config (Nominal)</td>
<td>Configurarición del lote</td>
</tr>
<tr class="odd">
<td>Neightboorhood (Nominal)</td>
<td>Ubicación física dentro de los límites de la ciudad de Ames</td>
</tr>
<tr class="even">
<td>Condition 1 (Nominal)</td>
<td>Proximidad a varias condiciones</td>
</tr>
<tr class="odd">
<td>Condition 2 (Nominal)</td>
<td>Proximidad a varias condiciones (Si más de una es presente)</td>
</tr>
<tr class="even">
<td>Bldg Type (Nominal)</td>
<td>Tipo de vivienda</td>
</tr>
<tr class="odd">
<td>House Style (Nominal)</td>
<td>Estilo de la vivienda</td>
</tr>
<tr class="even">
<td>Roof Style (Nominal)</td>
<td>Tipo de techo</td>
</tr>
<tr class="odd">
<td>Roof Matl (Nominal)</td>
<td>Material del techo</td>
</tr>
<tr class="even">
<td>Exterior 1 (Nominal)</td>
<td>Revestimiento exterior de la casa</td>
</tr>
<tr class="odd">
<td>Exterior 2 (Nominal)</td>
<td>Revestimiento exterior de la casa (Si hay más de un material)</td>
</tr>
<tr class="even">
<td>Mas Vnr Type (Nominal)</td>
<td>Tipo de revestimiento de mampostería</td>
</tr>
<tr class="odd">
<td>Foundation (Nominal)</td>
<td>Tipo de cimentación</td>
</tr>
<tr class="even">
<td>Heating (Nominal)</td>
<td>Tipo de calefacción</td>
</tr>
<tr class="odd">
<td>Central Air (Nominal)</td>
<td>Aire acondicionado centralizado</td>
</tr>
<tr class="even">
<td>Garage Type (Nominal)</td>
<td>Ubicación del garage</td>
</tr>
<tr class="odd">
<td>Misc Feature (Nominal)</td>
<td>Característica miscelánea no cubierta en otras categorías</td>
</tr>
<tr class="even">
<td>Sale Type (Nominal)</td>
<td>Tipo de venta</td>
</tr>
<tr class="odd">
<td>Sale Condition (Nominal)</td>
<td>Condicón de la venta.</td>
</tr>
<tr class="even">
<td>Functional (Ordinal)</td>
<td>Funcionalidad del hogar (suponga que es típico a menos que se justifiquen deducciones)</td>
</tr>
<tr class="odd">
<td>FireplaceQu (Ordinal)</td>
<td>Calidad de las chimeneas</td>
</tr>
<tr class="even">
<td>Lot Shape (Ordinal)</td>
<td>Forma general de la propiedad</td>
</tr>
<tr class="odd">
<td>Pool QC (Ordinal)</td>
<td>Calidad de la piscina</td>
</tr>
<tr class="even">
<td>Utilities (Ordinal)</td>
<td>Tipo de utilidades disponibles</td>
</tr>
<tr class="odd">
<td>Land Slope (Ordinal)</td>
<td>Pendiente de la propiedad</td>
</tr>
<tr class="even">
<td>Overall Qual (Ordinal)</td>
<td>Califica el material general y el acabado de la casa.</td>
</tr>
<tr class="odd">
<td>Overall Cond (Ordinal)</td>
<td>Califica la condición general de la casa</td>
</tr>
<tr class="even">
<td>Exter Qual (Ordinal)</td>
<td>Evalua la calidad materiales de los exteriores</td>
</tr>
<tr class="odd">
<td>Exter Cond (Ordinal)</td>
<td>Evalua la condición presente del materia en el exterior</td>
</tr>
<tr class="even">
<td>Bsmt Qua (Ordinal)</td>
<td>Evalua la altura del sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Cond (Ordinal)</td>
<td>Evalua la condición general del sótano</td>
</tr>
<tr class="even">
<td>Bsmt Exposure (Ordinal)</td>
<td>Se refiere a paredes a nivel de jardín o de salida</td>
</tr>
<tr class="odd">
<td>BsmtFin Type 1 (Ordinal)</td>
<td>Calificación del area terminada del sótano</td>
</tr>
<tr class="even">
<td>BsmtFin Type 2 (Ordinal)</td>
<td>Clasificación del área terminada del sótano (si hay varios tipos)</td>
</tr>
<tr class="odd">
<td>Heating QC (Ordinal)</td>
<td>Calidad y condición de la calefacción</td>
</tr>
<tr class="even">
<td>Electrical (Ordinal)</td>
<td>Sistema electrico</td>
</tr>
<tr class="odd">
<td>Kitchen Qaul (Ordinal)</td>
<td>Calidad de la cocina</td>
</tr>
<tr class="even">
<td>Garage Qual (Ordinal)</td>
<td>Calidad del Garage</td>
</tr>
<tr class="odd">
<td>Garage cond (Ordinal)</td>
<td>Condicón del garage</td>
</tr>
<tr class="even">
<td>Paved Drive (Ordinal)</td>
<td>Camino pavimentado.</td>
</tr>
<tr class="odd">
<td>Garage Finish (Ordnal)</td>
<td>El interior del garage esta terminado</td>
</tr>
<tr class="even">
<td>Fence (Ordinal)</td>
<td>Calidad de la cerca.</td>
</tr>
</tbody>
</table>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> siuba <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.tidy <span class="im">import</span> pivot_wider, pivot_longer</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_selection <span class="im">import</span> f_regression, mutual_info_regression</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plydata.one_table_verbs <span class="im">import</span> pull</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mizani.formatters <span class="im">import</span> comma_format, dollar_format</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="analísis-de-sale-price" class="level2">
<h2 class="anchored" data-anchor-id="analísis-de-sale-price">Analísis de Sale Price</h2>
<p>A continuación se muestra el split inicial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ames <span class="op">=</span> (pd.read_excel( <span class="st">'../data/proyecto_ames_train.xlsx'</span>  ).rename(columns <span class="op">=</span> <span class="kw">lambda</span> x: x.replace (<span class="st">' '</span>,<span class="st">'_'</span>) )</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;</span> mutate (Price_4_GLA <span class="op">=</span> _.SalePrice<span class="op">/</span>_.Gr_Liv_Area))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ames.drop(index<span class="op">=</span> <span class="dv">821</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ames <span class="op">&gt;&gt;</span>  pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> select(ames, <span class="op">-</span>_.SalePrice, <span class="op">-</span>_.Price_4_GLA)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>numeric_column <span class="op">=</span> ames <span class="op">&gt;&gt;</span> pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>quartiles <span class="op">=</span> np.percentile(numeric_column, [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una nueva variable categórica basada en los cuartiles</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a> numeric_column, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ames_x_train, ames_x, ames_y_train, ames_y <span class="op">=</span> train_test_split(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                       X, y, </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                       test_size <span class="op">=</span> <span class="fl">0.30</span>, </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a> ames_y , </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>ames_x_test, ames_x_val, ames_y_test, ames_y_val <span class="op">=</span> train_test_split(</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>       ames_x, ames_y, </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>       test_size <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>Sale_Price_train<span class="op">=</span> ames_y_train <span class="op">*</span> np.array(ames_x_train.Gr_Liv_Area)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>Sale_Price_test <span class="op">=</span> ames_y_test <span class="op">*</span> ames_x_test.Gr_Liv_Area</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>Sale_Price_validation <span class="op">=</span> ames_y_val <span class="op">*</span> ames_x_val.Gr_Liv_Area</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Totales:</span><span class="ch">\t</span><span class="st">'</span>, ames.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Training:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_train.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Testing:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_test.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Validation:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_val.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Totales:     1392 
Training:    974 
Testing:     209 
Validation:  209</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>Sale_Price_train, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                annotate(<span class="st">'text'</span>,x<span class="op">=</span><span class="fl">0.3</span>,y<span class="op">=</span><span class="dv">500000</span>, label<span class="op">=</span>summary,ymax<span class="op">=</span><span class="dv">400000</span>)<span class="op">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_dist-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qqplot_Sale_Price-3.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>A diferencia de la distribución de los precios se venta de la casa, el precio por pie cuadrado habitable de la casa parece tener un comportamiento más normal:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> <span class="st">"count: 974</span><span class="ch">\n</span><span class="st">mean: $122.11</span><span class="ch">\n</span><span class="st">std: $32.60</span><span class="ch">\n</span><span class="st">Q1: $100.69</span><span class="ch">\n</span><span class="st">Q2:$120.64</span><span class="ch">\n</span><span class="st">Q3: $141.27</span><span class="ch">\n</span><span class="st">min: $17.87</span><span class="ch">\n</span><span class="st">max:$276.25"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                annotate(<span class="st">'text'</span>,x<span class="op">=</span><span class="fl">0.3</span>,y<span class="op">=</span><span class="dv">200</span>, label<span class="op">=</span>summary,ymax<span class="op">=</span><span class="dv">200</span>)<span class="op">+</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_GLA_DIST-5.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>params<span class="op">=</span>{<span class="st">'loc'</span>:ames_y_train.mean(), <span class="st">'scale'</span>:ames_y_train.std()}</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                ggplot(aes(sample<span class="op">=</span>ames_y_train))<span class="op">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>,distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params)<span class="op">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                stat_qq_line(distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params,color <span class="op">=</span> <span class="st">"red"</span>)<span class="op">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                xlab(<span class="st">"Cuantilies de la dist. normal teórica"</span>) <span class="op">+</span> ylab(<span class="st">"Cuantiles de Sale Price"</span>) <span class="op">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">"QQ-Plot N~(mean=180,996.79, sd=81,186.69)"</span>)<span class="op">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                theme_seaborn()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qq%20plot%20new%20y-7.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-continuas-vs-transformación-de-sale_price" class="level2">
<h2 class="anchored" data-anchor-id="variables-continuas-vs-transformación-de-sale_price">Variables Continuas VS Transformación de Sale_Price</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>continuas <span class="op">=</span> [   <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Lot_Area'</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Mas_Vnr_Area'</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Sale_Price/Gr_Liv_Area'</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">'BsmtFin_SF_1'</span>, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">'BsmtFin_SF_2'</span>, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Bsmt_Unf_SF'</span>, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Total_Bsmt_SF'</span>, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">'1st_Flr_SF'</span>, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                <span class="st">'2nd_Flr_SF'</span>, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                <span class="co"># 'Low_Qual_Area_SF', </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Gr_Liv_Area'</span>, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Wood_Deck_SF'</span>, </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Open_Porch_SF'</span>, </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Enclosed_Porch'</span>, </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                <span class="st">'3Ssn_Porch'</span>, </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Screen_Porch'</span>, </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Pool_Area'</span>, </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Misc_Val'</span>]</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>ames_train <span class="op">=</span> ames_x_train.copy()</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>ames_train[<span class="st">'Sale_Price/Gr_Liv_Area'</span>] <span class="op">=</span> ames_y_train</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>correlation_data <span class="op">=</span> (</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().melt(  ignore_index<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                                        var_name<span class="op">=</span><span class="st">'var1'</span>).reset_index() <span class="op">&gt;&gt;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                    select( _.var1,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                            _.var2 <span class="op">==</span> _.index,</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                            _.cor <span class="op">==</span> _.value  ) </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>labels<span class="op">=</span>(</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span> case_when({_.cor.between(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>):<span class="st">''</span>,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                                    _.cor<span class="op">&gt;</span><span class="fl">0.99991</span>: <span class="st">''</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="va">True</span> :_.cor.<span class="bu">round</span>(<span class="dv">2</span>).astype(<span class="bu">str</span>)})</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        arrange(<span class="op">-</span>_.cor,_.var1) <span class="op">&gt;&gt;</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter (_.var1!=_.var2) &gt;&gt;</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        mutate(labb<span class="op">=</span>labels)<span class="op">&gt;&gt;</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        ggplot(aes(x<span class="op">=</span><span class="st">'var1'</span>, y<span class="op">=</span><span class="st">'var2'</span>, fill<span class="op">=</span> <span class="st">'cor'</span>))<span class="op">+</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        geom_tile()<span class="op">+</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        geom_label(aes(label<span class="op">=</span><span class="st">'labb'</span>), size<span class="op">=</span><span class="dv">6</span>)<span class="op">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        scale_fill_gradientn(colors<span class="op">=</span>[<span class="st">'#0092ff'</span>,<span class="st">'#e6d6c7'</span>,<span class="st">'#FF1400'</span>],</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>                            limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>                            name<span class="op">=</span><span class="st">'Correlación'</span>)<span class="op">+</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        ggtitle(<span class="st">'Mapa de calor de correlaciones para variables continuas'</span>)<span class="op">+</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        xlab(<span class="st">''</span>)<span class="op">+</span>ylab(<span class="st">''</span>)<span class="op">+</span><span class="co">#guides(fill=guide_legend(title="New Legend Title"))+</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        theme(axis_text_x<span class="op">=</span>element_text(rotation<span class="op">=</span><span class="dv">90</span>,hjust <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>                figure_size<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_heatmap_HCC-9.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Como podemos observar para ser que las varaibles de <code>'BsmtFin_SF_1', '2nd_Flr_SF', 'Total_Bsmt_SF'</code> son las que tienen correlaciones más grandes con el precio de venta por el precio por pie cuadrado habitable. En el gráfico sólo se muestran etiquetas de correlaciones que no estan en el intervalo (-0.3.0.3).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().reset_index(drop<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> select(_.spgl <span class="op">==</span> _[<span class="st">'Sale_Price/Gr_Liv_Area'</span>],_.index)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.spgl <span class="op">!=</span> <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> mutate (labels <span class="op">=</span> np.<span class="bu">round</span>(_.spgl, <span class="dv">3</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> arrange(_.spgl)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span><span class="st">'spgl'</span>, x<span class="op">=</span><span class="st">'reorder(index,spgl)'</span>, fill<span class="op">=</span><span class="st">'spgl'</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_col()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(aes(label <span class="op">=</span> <span class="st">'labels'</span>) , size<span class="op">=</span><span class="dv">8</span>, va<span class="op">=</span><span class="st">'center'</span>, angle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> ylim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>])</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area vs otras variables'</span>, y<span class="op">=</span><span class="st">''</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_fill_gradient2(low<span class="op">=</span><span class="st">'#4EB043'</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                           mid<span class="op">=</span><span class="st">'#B05F43'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                           high<span class="op">=</span> <span class="st">'#3A3AD5'</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                           midpoint<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                           limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                           name<span class="op">=</span><span class="st">'Correlación'</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme_bw()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_sp/gla-11.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="precios-dependiendo-la-ubicación" class="level2">
<h2 class="anchored" data-anchor-id="precios-dependiendo-la-ubicación">Precios dependiendo la ubicación</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  ames_train </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> group_by(_.Neighborhood) </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> summarize(media <span class="op">=</span> np.mean(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]), desv<span class="op">=</span>np.std(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> mutate( max_err <span class="op">=</span> _.media  <span class="op">+</span> _.desv, min_err <span class="op">=</span>  _.media  <span class="op">-</span> _.desv)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> arrange(_.media)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot(aes(x<span class="op">=</span><span class="st">'reorder(Neighborhood,media)'</span>, y<span class="op">=</span><span class="st">'media'</span>) ) </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),width<span class="op">=</span><span class="fl">0.3</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>))<span class="op">+</span>geom_point()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_bw()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>coord_flip()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>labs(y<span class="op">=</span><span class="st">'Precio  promedio por pie cuadrado de área habitable'</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/error_bars%20por%20vecindario-13.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-relacionadas-con-el-sótano" class="level2">
<h2 class="anchored" data-anchor-id="variables-relacionadas-con-el-sótano">Variables relacionadas con el sótano</h2>
<p>Se puede ver que se tiene una relación líneal creciente entre <code>Total_Bsmt_SF</code> y <code>Sale_Price\ Gr_Liv_Area</code>, en la siguiente gráfica tambien podemos ver como varios puntos se acumulan en <code>Total_Bsmt_SF = 0</code> debido a que estas casas no cuentan con sótano</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ames_x_train </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot( aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_point(size<span class="op">=</span><span class="dv">1</span>,alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">2500</span>])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Total_Bsmt_SF vs  Sale Price/ Gr_Liv_Area'</span>, x<span class="op">=</span><span class="st">'Total_Bsmt_SF'</span>, y<span class="op">=</span><span class="st">'Sale Price/ Gr_Liv_Area'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_538()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/price%20vs%20sf%20sotano-15.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>En cuanto a las variables categóricas relacionadas al sótano encontramos lo siguiente:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cat_columns <span class="op">=</span> pd.Series([<span class="st">'Bldg_Type'</span>, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Exposure'</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Central_Air'</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1'</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2'</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical'</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence'</span>, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation'</span>, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish'</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type'</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Feature'</span>, </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive'</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC'</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Overall_Cond'</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass'</span>, </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_Zoning'</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond'</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1'</span>, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2'</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style'</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Shape'</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood'</span>])</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> cat_columns[cat_columns.<span class="bu">str</span>.contains(<span class="st">'Bsmt'</span>)]:</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  titulo<span class="op">=</span><span class="st">'Categoría analazada: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category) </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  (ames_train  <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area'</span>, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>, color<span class="op">=</span> <span class="st">'</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category)))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> geom_point(alpha<span class="op">=</span> <span class="fl">0.5</span>, show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'black'</span>, method <span class="op">=</span> <span class="st">'lm'</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">3000</span>])</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>labs(x<span class="op">=</span><span class="st">'Área total del sótano'</span>, y<span class="op">=</span><span class="st">'Precio por pie cuadrado de área habitable bruta'</span>, title<span class="op">=</span>titulo)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> facet_wrap(<span class="st">'~</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category))<span class="op">+</span>theme_538 ()) <span class="op">+</span>theme_minimal()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-17.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-18.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-19.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-20.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Puntos a considerar:</p>
<ul>
<li><p>En <code>Bsmt_Exposure</code> se puede notar que la relación positiva entre las variables se mantiene, y no parece cambiar si se altera la exposicón del sótano. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
<li><p>En <code>Bsmt_Cond</code> se puede ver que la relación de las variables si cambia dependiendo de la condición del sótano, además en la condición de Excellent y Poor se tienen muy pocas observaciones.</p></li>
<li><p>En <code>Bsmt_Type_1</code> se tienen relaciones demaciado planas en su mayoria, a excepción de GLQ y Unf.</p></li>
<li><p>En <code>Bsmt_Type_2</code> se tiene el mismo caso que en el anterior. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
</ul>
</section>
</section>
<section id="fuciones-personalizadas" class="level1">
<h1>Fuciones personalizadas</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder,FunctionTransformer</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, mean_absolute_percentage_error</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, make_scorer</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, KFold, cross_val_score, cross_validate</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.4f}</span><span class="st">'</span>.<span class="bu">format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> importance_from_model (test_frame, y_obs, selected_columns, pipeline, actual_mse, n_permutations<span class="op">=</span><span class="dv">50</span> ,trans_pred<span class="op">=</span> <span class="va">False</span> ):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  performance_losses <span class="op">=</span> []</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_frame[selected_columns].shape[<span class="dv">1</span>]):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> []</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_permutations):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        test_frame_permuted <span class="op">=</span> test_frame[selected_columns].copy()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        test_frame_permuted.iloc[:, i] <span class="op">=</span> np.random.permutation(test_frame_permuted.iloc[:, i])</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> trans_pred <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            y_pred_permuted <span class="op">=</span> pipeline.predict(test_frame_permuted)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            y_pred_permuted <span class="op">=</span> pipeline.predict(test_frame_permuted)<span class="op">*</span> test_frame_permuted.Gr_Liv_Area</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        mse_permuted <span class="op">=</span> mean_squared_error(y_obs, y_pred_permuted)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        loss.append(mse_permuted)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    performance_losses.append(loss)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  performance_losses <span class="op">=</span> performance_losses<span class="op">/</span>np.<span class="bu">sum</span>(performance_losses, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  mean_losses <span class="op">=</span> np.mean(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  std_losses <span class="op">=</span> np.std(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Variable'</span>: selected_columns, </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Mean_Loss'</span>: mean_losses, </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Std_Loss'</span>: std_losses</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> importance_df</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjusted_r2_score(y_true, y_pred, n, p):</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  adjusted_r2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> r2) <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> adjusted_r2</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> div_columns(X, c1, c2):</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    X[<span class="st">"c1_c2"</span>] <span class="op">=</span> X[c1]<span class="op">/</span> X[c2]</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adj_r(y_o, y_p , p, n):</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>  r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2_score(y_o, y_p))</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_metrics (y_pred, y_obs,predictors):</span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred)</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>  mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>  mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred)</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  mse <span class="op">=</span> mean_squared_error(y_obs, y_pred)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_obs, y_pred)</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  n <span class="op">=</span> <span class="bu">len</span>(y_obs)  <span class="co"># Número de observaciones</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> predictors  <span class="co"># Número de predictores </span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>  r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2)</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>  metrics_data <span class="op">=</span> {</span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R2"</span>, <span class="st">"R2Adj"</span>],</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pd.DataFrame(metrics_data).set_index(<span class="st">'Metric'</span>)</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmv_elements (list_of_elements, complete_list):</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> element <span class="kw">in</span> list_of_elements:</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>    complete_list.remove(element)</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> complete_list</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> validation_results(x_val,y_val,  pipeline , n_preds):</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> pipeline.predict(x_val)</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>  ames_test <span class="op">=</span> (</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    ames_x_val <span class="op">&gt;&gt;</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span>y_val))</span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  <span class="co">##### Métricas de desempeño</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>  y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> get_metrics(y_pred, y_obs, n_preds)</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersection(lst1, lst2):</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>    lst3 <span class="op">=</span> [value <span class="cf">for</span> value <span class="kw">in</span> lst1 <span class="cf">if</span> value <span class="kw">in</span> lst2]</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lst3</span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_cv (df, param_p <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> param_p <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>    (df </span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span>, MAPE <span class="op">=</span> <span class="bu">abs</span> (_.mean_test_mape))</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>                      cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'MAPE'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>                      names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>                      values_to<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) </span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="fl">0.9</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )).draw(<span class="va">True</span>)</span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>    (df </span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span> , MAPE <span class="op">=</span> <span class="bu">abs</span> (_.mean_test_mape))</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>                      cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'MAPE'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>                      names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>                      values_to<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>,size <span class="op">=</span> <span class="st">'param_p'</span>)) </span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="fl">0.9</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )).draw(<span class="va">True</span>)</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> div_columns(X, c1, c2, feature_name ):</span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> feature_name<span class="op">+</span><span class="st">'_c_'</span></span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>    X[c1] <span class="op">=</span> X[c1].astype(<span class="bu">float</span>)</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>    X[c2] <span class="op">=</span> X[c2].astype(<span class="bu">float</span>)</span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>    X[name] <span class="op">=</span> X[c1]<span class="op">/</span> X[c2]</span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X[[name]]</span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> div_columns2(X, c1, c2, feature_name ):</span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> feature_name<span class="op">+</span><span class="st">'_c_'</span></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>    X[c1] <span class="op">=</span> X[c1].astype(<span class="bu">float</span>)</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>    X[c2] <span class="op">=</span> X[c2].astype(<span class="bu">float</span>)</span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>    X[name] <span class="op">=</span> X[c1]<span class="op">/</span> X[c2]</span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X[[name]].fillna(<span class="dv">0</span>)</span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> collapse(X, c1, dic):</span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> X[[c1]].replace(dic)</span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cross_interactions (X, num, cat, return_inputs <span class="op">=</span> <span class="st">'none'</span>):</span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>    return_cols <span class="op">=</span> []</span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> X.<span class="bu">filter</span>(regex<span class="op">=</span>(cat)).copy()</span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> column <span class="kw">in</span> df.columns.to_list():</span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>      name <span class="op">=</span> column <span class="op">+</span> <span class="st">'_x_'</span><span class="op">+</span> num</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>      X[name] <span class="op">=</span> df[column] <span class="op">*</span> X[num]</span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>      return_cols.append(name)</span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> return_inputs <span class="op">==</span> <span class="st">'none'</span>:</span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols]</span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'both'</span>:</span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> df.columns.to_list() <span class="op">+</span> [num]]</span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'num'</span>:</span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> [num]]</span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols<span class="op">+</span> df.columns.to_list()]</span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cross_interactions2 (X, num, cat, return_inputs <span class="op">=</span> <span class="st">'none'</span>):</span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a>    return_cols <span class="op">=</span> []</span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> X.<span class="bu">filter</span>(regex<span class="op">=</span>(cat)).copy()</span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a>    df2 <span class="op">=</span> X.<span class="bu">filter</span>(regex<span class="op">=</span>(num)).copy()</span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col_num <span class="kw">in</span> df2.columns.to_list():</span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> column <span class="kw">in</span> df.columns.to_list():</span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> column <span class="op">+</span> <span class="st">'_x_'</span><span class="op">+</span> col_num</span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a>        X[name] <span class="op">=</span> df[column] <span class="op">*</span> X[col_num]</span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a>        return_cols.append(name)</span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> return_inputs <span class="op">==</span> <span class="st">'none'</span>:</span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols]</span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'both'</span>:</span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> df.columns.to_list() <span class="op">+</span> df2.columns.to_list()]</span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'num'</span>:</span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> df2.columns.to_list()]</span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols<span class="op">+</span> df.columns.to_list()]</span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> antique_func(X,yb, yr):</span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (X <span class="op">&gt;&gt;</span> mutate (Antique_c_ <span class="op">=</span> <span class="dv">2023</span> <span class="op">-</span> _[yb], Last_remod_c_ <span class="op">=</span> <span class="dv">2023</span> <span class="op">-</span> _[yr], Antique2_c_<span class="op">=</span>(<span class="dv">2023</span> <span class="op">-</span> _[yb])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a>          <span class="op">&gt;&gt;</span> select (_.contains (<span class="st">'_c_'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="regresión-líneal" class="level1">
<h1>Regresión Líneal</h1>
<section id="preparación-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="preparación-de-los-datos">Preparación de los datos</h2>
<p>En la documentación del dataset podemos encontrar información útil para saber como imputar los NA’s , se creó un <code>ColumnTransformer()</code> con el nombre de <code>clean_and_imputer</code>, este transformador hace lo siguiente:</p>
<ul>
<li><p>Elimina columnas que potencialmente podría provocar data leakage o son poco informativas.</p></li>
<li><p>Imputación de NA’s de variables categorias y númericas de acuerdo a la documentación de los datos.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_selector</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>n_usefull <span class="op">=</span> [<span class="st">'Sale_Type'</span>, <span class="st">'Sale_Condition'</span>, <span class="st">'Pool_QC'</span>, <span class="st">'Pool_Area'</span>, <span class="st">'Yr_Sold'</span>]</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NA de Alley are no_alley ACCES</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># na de Mas_Vnr_Type es none</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># NA EN Bsmt_Qual es No_basement</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#remember quit "No_Basement" cat</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># electrical imput mode</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># no fire place imput 'No_Fireplace'</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>clean_and_imputers <span class="op">=</span> ColumnTransformer(</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    [(<span class="st">'not_usefull_variables'</span>, <span class="st">'drop'</span>, n_usefull),</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Alley'</span>, SimpleImputer(</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Alley_Access'</span>), [<span class="st">'Alley'</span>]),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Mas_Vnr_Type'</span>, SimpleImputer(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'None'</span>), [<span class="st">'Mas_Vnr_Type'</span>]),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Mas_Vnr_Area'</span>, SimpleImputer(</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), [<span class="st">'Mas_Vnr_Area'</span>]),</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Lot_Frontage'</span>, SimpleImputer(</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'mean'</span>), [<span class="st">'Lot_Frontage'</span>]),</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Fireplace_Qu'</span>, SimpleImputer(</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Fireplace'</span>), [<span class="st">'Fireplace_Qu'</span>]),</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Electrical'</span>, SimpleImputer(</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'most_frequent'</span>),[<span class="st">'Electrical'</span>]),</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Bsmt_Cat'</span>, SimpleImputer(</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Basement'</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Bsmt'</span>,dtype_include <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Bsmt_Numeric'</span>, SimpleImputer(</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Bsmt'</span>,dtype_exclude <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Garage'</span>, SimpleImputer(</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Garage'</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Garage'</span>,dtype_include <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Garage_numeric'</span>, SimpleImputer(</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Garage'</span>,dtype_exclude <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Fence'</span>, SimpleImputer(</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Fence'</span>), [<span class="st">'Fence'</span>]),</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Misc_Feature'</span>, SimpleImputer(</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'None'</span>), [<span class="st">'Misc_Feature'</span>])</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span> <span class="st">'passthrough'</span>,</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>clean_ames_x_train <span class="op">=</span> clean_and_imputers.fit_transform(ames_x_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-engineering" class="level2">
<h2 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h2>
<p>En este <code>ColumnTransformer()</code> se crean diferentes variables o se módifican algunas otras, en resumen el siguente transformador hace lo siguiente:</p>
<ul>
<li><p>Se crean 11 variables que en su mayoría se refieren a proporciones.</p></li>
<li><p>Se colapsan las columnas de las variables <code>Overall_Cond</code> y <code>Overall_Qual</code>.</p></li>
<li><p>Todas estas transformaciones fueron hechas con <code>FunctionTransformer()</code> utilizando funciones creadas de manera propia que se encuentran en el apartado de <strong>Funciones personalizadas</strong></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cond <span class="op">=</span>{<span class="dv">1</span>: <span class="st">'Poor'</span>, <span class="dv">2</span>:<span class="st">'Poor'</span>,<span class="dv">3</span>:<span class="st">'Poor'</span>,<span class="dv">4</span>:<span class="st">'Average'</span>, <span class="dv">5</span>:<span class="st">'Average'</span>,<span class="dv">6</span>:<span class="st">'Average'</span>, <span class="dv">7</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">8</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">9</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">10</span> :<span class="st">'Good_or_Excellent'</span>}</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>feature_eng <span class="op">=</span> ColumnTransformer(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'collapse_cond'</span>,  FunctionTransformer(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                                 collapse,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Overall_Cond'</span>, <span class="st">'dic'</span> : cond }</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Overall_Cond'</span>]),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'collapse_cond2'</span>,  FunctionTransformer(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                                 collapse,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Overall_Qual'</span>, <span class="st">'dic'</span> : cond }</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Overall_Qual'</span>]),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Area_Per_Room'</span>,  FunctionTransformer(</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c2'</span>: <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'c1'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Area_Per_Room'</span>}</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'TotRms_AbvGrd'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Wood_propGLA'</span>,  FunctionTransformer(</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Wood_Deck_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Wood_propGLA'</span>}</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Wood_Deck_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'MVNRA_prop'</span>,  FunctionTransformer(</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Mas_Vnr_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Lot_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'MVNRA_propLA'</span>}</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Mas_Vnr_Area'</span>, <span class="st">'Lot_Area'</span>]),</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2nd_Flr_SF_propGLA'</span>,  FunctionTransformer(</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'2nd_Flr_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'2nd_Flr_SF_propGLA'</span>}</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'2nd_Flr_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Bsmt_Prop'</span>,  FunctionTransformer(</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Total_Bsmt_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Bsmt_Prop'</span>}</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Total_Bsmt_SF'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Time_var'</span>,  FunctionTransformer(</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>                                 antique_func,</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'yb'</span>: <span class="st">'Year_Built'</span>, <span class="st">'yr'</span>: <span class="st">'Year_Remod/Add'</span>}</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Year_Built'</span>, <span class="st">'Year_Remod/Add'</span>]),</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Gr_Liv_Area / Loot_Area'</span>,  FunctionTransformer(</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Lot_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Gr_Liv_A/Loot_A'</span>}</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Gr_Liv_Area'</span>, <span class="st">'Lot_Area'</span>] ),</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Garage_Prop_overGLA'</span>,  FunctionTransformer(</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Garage_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Garage_Prop_overGLA'</span>}</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Garage_Area'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'1s_Floor_prop'</span>,  FunctionTransformer(</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'1st_Flr_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'1s_Floor_prop'</span>}</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'1st_Flr_SF'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'just_select'</span>, <span class="st">'passthrough'</span>, [<span class="st">'Total_Bsmt_SF'</span>,<span class="st">'2nd_Flr_SF'</span>, <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'1st_Flr_SF'</span>, <span class="st">'Year_Built'</span>, <span class="st">'Year_Remod/Add'</span>, <span class="st">'Garage_Area'</span>, <span class="st">'Lot_Area'</span>, <span class="st">'Gr_Liv_Area'</span>, <span class="st">'Mas_Vnr_Area'</span>,<span class="st">'Wood_Deck_SF'</span> ])],</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>feature_eng_df <span class="op">=</span> feature_eng.fit_transform(clean_ames_x_train)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>my_features <span class="op">=</span> (feature_eng_df<span class="op">&gt;&gt;</span> select (_.contains(<span class="st">'_c_'</span>))).columns.to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preprocesado-de-los-datos" class="level2">
<h2 class="anchored" data-anchor-id="preprocesado-de-los-datos">Preprocesado de los datos</h2>
<p>Una vez se limpiaron los datos y se crearon variables, se define el preprocesado para hacer el One Hot Encoding y la estandarización de variables seleccionadas, <code>preprocesor_1</code> es un transformador que estandariza algunas variables númericas y aplica <code>OneHotEncoder()</code> a todas las variables del tipo <code>Object</code>, colapsando categorias que tienen menos de 12 datos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span>[<span class="st">'Wood_Deck_SF'</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'1st_Flr_SF'</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Open_Porch_SF'</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Enclosed_Porch'</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Area'</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Total_Bsmt_SF'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Area'</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Gr_Liv_Area'</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Full_Bath'</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'3Ssn_Porch'</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_1'</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_2'</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Unf_SF'</span>,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Half_Bath'</span>,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Kitchen_AbvGr'</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mas_Vnr_Area'</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Val'</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bedroom_AbvGr'</span>]</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>preprocessor_1 <span class="op">=</span> ColumnTransformer(</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler(), num_cols),</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'just_select'</span>, <span class="st">'passthrough'</span>, my_features ),</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'OHE'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown<span class="op">=</span><span class="st">'infrequent_if_exist'</span> , sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency <span class="op">=</span> <span class="dv">12</span>), make_column_selector(dtype_include  <span class="op">=</span> <span class="st">'object'</span>))],</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>prep_df <span class="op">=</span> preprocessor_1.fit_transform(feature_eng_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resultados-preeliminares-del-modelo-líneal" class="level2">
<h2 class="anchored" data-anchor-id="resultados-preeliminares-del-modelo-líneal">Resultados preeliminares del modelo líneal</h2>
<p>A continuación se muestran las métricas de test con el full model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lm_pre <span class="op">=</span> Pipeline([</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'clean_data'</span>, clean_and_imputers),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'feat_eng'</span>, feature_eng),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocessor'</span>, preprocessor_1),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, LinearRegression())])</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>lm_pre.fit(ames_x_train, ames_y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> lm_pre.predict(ames_x_test) <span class="op">*</span> ames_x_test.Gr_Liv_Area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> Sale_Price_test</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>predictores <span class="op">=</span> prep_df.shape[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>Métrcias de desempeño del full-model</em></p>
’

<table class="dataframe table table-sm table-striped small">

<thead>

<tr>

<th>
</th>

<th>
Value
</th>

</tr>

<tr>

<th>
Metric
</th>

<th>
</th>

</tr>

</thead>

<tbody>

<tr>

<th>
ME
</th>

<td>
-2895.0550
</td>

</tr>

<tr>

<th>
MAE
</th>

<td>
18905.1272
</td>

</tr>

<tr>

<th>
MAPE
</th>

<td>
0.1147
</td>

</tr>

<tr>

<th>
MSE
</th>

<td>
907321176.9738
</td>

</tr>

<tr>

<th>
RMSE
</th>

<td>
30121.7725
</td>

</tr>

<tr>

<th>
R2
</th>

<td>
0.8862
</td>

</tr>

<tr>

<th>
R2Adj
</th>

<td>
-2.9451
</td>

</tr>

</tbody>


</table>
<p>’</p>
</section>
<section id="mejora-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="mejora-del-modelo">Mejora del modelo</h2>
<p>Se crearon dos transformadores adicionales; <code>interactions</code>, el cual crea intercaciones entre diferentes variables y <code>step_rm</code> el cual elimina columnas que no aportan al modelo antes de aplicar la regresión.</p>
<p>Durante este proceso se fueron creando diferentes interacciones y se removieron variables tomando en cuenta los contrastes de hipotesis del modelo, se dejaron las interacciones que mostraron mejores resultados, al igual que las variables que se decidieron remover para buscar el modelo más parsimonioso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>interactions <span class="op">=</span> ColumnTransformer(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'Garage_interaction'</span>, FunctionTransformer(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Garage_Prop_overGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Garage_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Garage_Qual|Garage_Prop_overGLA_c_'</span>)),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'inter_kitchen'</span>, FunctionTransformer(</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Kitchen_AbvGr'</span>, <span class="st">'cat'</span>: <span class="st">'Kitchen_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Kitchen_Qual|Kitchen_AbvGr'</span>)),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Last_remod_c_'</span>, FunctionTransformer(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Gr_Liv_A/Loot_A_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Gr_Liv_A/Loot_A_c_'</span>, <span class="st">'return_inputs'</span>:<span class="st">'num'</span>}</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Gr_Liv_A/Loot_A_c_'</span>)),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'1s_Floor_prop_c_|Overall_Q'</span>, FunctionTransformer(</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'1s_Floor_prop_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Overall_Q'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'1s_Floor_prop_c_|Overall_Q'</span>)),</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Bsmt_Qual|Bsmt_Prop_c_'</span>, FunctionTransformer(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Bsmt_Prop_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Bsmt_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Bsmt_Qual|Bsmt_Prop_c_'</span>)),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Area_Per_Room_c_|Overall'</span>, FunctionTransformer(</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'2nd_Flr_SF_propGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Antique'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'2nd_Flr_SF_propGLA_c_|Antique'</span>)),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'MVNRA_propGLA_c_|Mas_Vnr_Type'</span>, FunctionTransformer(</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'MVNRA_propLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Mas_Vnr_Type'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'MVNRA_propLA_c_|Mas_Vnr_Type'</span>)),</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Wood_propGLA_c_|Fireplaces'</span>, FunctionTransformer(</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Wood_propGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Fireplaces'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Wood_propGLA_c_|Fireplaces'</span>)),</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Wood_propGLA_c_|Antique'</span>, FunctionTransformer(</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'cat'</span>: <span class="st">'Neighborhood'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Gr_Liv_Area|Neighborhood_C|Neighborhood_[STN]'</span>)),</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'TO_DROP_'</span>, <span class="st">'drop'</span>, make_column_selector(<span class="st">'No_Basement|No_Garage|Exterior|Land|Fence'</span>)) ],</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>drop_cols<span class="op">=</span>[<span class="st">'2nd_Flr_SF'</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'3Ssn_Porch'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_IDOTRR'</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_Gd'</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Alley_No_Alley_Access'</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_StoneBr_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_SF_1'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Alley_Pave'</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_BrkSide'</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_SawyerW_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_SawyerW'</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Edwards'</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bedroom_AbvGr'</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_Fa'</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_2fmCon'</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Timber_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Timber'</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_NWAmes_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Somerst_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_Duplex'</span>,<span class="st">'Condition_1_infrequent_sklearn'</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_MeadowV_x_Gr_Liv_Area',</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Roof_Style_infrequent_sklearn'</span>,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_Twnhs'</span>,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_TwnhsE'</span>,</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_SF_2'</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_BLQ'</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_GLQ'</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_SWISU_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mas_Vnr_Type_None_x_MVNRA_propLA_c_'</span>,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Bsmt_Qual_Fa',</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_ClearCr'</span>,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_LwQ'</span>,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_Rec'</span>,</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_TA'</span>,</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'TotRms_AbvGrd',</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_Unf'</span>,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_BLQ'</span>,</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_GLQ'</span>,</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_LwQ'</span>,<span class="st">'Neighborhood_CollgCr_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># '1st_Flr_SF',</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_None_x_MVNRA_propGLA_c_',</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_Stone_x_MVNRA_propGLA_c_',</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_Rec'</span>,</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_Mitchel_x_Gr_Liv_Area',</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_infrequent_sklearn_x_MVNRA_propGLA_c_',</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_Unf'</span>,</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_TA_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Cond_Gd'</span>,</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fireplace_Qu_Po'</span>,</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Cond_TA'</span>,</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Cond_infrequent_sklearn'</span>,</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Exposure_Mn'</span>,</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Exposure_No'</span>,</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_PConc'</span>,</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Heating_QC_Fa',</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Functional_infrequent_sklearn',</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_infrequent_sklearn',</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Full_Bath'</span>,</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Half_Bath'</span>,</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Bsmt_Qual_Fa',</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Condition_1_Norm',</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_Gd_x_Bsmt_Prop_c_'</span>,</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Exter_Qual_TA',</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Exter_Qual_Gd',</span></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Exter_Qual_Fa',</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_No_Basement'</span>,</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_No_Basement_x_Bsmt_Prop_c_'</span>,</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mas_Vnr_Type_infrequent_sklearn_x_MVNRA_propLA_c_'</span>,</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_TA_x_Bsmt_Prop_c_'</span>,</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Unf_SF'</span>,</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_MeadowV',</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Overall_Cond_Good_or_Excellent'</span>,</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Central_Air_Y'</span>,</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Condition_1_Feedr'</span>,</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Condition_2_infrequent_sklearn'</span>,</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Overall_Cond_Poor'</span>,</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Fireplaces'</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># '1st_Flr_SF',</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Functional_Typ',</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Electrical_FuseF'</span>,</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Electrical_SBrkr'</span>,</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Electrical_infrequent_sklearn'</span>,</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_infrequent_sklearn',</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_None',</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Enclosed_Porch'</span>,</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exter_Cond_Gd'</span>,</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exter_Cond_TA'</span>,</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fireplace_Qu_infrequent_sklearn'</span>,</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_CBlock'</span>,</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_Slab'</span>,</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_infrequent_sklearn'</span>,</span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Full_Bath'</span>,</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Functional_Min2'</span>,</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Cars'</span>,</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Cond_TA'</span>,</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Cond_infrequent_sklearn'</span>,</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Finish_RFn'</span>,</span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Finish_Unf'</span>,</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_No_Garage'</span>,</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_No_Garage_x_Garage_Prop_overGLA_c_'</span>,</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_infrequent_sklearn'</span>,</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_infrequent_sklearn_x_Garage_Prop_overGLA_c_'</span>,</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Type_BuiltIn'</span>,</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Type_Detchd'</span>,</span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Type_infrequent_sklearn'</span>,</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Yr_Blt'</span>,</span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Half_Bath'</span>,</span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Heating_QC_Gd'</span>,</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Heating_QC_infrequent_sklearn'</span>,</span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Heating_infrequent_sklearn'</span>,</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_1Story'</span>,</span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_2Story'</span>,</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_SFoyer'</span>,</span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_SLvl'</span>,</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_infrequent_sklearn'</span>,</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_infrequent_sklearn'</span>,</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_infrequent_sklearn_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Last_remod_c_'</span>,</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Area'</span>,</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_CulDSac'</span>,</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_FR2'</span>,</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_Inside'</span>,</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_infrequent_sklearn'</span>,</span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Shape_IR2'</span>,</span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Shape_Reg'</span>,</span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Shape_infrequent_sklearn'</span>,</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low_Qual_Fin_SF'</span>,</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_SubClass'</span>,</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_Zoning_RL'</span>,</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_Zoning_RM'</span>,</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_Zoning_infrequent_sklearn'</span>,</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mas_Vnr_Area'</span>,</span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Misc_Feature_Shed'</span>,</span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mo_Sold'</span>,</span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Crawfor'</span>,</span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_NoRidge'</span>,</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_NridgHt'</span>,</span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Somerst'</span>,</span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_infrequent_sklearn'</span>,</span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Open_Porch_SF'</span>,</span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Overall_Qual_Poor_x_1s_Floor_prop_c_'</span>,</span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Paved_Drive_P'</span>,</span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Paved_Drive_Y'</span>,</span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Roof_Style_Hip'</span>,</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Roof_Matl_infrequent_sklearn'</span>,</span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Functional_infrequent_sklearn',</span></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Wood_Deck_SF'</span>,</span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Area'</span>,<span class="st">'Kitchen_Qual_Gd_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Screen_Porch'</span>,</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Street_infrequent_sklearn'</span>,</span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Total_Bsmt_SF'</span>,</span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_TA'</span>,</span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_Fa_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Utilities_infrequent_sklearn'</span></span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>        <span class="co">#############removing sf</span></span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a>step_rm <span class="op">=</span>ColumnTransformer(</span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'TO_DROP'</span>, <span class="st">'drop'</span>, drop_cols )],</span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creación-del-pipiline-final-y-analísis-de-resultados" class="level2">
<h2 class="anchored" data-anchor-id="creación-del-pipiline-final-y-analísis-de-resultados">Creación del pipiline final y analísis de resultados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pipeline_linreg <span class="op">=</span> Pipeline([</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'clean_data'</span>, clean_and_imputers),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'feat_eng'</span>, feature_eng),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocessor'</span>, preprocessor_1),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'interactions'</span>, interactions),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'remove'</span>, step_rm),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, LinearRegression())])</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>pipeline_linreg.fit(ames_x_train, ames_y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> step_rm.fit_transform(interactions.fit_transform(prep_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuaci’on se muestra el resumen de ajuste:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> pd.DataFrame({</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'variable'</span>:transformed_df.columns.to_list(),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'coefs'</span>: pipeline_linreg.named_steps[<span class="st">'regressor'</span>].coef_.<span class="bu">round</span>(<span class="dv">5</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(ames_y_train, sm.add_constant(transformed_df) ).fit()</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>conf_int  <span class="op">=</span> model.conf_int().reset_index().rename(columns <span class="op">=</span>{<span class="st">'index'</span>: <span class="st">'variable'</span>, <span class="dv">0</span>:<span class="st">"min"</span>, <span class="dv">1</span>: <span class="st">'max'</span>})</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>p_vals <span class="op">=</span> (</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        model.pvalues.reset_index()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> select( _.variable <span class="op">==</span> _.index, _.p_val <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> mutate (s <span class="op">=</span> case_when({</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>              _.p_val<span class="op">&lt;</span><span class="fl">0.025</span>:<span class="st">'***'</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>              _.p_val<span class="op">&lt;</span><span class="fl">0.05</span>:<span class="st">'**'</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>              _.p_val<span class="op">&lt;</span><span class="fl">0.1</span>:<span class="st">'*'</span>,</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>              <span class="va">True</span>:<span class="st">''</span>}))</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> arrange (_.s,<span class="op">-</span> _.p_val)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span>left_join(_, coefs, on <span class="op">=</span> <span class="st">'variable'</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> left_join(_,conf_int, on <span class="op">=</span> <span class="st">'variable'</span> )</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>model.summary2()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'statsmodels.iolib.summary2.Summary'&gt;
"""
                                   Results: Ordinary least squares
======================================================================================================
Model:                          OLS                          Adj. R-squared:                 0.795    
Dependent Variable:             y                            AIC:                            8071.8980
Date:                           2023-11-19 22:09             BIC:                            8389.1898
No. Observations:               974                          Log-Likelihood:                 -3970.9  
Df Model:                       64                           F-statistic:                    59.99    
Df Residuals:                   909                          Prob (F-statistic):             5.83e-281
R-squared:                      0.809                        Scale:                          218.13   
------------------------------------------------------------------------------------------------------
                                                    Coef.   Std.Err.    t    P&gt;|t|    [0.025   0.975] 
------------------------------------------------------------------------------------------------------
const                                               -0.0004   0.0001 -5.2190 0.0000   -0.0005  -0.0002
Garage_Qual_TA_x_Garage_Prop_overGLA_c_             15.3682   9.3928  1.6362 0.1022   -3.0660  33.8023
Garage_Prop_overGLA_c_                               8.3832  10.0526  0.8339 0.4045  -11.3458  28.1123
Kitchen_AbvGr                                       -1.7295   0.6157 -2.8092 0.0051   -2.9378  -0.5212
Gr_Liv_A/Loot_A_c__x_Gr_Liv_A/Loot_A_c_             60.1843  19.9988  3.0094 0.0027   20.9352  99.4334
Gr_Liv_A/Loot_A_c_                                 -85.3366  15.5487 -5.4883 0.0000 -115.8521 -54.8210
Overall_Qual_Good_or_Excellent_x_1s_Floor_prop_c_   14.6595   6.4525  2.2719 0.0233    1.9960  27.3230
Overall_Qual_Good_or_Excellent                      -4.5760   5.1005 -0.8972 0.3699  -14.5862   5.4341
Overall_Qual_Poor                                  -23.4530   4.5855 -5.1146 0.0000  -32.4525 -14.4535
1s_Floor_prop_c_                                    86.3994  23.2781  3.7116 0.0002   40.7142 132.0845
Bsmt_Qual_Fa_x_Bsmt_Prop_c_                        -20.0871  11.4297 -1.7574 0.0792  -42.5188   2.3446
Bsmt_Qual_Fa                                         1.0750   7.6228  0.1410 0.8879  -13.8852  16.0353
Bsmt_Qual_Gd                                        -7.0903   2.3069 -3.0735 0.0022  -11.6177  -2.5628
Bsmt_Qual_TA                                        -9.3797   2.8018 -3.3477 0.0008  -14.8785  -3.8810
Bsmt_Prop_c_                                        23.8762   3.4324  6.9561 0.0000   17.1398  30.6125
Antique_c__x_2nd_Flr_SF_propGLA_c_                   0.7718   0.3880  1.9894 0.0470    0.0104   1.5332
Antique2_c__x_2nd_Flr_SF_propGLA_c_                 -0.0036   0.0030 -1.1965 0.2318   -0.0095   0.0023
Antique_c_                                          -0.5577   0.1476 -3.7777 0.0002   -0.8475  -0.2680
Antique2_c_                                          0.0007   0.0012  0.5792 0.5626   -0.0016   0.0029
2nd_Flr_SF_propGLA_c_                                6.7715  23.3364  0.2902 0.7718  -39.0280  52.5710
Mas_Vnr_Type_Stone_x_MVNRA_propLA_c_              -127.9926 117.2512 -1.0916 0.2753 -358.1071 102.1219
Mas_Vnr_Type_None                                    4.2684   1.4493  2.9452 0.0033    1.4241   7.1126
Mas_Vnr_Type_Stone                                   9.7544   3.7840  2.5778 0.0101    2.3280  17.1808
Mas_Vnr_Type_infrequent_sklearn                    -15.7461   5.5287 -2.8481 0.0045  -26.5965  -4.8957
MVNRA_propLA_c_                                     52.9066  22.5835  2.3427 0.0194    8.5846  97.2285
Fireplaces_x_Wood_propGLA_c_                       -20.5781   8.6459 -2.3801 0.0175  -37.5464  -3.6098
Fireplaces                                           9.1513   1.8402  4.9731 0.0000    5.5398  12.7628
Wood_propGLA_c_                                     28.4377   8.1616  3.4843 0.0005   12.4199  44.4556
Neighborhood_ClearCr_x_Gr_Liv_Area                  -5.5561   4.6414 -1.1971 0.2316  -14.6652   3.5529
Neighborhood_Crawfor_x_Gr_Liv_Area                   5.6707   2.7110  2.0917 0.0367    0.3500  10.9913
Neighborhood_NAmes_x_Gr_Liv_Area                    -6.1660   1.8356 -3.3592 0.0008   -9.7685  -2.5636
Neighborhood_NoRidge_x_Gr_Liv_Area                   6.2554   1.7106  3.6569 0.0003    2.8982   9.6126
Neighborhood_NridgHt_x_Gr_Liv_Area                   9.5125   2.2938  4.1471 0.0000    5.0108  14.0142
Neighborhood_Sawyer_x_Gr_Liv_Area                   -9.9873   4.0067 -2.4926 0.0129  -17.8508  -2.1238
Neighborhood_CollgCr                                -6.0170   1.9879 -3.0268 0.0025   -9.9184  -2.1156
Neighborhood_NAmes                                  -1.5970   1.9428 -0.8220 0.4113   -5.4098   2.2158
Neighborhood_NWAmes                                 -2.1589   2.6983 -0.8001 0.4238   -7.4545   3.1366
Neighborhood_SWISU                                  -6.9783   4.1719 -1.6727 0.0947  -15.1660   1.2094
Neighborhood_Sawyer                                 -5.7615   3.9005 -1.4771 0.1400  -13.4165   1.8936
Neighborhood_SawyerW                                -5.5466   2.7014 -2.0532 0.0403  -10.8483  -0.2448
Neighborhood_StoneBr                                18.9136   3.8134  4.9598 0.0000   11.4296  26.3977
Gr_Liv_Area                                          5.1832   3.6192  1.4321 0.1524   -1.9198  12.2862
1st_Flr_SF                                         -13.9207   2.5413 -5.4777 0.0000  -18.9082  -8.9331
Misc_Val                                            -3.7163   0.8574 -4.3344 0.0000   -5.3990  -2.0336
Area_Per_Room_c_                                     0.0045   0.0449  0.1008 0.9197   -0.0836   0.0927
Fireplace_Qu_Gd                                      5.5637   2.4481  2.2726 0.0233    0.7590  10.3684
Fireplace_Qu_No_Fireplace                            6.4889   2.9492  2.2002 0.0280    0.7008  12.2770
Fireplace_Qu_TA                                      6.0519   2.4284  2.4921 0.0129    1.2859  10.8179
Bsmt_Exposure_Gd                                    11.4439   1.7839  6.4151 0.0000    7.9429  14.9450
Misc_Feature_infrequent_sklearn                     36.5678  13.9369  2.6238 0.0088    9.2155  63.9201
Neighborhood_Gilbert                                -7.7217   2.6298 -2.9363 0.0034  -12.8829  -2.5606
Neighborhood_MeadowV                                -4.5276   4.8130 -0.9407 0.3471  -13.9733   4.9182
Neighborhood_Mitchel                                -5.1543   2.8564 -1.8045 0.0715  -10.7602   0.4515
Neighborhood_OldTown                                -3.4905   2.4341 -1.4340 0.1519   -8.2676   1.2865
Condition_1_Norm                                     6.5047   1.6453  3.9536 0.0001    3.2757   9.7336
Exter_Qual_Fa                                      -40.3059   6.4403 -6.2584 0.0000  -52.9456 -27.6663
Exter_Qual_Gd                                      -25.1620   3.6696 -6.8568 0.0000  -32.3639 -17.9600
Exter_Qual_TA                                      -31.1377   4.0812 -7.6296 0.0000  -39.1473 -23.1281
Exter_Cond_infrequent_sklearn                      -16.9594   7.1117 -2.3847 0.0173  -30.9166  -3.0021
Heating_QC_Fa                                       -4.8909   3.1941 -1.5312 0.1261  -11.1596   1.3778
Heating_QC_TA                                       -4.1332   1.2696 -3.2556 0.0012   -6.6248  -1.6415
Functional_Typ                                       5.3548   2.4932  2.1478 0.0320    0.4617  10.2478
Functional_infrequent_sklearn                      -13.1940   4.9092 -2.6876 0.0073  -22.8286  -3.5594
TotRms_AbvGrd                                       -0.9917   1.7859 -0.5553 0.5788   -4.4967   2.5134
Year_Built                                          -0.2417   0.0409 -5.9120 0.0000   -0.3219  -0.1614
Year_Remod/Add                                       0.2770   0.0368  7.5282 0.0000    0.2048   0.3492
------------------------------------------------------------------------------------------------------
Omnibus:                      111.891              Durbin-Watson:                 1.940               
Prob(Omnibus):                0.000                Jarque-Bera (JB):              496.666             
Skew:                         0.440                Prob(JB):                      0.000               
Kurtosis:                     6.386                Condition No.:                 22804196765051686912
======================================================================================================
Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The smallest eigenvalue is 6.34e-29. This might indicate that                there are strong
multicollinearity problems or that the design                matrix is singular.
"""</code></pre>
</div>
</div>
<p>También podemos ver que tanto impacto tienen las variables en el modelo en las siguientes gráficas, donde se representa el coficiente de regresión para cada variable, junto con su intervalo de confianza y el color representando su <code>p_value</code>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    p_vals</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.coefs.between(<span class="dv">0</span>,<span class="dv">10000000</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot(aes (x<span class="op">=</span> <span class="st">'reorder(variable, coefs)'</span>, y<span class="op">=</span> <span class="st">'coefs'</span>, color <span class="op">=</span> <span class="st">'p_val'</span>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>  geom_point()</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min'</span>, ymax<span class="op">=</span><span class="st">'max'</span>),width<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_color_gradient(low<span class="op">=</span><span class="st">'#B05F43'</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># mid='#B05F43',</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                       high<span class="op">=</span> <span class="st">'#3A3AD5'</span>,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                       limits<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>                       name<span class="op">=</span><span class="st">'p_value'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>  labs(y<span class="op">=</span> <span class="st">'Coeficiente'</span>, x <span class="op">=</span> <span class="st">''</span>, title <span class="op">=</span> <span class="st">'Analisís de variables con </span><span class="ch">\n</span><span class="st">coeficiente positivo'</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  coord_flip()</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/p_values%20analysis-25.png" class="img-fluid" width="614"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    p_vals</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_.coefs.between(<span class="op">-</span><span class="dv">1000</span>,<span class="dv">0</span>))</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot(aes (x<span class="op">=</span> <span class="st">'reorder(variable, coefs)'</span>, y<span class="op">=</span> <span class="st">'coefs'</span>, color <span class="op">=</span> <span class="st">'p_val'</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>  geom_point()</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min'</span>, ymax<span class="op">=</span><span class="st">'max'</span>),width<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_color_gradient(low<span class="op">=</span><span class="st">'#B05F43'</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># mid='#B05F43',</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                       high<span class="op">=</span> <span class="st">'#3A3AD5'</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                       limits<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                       name<span class="op">=</span><span class="st">'p_value'</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>  labs(y<span class="op">=</span> <span class="st">'Coeficiente'</span>, x <span class="op">=</span> <span class="st">''</span>, title <span class="op">=</span> <span class="st">'Analisís de variables con </span><span class="ch">\n</span><span class="st">coeficiente negativo'</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  coord_flip()</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/p_values%20analysis-26.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Puntos a considerar de las gráficas anteriores:</p>
<ul>
<li><p>Los coeficientes más grandes suelen pertencer a variables que representan alguna proporción, por lo que no es raro el tamaño de sus coeficientes pues siempre seran multiplicados por un número entre 0 y 1.</p></li>
<li><p>La mayoría de las variables tiene <code>p_value</code> cercano a 0, sin embargo algunos otros tienen valores más altos (los más azules), estos se incluyeron en el modelo ya sea porque ayudan en su performance o porque existen interaciones de estas variables.</p></li>
</ul>
<section id="resutados-de-test-y-validación" class="level3">
<h3 class="anchored" data-anchor-id="resutados-de-test-y-validación">Resutados de test y validación</h3>
<p>Finalmente en los resultados se lograron las siguiente métricas</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline_linreg.predict(ames_x_test) <span class="op">*</span> ames_x_test.Gr_Liv_Area</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> Sale_Price_test</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.DataFrame() <span class="op">&gt;&gt;</span> mutate (Sale_Price <span class="op">=</span> y_obs, Sale_Price_Pred <span class="op">=</span> y_pred)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>predictores <span class="op">=</span> transformed_df.shape[<span class="dv">1</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>metrics_testing <span class="op">=</span> get_metrics(y_pred, y_obs, predictores )</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline_linreg.predict(ames_x_val)<span class="op">*</span>ames_x_val.Gr_Liv_Area</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>metrics_val <span class="op">=</span> get_metrics(y_pred,Sale_Price_validation,<span class="bu">len</span>(transformed_df.columns))</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>metrics_testing[<span class="st">'Resultados validación'</span>] <span class="op">=</span> metrics_val.values</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>metrics_testing[<span class="st">'Resultados test'</span>] <span class="op">=</span> metrics_testing.Value</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>resultados <span class="op">=</span> metrics_testing <span class="op">&gt;&gt;</span> select(_.contains(<span class="st">'test'</span>),_.contains(<span class="st">'val'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
’

<table class="dataframe table table-sm table-striped small">

<thead>

<tr>

<th>
</th>

<th>
Resultados test
</th>

<th>
Resultados validación
</th>

</tr>

<tr>

<th>
Metric
</th>

<th>
</th>

<th>
</th>

</tr>

</thead>

<tbody>

<tr>

<th>
ME
</th>

<td>
-1072.1797
</td>

<td>
-2725.3853
</td>

</tr>

<tr>

<th>
MAE
</th>

<td>
15396.0550
</td>

<td>
15946.0333
</td>

</tr>

<tr>

<th>
MAPE
</th>

<td>
0.0984
</td>

<td>
0.0974
</td>

</tr>

<tr>

<th>
MSE
</th>

<td>
476920416.3345
</td>

<td>
479089429.6795
</td>

</tr>

<tr>

<th>
RMSE
</th>

<td>
21838.5076
</td>

<td>
21888.1116
</td>

</tr>

<tr>

<th>
R2
</th>

<td>
0.9402
</td>

<td>
0.9248
</td>

</tr>

<tr>

<th>
R2Adj
</th>

<td>
0.9130
</td>

<td>
0.8907
</td>

</tr>

</tbody>


</table>
<p>’</p>
<p>En cuanto al análisis de los residuos se tienen resultados bastante aceptables, donde los residuos parecen seguir una distribución normal con media 0, y no se ven indicios de heterocedasticidad.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline_linreg.predict(ames_x_test) <span class="op">*</span> ames_x_test.Gr_Liv_Area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> y_pred, y <span class="op">=</span>y_obs)) <span class="op">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    geom_point(alpha <span class="op">=</span> <span class="fl">0.6</span>) <span class="op">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) ) <span class="op">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) ) <span class="op">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)<span class="op">+</span>theme_tufte()</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20de%20errores%20lm-29.png" class="img-fluid" width="614"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">&gt;&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)<span class="op">+</span>theme_tufte()</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20de%20errores%20lm-30.png" class="img-fluid" width="614"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">&gt;&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>) <span class="op">+</span>theme_tufte()</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20de%20errores%20lm-31.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
</section>
</section>
<section id="preprocesado-generlaizado" class="level1">
<h1>Preprocesado Generlaizado</h1>
<p>Para los siguientes modelos se utilizaron los mismos transformadores que para la regresión líneal, con algunos ligeros cambios, con estos transformadores se creó un pipeline llamado <code>get_df</code>, el cual hace todo el proceso para regresar el DataFrame útil a la hora de ajustar los modelos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-overflow-scroll code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>n_usefull <span class="op">=</span> [<span class="st">'Sale_Type'</span>, <span class="st">'Sale_Condition'</span>, <span class="st">'Pool_QC'</span>, <span class="st">'Pool_Area'</span>, <span class="st">'Yr_Sold'</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>clean_and_imputers <span class="op">=</span> ColumnTransformer(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    [(<span class="st">'not_usefull_variables'</span>, <span class="st">'drop'</span>, n_usefull),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Alley'</span>, SimpleImputer(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Alley_Access'</span>), [<span class="st">'Alley'</span>]),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Mas_Vnr_Type'</span>, SimpleImputer(</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'None'</span>), [<span class="st">'Mas_Vnr_Type'</span>]),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Mas_Vnr_Area'</span>, SimpleImputer(</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), [<span class="st">'Mas_Vnr_Area'</span>]),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Lot_Frontage'</span>, SimpleImputer(</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'mean'</span>), [<span class="st">'Lot_Frontage'</span>]),</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Fireplace_Qu'</span>, SimpleImputer(</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Fireplace'</span>), [<span class="st">'Fireplace_Qu'</span>]),</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Electrical'</span>, SimpleImputer(</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'most_frequent'</span>),[<span class="st">'Electrical'</span>]),</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Bsmt_Cat'</span>, SimpleImputer(</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Basement'</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Bsmt'</span>,dtype_include <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Bsmt_Numeric'</span>, SimpleImputer(</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Bsmt'</span>,dtype_exclude <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Garage'</span>, SimpleImputer(</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Garage'</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Garage'</span>,dtype_include <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Garage_numeric'</span>, SimpleImputer(</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Garage'</span>,dtype_exclude <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Fence'</span>, SimpleImputer(</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Fence'</span>), [<span class="st">'Fence'</span>]),</span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Misc_Feature'</span>, SimpleImputer(</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'None'</span>), [<span class="st">'Misc_Feature'</span>])</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span> <span class="st">'passthrough'</span>,</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>clean_ames_x_train<span class="op">=</span> clean_and_imputers.fit_transform(ames_x_train)</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>cond <span class="op">=</span>{<span class="dv">1</span>: <span class="st">'Poor'</span>, <span class="dv">2</span>:<span class="st">'Poor'</span>,<span class="dv">3</span>:<span class="st">'Poor'</span>,<span class="dv">4</span>:<span class="st">'Average'</span>, <span class="dv">5</span>:<span class="st">'Average'</span>,<span class="dv">6</span>:<span class="st">'Average'</span>, <span class="dv">7</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">8</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">9</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">10</span> :<span class="st">'Good_or_Excellent'</span>}</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>feature_eng <span class="op">=</span> ColumnTransformer(</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'collapse_cond'</span>,  FunctionTransformer(</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>                                 collapse,</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Overall_Cond'</span>, <span class="st">'dic'</span> : cond }</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Overall_Cond'</span>]),</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'collapse_cond2'</span>,  FunctionTransformer(</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>                                 collapse,</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Overall_Qual'</span>, <span class="st">'dic'</span> : cond }</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Overall_Qual'</span>]),</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Area_Per_Room'</span>,  FunctionTransformer(</span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Area_Per_Room'</span>}</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'TotRms_AbvGrd'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb36-76"><a href="#cb36-76" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Wood_propGLA'</span>,  FunctionTransformer(</span>
<span id="cb36-77"><a href="#cb36-77" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-78"><a href="#cb36-78" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-79"><a href="#cb36-79" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Wood_Deck_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Wood_propGLA'</span>}</span>
<span id="cb36-80"><a href="#cb36-80" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Wood_Deck_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb36-81"><a href="#cb36-81" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'MVNRA_prop'</span>,  FunctionTransformer(</span>
<span id="cb36-82"><a href="#cb36-82" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-83"><a href="#cb36-83" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-84"><a href="#cb36-84" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Mas_Vnr_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Lot_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'MVNRA_propLA'</span>}</span>
<span id="cb36-85"><a href="#cb36-85" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Mas_Vnr_Area'</span>, <span class="st">'Lot_Area'</span>]),</span>
<span id="cb36-86"><a href="#cb36-86" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2nd_Flr_SF_propGLA'</span>,  FunctionTransformer(</span>
<span id="cb36-87"><a href="#cb36-87" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-88"><a href="#cb36-88" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-89"><a href="#cb36-89" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'2nd_Flr_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'2nd_Flr_SF_propGLA'</span>}</span>
<span id="cb36-90"><a href="#cb36-90" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'2nd_Flr_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb36-91"><a href="#cb36-91" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Bsmt_Prop'</span>,  FunctionTransformer(</span>
<span id="cb36-92"><a href="#cb36-92" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-93"><a href="#cb36-93" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-94"><a href="#cb36-94" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Total_Bsmt_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Bsmt_Prop'</span>}</span>
<span id="cb36-95"><a href="#cb36-95" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Total_Bsmt_SF'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb36-96"><a href="#cb36-96" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Time_var'</span>,  FunctionTransformer(</span>
<span id="cb36-97"><a href="#cb36-97" aria-hidden="true" tabindex="-1"></a>                                 antique_func,</span>
<span id="cb36-98"><a href="#cb36-98" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-99"><a href="#cb36-99" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'yb'</span>: <span class="st">'Year_Built'</span>, <span class="st">'yr'</span>: <span class="st">'Year_Remod/Add'</span>}</span>
<span id="cb36-100"><a href="#cb36-100" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Year_Built'</span>, <span class="st">'Year_Remod/Add'</span>]),</span>
<span id="cb36-101"><a href="#cb36-101" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Gr_Liv_Area / Loot_Area'</span>,  FunctionTransformer(</span>
<span id="cb36-102"><a href="#cb36-102" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-103"><a href="#cb36-103" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-104"><a href="#cb36-104" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Lot_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Gr_Liv_A/Loot_A'</span>}</span>
<span id="cb36-105"><a href="#cb36-105" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Gr_Liv_Area'</span>, <span class="st">'Lot_Area'</span>] ),</span>
<span id="cb36-106"><a href="#cb36-106" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Garage_Prop_overGLA'</span>,  FunctionTransformer(</span>
<span id="cb36-107"><a href="#cb36-107" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-108"><a href="#cb36-108" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-109"><a href="#cb36-109" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Garage_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Garage_Prop_overGLA'</span>}</span>
<span id="cb36-110"><a href="#cb36-110" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Garage_Area'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb36-111"><a href="#cb36-111" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'1s_Floor_prop'</span>,  FunctionTransformer(</span>
<span id="cb36-112"><a href="#cb36-112" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb36-113"><a href="#cb36-113" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb36-114"><a href="#cb36-114" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'1st_Flr_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'1s_Floor_prop'</span>}</span>
<span id="cb36-115"><a href="#cb36-115" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'1st_Flr_SF'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb36-116"><a href="#cb36-116" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'just_select'</span>, <span class="st">'passthrough'</span>, [<span class="st">'Total_Bsmt_SF'</span>,<span class="st">'2nd_Flr_SF'</span>, <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'1st_Flr_SF'</span>, <span class="st">'Year_Built'</span>, <span class="st">'Year_Remod/Add'</span>, <span class="st">'Garage_Area'</span>, <span class="st">'Lot_Area'</span>, <span class="st">'Gr_Liv_Area'</span>, <span class="st">'Mas_Vnr_Area'</span>,<span class="st">'Wood_Deck_SF'</span> ])],</span>
<span id="cb36-117"><a href="#cb36-117" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb36-118"><a href="#cb36-118" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-overflow-scroll code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>feature_eng_df <span class="op">=</span> feature_eng.fit_transform(clean_ames_x_train)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>my_features <span class="op">=</span> (feature_eng_df<span class="op">&gt;&gt;</span> select (_.contains(<span class="st">'_c_'</span>))).columns.to_list()</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>preprocessor_1 <span class="op">=</span> ColumnTransformer(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler(), make_column_selector(dtype_exclude  <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ('just_select', 'passthrough', my_features ),</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'OHE'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown<span class="op">=</span><span class="st">'infrequent_if_exist'</span> , sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency <span class="op">=</span> <span class="dv">12</span>), make_column_selector(dtype_include  <span class="op">=</span> <span class="st">'object'</span>))],</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'drop'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>interactions <span class="op">=</span> ColumnTransformer(</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'Garage_interaction'</span>, FunctionTransformer(</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Garage_Prop_overGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Garage_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Garage_Qual|Garage_Prop_overGLA_c_'</span>)),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'inter_kitchen'</span>, FunctionTransformer(</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Kitchen_AbvGr'</span>, <span class="st">'cat'</span>: <span class="st">'Kitchen_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Kitchen_Qual|Kitchen_AbvGr'</span>)),</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Last_remod_c_'</span>, FunctionTransformer(</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Gr_Liv_A/Loot_A_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Gr_Liv_A/Loot_A_c_'</span>, <span class="st">'return_inputs'</span>:<span class="st">'num'</span>}</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Gr_Liv_A/Loot_A_c_'</span>)),</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'1s_Floor_prop_c_|Overall_Q'</span>, FunctionTransformer(</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'1s_Floor_prop_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Overall_Q'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'1s_Floor_prop_c_|Overall_Q'</span>)),</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Bsmt_Qual|Bsmt_Prop_c_'</span>, FunctionTransformer(</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Bsmt_Prop_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Bsmt_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Bsmt_Qual|Bsmt_Prop_c_'</span>)),</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Area_Per_Room_c_|Overall'</span>, FunctionTransformer(</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'2nd_Flr_SF_propGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Antique'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'2nd_Flr_SF_propGLA_c_|Antique'</span>)),</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'MVNRA_propGLA_c_|Mas_Vnr_Type'</span>, FunctionTransformer(</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'MVNRA_propLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Mas_Vnr_Type'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'MVNRA_propLA_c_|Mas_Vnr_Type'</span>)),</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Wood_propGLA_c_|Fireplaces'</span>, FunctionTransformer(</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Wood_propGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Fireplaces'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Wood_propGLA_c_|Fireplaces'</span>)),</span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Gr_Liv_Area_x_Neighborhood'</span>, FunctionTransformer(</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'cat'</span>: <span class="st">'Neighborhood'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Gr_Liv_Area|Neighborhood'</span>)),</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'TO_DROP_'</span>, <span class="st">'drop'</span>, make_column_selector(<span class="st">'No_Basement|No_Garage|Exterior|Land|Fence'</span>)) ],</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-overflow-scroll code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>get_df <span class="op">=</span> Pipeline([ </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'clean_data'</span>, clean_and_imputers),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'feat_eng'</span>, feature_eng),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocessor'</span>, preprocessor_1),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'interactions'</span>, interactions)])</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>get_df.fit(ames_x_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="knn-model" class="level1">
<h1>KNN model</h1>
<p>Se opta por empezar con unmodelo de KNN con todas las variables, esté modelo tiene las siguientes características:</p>
<ul>
<li><p>El modelo incluye las variables creadas para regresión lineal.</p></li>
<li><p>Se estandarizaron todas las variables númericas.</p></li>
<li><p>El One Hot Encoding mantiene una minima frecuencia de 12 elementos por categoría.</p></li>
</ul>
<p>Posterior al ajuste de este modelo se busco optimizarlo removiendo variables y probando diferentes comibianciones de estás teniendo como critero la importancia calculada.</p>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-validation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, KFold, cross_val_score, cross_validate</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span>get_df.transform(ames_x_train)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>transformed_test <span class="op">=</span> get_df.transform(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación se hace la validación cruzada para encontrar el mejor hiper-parámetro para el full model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>kf <span class="op">=</span> KFold(n_splits<span class="op">=</span>k, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_neighbors'</span>: <span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">60</span> ,<span class="dv">2</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'weights'</span>: [<span class="st">'uniform'</span>, <span class="st">'distance'</span>],</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'metric'</span>: [<span class="st">'euclidean'</span>, <span class="st">'manhattan'</span>,<span class="st">'haversine'</span>, <span class="st">'cosine'</span>, <span class="st">'correlation'</span>, <span class="st">'mahalanobis'</span>,<span class="st">'minkowski'</span>],</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'p'</span> : [<span class="dv">5</span>,<span class="dv">15</span>,<span class="dv">20</span>]</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>scoring <span class="op">=</span> {</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_squared_error'</span>: make_scorer(mean_squared_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'r2'</span>: make_scorer(adjusted_r2_score, greater_is_better<span class="op">=</span><span class="va">True</span>, n<span class="op">=</span>np.ceil(<span class="bu">len</span>(ames_x_train)), p<span class="op">=</span>transformed_df.shape[<span class="dv">1</span>]),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'neg_mean_absolute_error'</span>: make_scorer(mean_absolute_error, greater_is_better<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mape'</span>: make_scorer(mean_absolute_percentage_error, greater_is_better<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>pipeline_knn_cv <span class="op">=</span> Pipeline([</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'clean_data'</span>, clean_and_imputers),</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'feat_eng'</span>, feature_eng),</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocessor'</span>, preprocessor_1),</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'interactions'</span>, interactions),</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, GridSearchCV(</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>      KNeighborsRegressor(),</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>      param_grid,</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>      cv<span class="op">=</span>kf,</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>      scoring<span class="op">=</span>scoring,</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>      refit<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>      verbose<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>      n_jobs<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>     )]</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">500</span>)</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>pipeline_knn_cv.fit(ames_x_train, ames_y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Tenemos mejores resultados con <span class="math inline">\(K=3\)</span> y distancia de <code>manhattan</code>, con ponderación <code>distance</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>results_cv_trans <span class="op">=</span> pd.read_pickle(<span class="st">'..\model/knn/cv_trans_sp.pkl'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>results_df_trans <span class="op">=</span> pd.DataFrame(results_cv_trans.cv_results_)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>summary_cv_t <span class="op">=</span> (results_df_trans <span class="op">&gt;&gt;</span>select(<span class="op">-</span>_.contains(<span class="st">"split"</span>), <span class="op">-</span>_.contains(<span class="st">"time"</span>), <span class="op">-</span>_.params))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>check_cv(summary_cv_t, param_p<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para poder mejorar el modelo se hizo un bucle en el cual en cada iteración se eliminaban las 5 variables con menor importancia, posterior a su remoción se recalcula la importancia de las variables y se repite el proceso, dentro de los bucles se ajusta el modelo <span class="math inline">\(p-i\cdot 5\)</span> veces eliminando las variables por orden de importanca hasta quedarse con una variable y calculando sus métricas, variables usadas y número de variables, se guardan todos los modelos que obtienen una <span class="math inline">\(R^2_{adj} &gt; 0.7\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>predictores <span class="op">=</span> transformed_test.columns.shape[<span class="dv">0</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>best_mods <span class="op">=</span> []</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>score_mse <span class="op">=</span>[]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>score_r <span class="op">=</span> []</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span> (<span class="dv">0</span>,<span class="dv">185</span>,<span class="dv">5</span>):</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  t<span class="op">=</span> <span class="dv">207</span><span class="op">-</span>k</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> k <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    sc <span class="op">=</span> transformed_df.columns.to_list()</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>: </span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    sc <span class="op">=</span> (results <span class="op">&gt;&gt;</span> <span class="bu">filter</span> (_.P<span class="op">==</span>t) <span class="op">&gt;&gt;</span> pull (<span class="st">'used_vars'</span>))[<span class="dv">0</span>]</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  knn_reg.fit(transformed_df[sc], Sale_Price_train)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  metrics <span class="op">=</span> get_metrics(knn_reg.predict(transformed_test[sc]), Sale_Price_test, <span class="bu">len</span>(sc))</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">=</span> importance_from_model(</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    test_frame <span class="op">=</span> transformed_test,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    y_obs <span class="op">=</span> Sale_Price_test ,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    selected_columns <span class="op">=</span>  sc, </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> knn_reg,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    actual_mse <span class="op">=</span> metrics.loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>] ,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    n_permutations<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    trans_pred<span class="op">=</span> <span class="va">False</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  vars_importance_order <span class="op">=</span> <span class="bu">list</span>( importance_df <span class="op">&gt;&gt;</span> arrange(_.Mean_Loss) <span class="op">&gt;&gt;</span> pull(<span class="st">'Variable'</span>))</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  transformed_df <span class="op">=</span>get_df.transform(ames_x_train)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  v<span class="op">=</span>[]</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  r2<span class="op">=</span>[]</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  mse_<span class="op">=</span>[]</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  p<span class="op">=</span>[]</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(t):</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    vars_to_train <span class="op">=</span> vars_importance_order[i:]</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    p.append(<span class="bu">len</span>(vars_to_train))</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    knn_reg.fit(transformed_df[vars_to_train], Sale_Price_train)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>    pred<span class="op">=</span> knn_reg.predict(transformed_test[vars_to_train])</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    mse_.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'MSE'</span>].values[<span class="dv">0</span>])</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>    r2.append(get_metrics(pred,Sale_Price_test, <span class="bu">len</span>(vars_to_train)).loc[<span class="st">'R2Adj'</span>].values[<span class="dv">0</span>])</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    v.append(vars_to_train)</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  results <span class="op">=</span> pd.DataFrame() <span class="op">&gt;&gt;</span> mutate(MSE <span class="op">=</span> mse_, P<span class="op">=</span>p,R2<span class="op">=</span>r2,used_vars <span class="op">=</span> v)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  best_mods.append( (results <span class="op">&gt;&gt;</span> <span class="bu">filter</span> (_.R2<span class="op">&gt;</span><span class="fl">0.7</span>) <span class="op">&gt;&gt;</span> pull (<span class="st">'used_vars'</span>)) )</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  score_r.append( (results <span class="op">&gt;&gt;</span> <span class="bu">filter</span> (_.R2<span class="op">&gt;</span><span class="fl">0.7</span>) <span class="op">&gt;&gt;</span> pull (<span class="st">'R2'</span>)) )</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  score_mse.append( (results <span class="op">&gt;&gt;</span> <span class="bu">filter</span> (_.R2<span class="op">&gt;</span><span class="fl">0.7</span>) <span class="op">&gt;&gt;</span> pull (<span class="st">'MSE'</span>)) )</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>scoresr <span class="op">=</span>  [item <span class="cf">for</span> sub_list <span class="kw">in</span> score_r <span class="cf">for</span> item <span class="kw">in</span> sub_list]</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>scoresmse<span class="op">=</span>  [item <span class="cf">for</span> sub_list <span class="kw">in</span> score_mse <span class="cf">for</span> item <span class="kw">in</span> sub_list]</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>best_mods_ <span class="op">=</span> [item <span class="cf">for</span> sub_list <span class="kw">in</span> best_mods <span class="cf">for</span> item <span class="kw">in</span> sub_list] </span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>num_pred <span class="op">=</span> [<span class="bu">len</span>(l) <span class="cf">for</span> l <span class="kw">in</span> best_mods_]</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>results_knn_model_iterations <span class="op">=</span> pd.DataFrame() <span class="op">&gt;&gt;</span> mutate (used_vars <span class="op">=</span> best_mods_, r2 <span class="op">=</span> scoresr ,mse <span class="op">=</span> scoresmse, p<span class="op">=</span> num_pred) </span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a><span class="co"># results_knn_model_iterations.to_csv('data/knn_mod_it.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación se muestran los resultados de los modelos salvados durante el bucle, podemos ver que los mejores modelos tienen entre 30 y 60 predictores, estos tienen tanto un <span class="math inline">\(MSE\)</span> bajo como una mayor <span class="math inline">\(R^2_{adj}\)</span>.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>results_knn_model_iterations <span class="op">=</span> pd.read_csv (<span class="st">'../model/knn/interations_results_knn.csv'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  results_knn_model_iterations</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot (aes(x<span class="op">=</span><span class="st">'p'</span>, y<span class="op">=</span> <span class="st">'r2'</span> ,color<span class="op">=</span> <span class="st">'mse'</span>))</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  geom_point(alpha <span class="op">=</span> <span class="fl">0.6</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  labs (x<span class="op">=</span> <span class="st">'Número de predictores'</span>, y<span class="op">=</span> <span class="st">'R^2'</span>, color <span class="op">=</span> <span class="st">'MSE'</span>, title <span class="op">=</span> <span class="st">'Resultados de iteraciónes con dif.</span><span class="ch">\n</span><span class="st">combinaciones de predictores'</span>)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/iter_graficas_knn-36.png" class="img-fluid" width="614"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  results_knn_model_iterations <span class="op">&gt;&gt;</span> <span class="bu">filter</span> (_.r2<span class="op">&gt;</span><span class="fl">0.85</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot (aes(x<span class="op">=</span><span class="st">'p'</span>, y<span class="op">=</span> <span class="st">'r2'</span> ,color<span class="op">=</span> <span class="st">'mse'</span>))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  geom_point(alpha <span class="op">=</span> <span class="fl">0.6</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span>  labs (x<span class="op">=</span> <span class="st">'Número de predictores'</span>, y<span class="op">=</span> <span class="st">'R^2'</span>, color <span class="op">=</span> <span class="st">'MSE'</span>, title <span class="op">=</span> <span class="st">'Resultados de iteraciónes con dif. </span><span class="ch">\n</span><span class="st">combinaciones de predictores'</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/iter_graficas_knn-37.png" class="img-fluid" width="614"></p>
</div>
</div>
’

<table class="dataframe table table-sm table-striped small">

<thead>

<tr>

<th>
</th>

<th>
<span class="math inline">\(R^2_{adj}\)</span>
</th>

<th>
<span class="math inline">\(MSE\)</span>
</th>

<th>
Predictores
</th>

</tr>

</thead>

<tbody>

<tr>

<th>
2831
</th>

<td>
0.8965
</td>

<td>
682411933.8567
</td>

<td>
36
</td>

</tr>

<tr>

<th>
3487
</th>

<td>
0.8961
</td>

<td>
668945835.0104
</td>

<td>
40
</td>

</tr>

<tr>

<th>
3486
</th>

<td>
0.8965
</td>

<td>
662314544.0176
</td>

<td>
41
</td>

</tr>

<tr>

<th>
3485
</th>

<td>
0.8966
</td>

<td>
658119227.9423
</td>

<td>
42
</td>

</tr>

<tr>

<th>
3523
</th>

<td>
0.8966
</td>

<td>
658119227.9423
</td>

<td>
42
</td>

</tr>

<tr>

<th>
3149
</th>

<td>
0.8961
</td>

<td>
649306174.0197
</td>

<td>
45
</td>

</tr>

<tr>

<th>
3340
</th>

<td>
0.8968
</td>

<td>
644531528.2877
</td>

<td>
45
</td>

</tr>

<tr>

<th>
3482
</th>

<td>
0.8970
</td>

<td>
643484185.5189
</td>

<td>
45
</td>

</tr>

<tr>

<th>
3339
</th>

<td>
0.8978
</td>

<td>
634763278.1049
</td>

<td>
46
</td>

</tr>

<tr>

<th>
3481
</th>

<td>
0.8963
</td>

<td>
643640288.2890
</td>

<td>
46
</td>

</tr>

<tr>

<th>
3147
</th>

<td>
0.8965
</td>

<td>
638659202.7460
</td>

<td>
47
</td>

</tr>

<tr>

<th>
3216
</th>

<td>
0.8972
</td>

<td>
634185691.1247
</td>

<td>
47
</td>

</tr>

<tr>

<th>
3280
</th>

<td>
0.8980
</td>

<td>
629406047.3486
</td>

<td>
47
</td>

</tr>

<tr>

<th>
3338
</th>

<td>
0.8980
</td>

<td>
629406047.3486
</td>

<td>
47
</td>

</tr>

<tr>

<th>
3215
</th>

<td>
0.8966
</td>

<td>
634104480.4550
</td>

<td>
48
</td>

</tr>

<tr>

<th>
3279
</th>

<td>
0.8971
</td>

<td>
631289057.8838
</td>

<td>
48
</td>

</tr>

<tr>

<th>
3337
</th>

<td>
0.8973
</td>

<td>
629924586.4262
</td>

<td>
48
</td>

</tr>

<tr>

<th>
3278
</th>

<td>
0.8963
</td>

<td>
631979589.5364
</td>

<td>
49
</td>

</tr>

<tr>

<th>
3336
</th>

<td>
0.8963
</td>

<td>
631979589.5364
</td>

<td>
49
</td>

</tr>

<tr>

<th>
3143
</th>

<td>
0.8961
</td>

<td>
625183661.9975
</td>

<td>
51
</td>

</tr>

</tbody>


</table>
<p>’</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-overflow-scroll code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>selected_vars <span class="op">=</span> [<span class="st">'MS_Zoning_RL'</span>, <span class="st">'Bsmt_Qual_Gd'</span>, <span class="st">'Condition_1_infrequent_sklearn'</span>, <span class="st">'Bsmt_Qual_TA'</span>, <span class="st">'Condition_1_Norm'</span>, <span class="st">'Enclosed_Porch'</span>, <span class="st">'Alley_No_Alley_Access'</span>, <span class="st">'Bsmt_Qual_Gd_x_Bsmt_Prop_c_'</span>, <span class="st">'Central_Air_Y'</span>, <span class="st">'House_Style_1Story'</span>, <span class="st">'Kitchen_Qual_TA'</span>, <span class="st">'Lot_Config_Inside'</span>, <span class="st">'Neighborhood_Crawfor_x_Gr_Liv_Area'</span>, <span class="st">'Full_Bath'</span>, <span class="st">'Garage_Finish_RFn'</span>, <span class="st">'Garage_Cars'</span>, <span class="st">'Overall_Qual_Good_or_Excellent'</span>, <span class="st">'Kitchen_Qual_Gd'</span>, <span class="st">'Neighborhood_NoRidge_x_Gr_Liv_Area'</span>, <span class="st">'Antique_c_'</span>, <span class="st">'Garage_Area'</span>, <span class="st">'Gr_Liv_A/Loot_A_c__x_Gr_Liv_A/Loot_A_c_'</span>, <span class="st">'Year_Built'</span>, <span class="st">'Neighborhood_NridgHt_x_Gr_Liv_Area'</span>, <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'Bedroom_AbvGr'</span>, <span class="st">'Lot_Area'</span>, <span class="st">'Area_Per_Room_c_'</span>, <span class="st">'2nd_Flr_SF'</span>, <span class="st">'Fireplaces'</span>, <span class="st">'Exter_Qual_Gd'</span>, <span class="st">'Total_Bsmt_SF'</span>, <span class="st">'1st_Flr_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>step_select <span class="op">=</span>ColumnTransformer(</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'selector'</span>, <span class="st">'passthrough'</span>, selected_vars )],</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'drop'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>knn_reg <span class="op">=</span> KNeighborsRegressor(</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>    n_neighbors <span class="op">=</span> <span class="dv">4</span> ,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    metric <span class="op">=</span> <span class="st">'manhattan'</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> <span class="st">'distance'</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>knn_regressor <span class="op">=</span> Pipeline([</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'feat_eng'</span>, get_df),</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'feature_selection'</span>, step_select),</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, knn_reg)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>knn_regressor.fit(ames_x_train, Sale_Price_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('feat_eng',
                 Pipeline(steps=[('clean_data',
                                  ColumnTransformer(remainder='passthrough',
                                                    transformers=[('not_usefull_variables',
                                                                   'drop',
                                                                   ['Sale_Type',
                                                                    'Sale_Condition',
                                                                    'Pool_QC',
                                                                    'Pool_Area',
                                                                    'Yr_Sold']),
                                                                  ('Impute_Alley',
                                                                   SimpleImputer(fill_value='No_Alley_Access',
                                                                                 strategy='constant'),
                                                                   ['Alley']),
                                                                  ('Impute_Mas_Vnr_Type',
                                                                   SimpleImputer(fill_value='...
                                                   'Neighborhood_NoRidge_x_Gr_Liv_Area',
                                                   'Antique_c_', 'Garage_Area',
                                                   'Gr_Liv_A/Loot_A_c__x_Gr_Liv_A/Loot_A_c_',
                                                   'Year_Built',
                                                   'Neighborhood_NridgHt_x_Gr_Liv_Area',
                                                   'TotRms_AbvGrd',
                                                   'Bedroom_AbvGr', 'Lot_Area',
                                                   'Area_Per_Room_c_',
                                                   '2nd_Flr_SF', 'Fireplaces', ...])],
                                   verbose_feature_names_out=False)),
                ('regressor',
                 KNeighborsRegressor(metric='manhattan', n_neighbors=4,
                                     weights='distance'))])</code></pre>
</div>
</div>
</section>
<section id="resultados-del-mejor-modelo" class="level2">
<h2 class="anchored" data-anchor-id="resultados-del-mejor-modelo">Resultados del mejor modelo</h2>
<p>Podemos ver que las métricas que se obtienen en los conjuntos de validación y testing, a comparación del modelo de regresión líneal nuestra estimación se aleja más del valor de testing en todas las métricas, aunado a que el modelo tiene únicamente 34 variables y el número de vecinos cercanos es bajo puede que el modelo sea demasiado flexible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> knn_regressor.predict(ames_x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> Sale_Price_test</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>test_r <span class="op">=</span> get_metrics(y_pred, y_obs, <span class="bu">len</span>(selected_vars))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>val_r <span class="op">=</span> get_metrics( knn_regressor.predict(ames_x_val), Sale_Price_validation, <span class="bu">len</span>(selected_vars))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>test_r[<span class="st">'vr'</span>] <span class="op">=</span> val_r.values</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> test_r.rename(columns <span class="op">=</span> {<span class="st">'vr'</span>: <span class="st">'Resultados Validación'</span>, <span class="st">'Value'</span>:<span class="st">'Resultados test'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
’

<table class="dataframe table table-sm table-striped small">

<thead>

<tr>

<th>
</th>

<th>
Resultados test
</th>

<th>
Resultados Validación
</th>

</tr>

<tr>

<th>
Metric
</th>

<th>
</th>

<th>
</th>

</tr>

</thead>

<tbody>

<tr>

<th>
ME
</th>

<td>
239.6245
</td>

<td>
-37.2498
</td>

</tr>

<tr>

<th>
MAE
</th>

<td>
19802.8608
</td>

<td>
19403.2008
</td>

</tr>

<tr>

<th>
MAPE
</th>

<td>
0.1299
</td>

<td>
0.1161
</td>

</tr>

<tr>

<th>
MSE
</th>

<td>
714581823.9031
</td>

<td>
805001656.3066
</td>

</tr>

<tr>

<th>
RMSE
</th>

<td>
26731.6633
</td>

<td>
28372.5511
</td>

</tr>

<tr>

<th>
R2
</th>

<td>
0.9104
</td>

<td>
0.8737
</td>

</tr>

<tr>

<th>
R2Adj
</th>

<td>
0.8929
</td>

<td>
0.8490
</td>

</tr>

</tbody>


</table>
<p>’</p>
</section>
<section id="importancia-de-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="importancia-de-las-variables">Importancia de las variables</h2>
<p>A diferencia de la regresión líneal, KNN tiende a darle más importancia a variables relacionadas al área en lugar de proporciones, además el modelo tiene menos de la mitad de variables que el modelo líneal, entre las variables más importantes encontramos los pies cuadrados del primer piso, los pies cuadrados totales del sótano y el área habitable así como variables relacionadas a la edad de la casa como el año de construcción y su antigüedad.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>importance_final_knn  <span class="op">=</span> importance_from_model(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    test_frame <span class="op">=</span> step_select.transform(transformed_test),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    y_obs <span class="op">=</span> Sale_Price_test ,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    selected_columns <span class="op">=</span>  selected_vars, </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    pipeline <span class="op">=</span> knn_reg,</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    actual_mse <span class="op">=</span> results[<span class="st">'Resultados test'</span>].MSE ,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    n_permutations<span class="op">=</span> <span class="dv">50</span>,</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    trans_pred<span class="op">=</span> <span class="va">False</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>importance_final_knn <span class="op">=</span> pd.read_csv(<span class="st">'../model/knn/importance_final.csv'</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  importance_final_knn <span class="op">&gt;&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  mutate(</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    ymin <span class="op">=</span> _.Mean_Loss <span class="op">-</span> _.Std_Loss,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    ymax <span class="op">=</span> _.Mean_Loss <span class="op">+</span> _.Std_Loss) <span class="op">&gt;&gt;</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">'reorder(Variable, Mean_Loss)'</span>, y <span class="op">=</span> <span class="st">"Mean_Loss"</span>)) <span class="op">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'ymin'</span>, ymax<span class="op">=</span><span class="st">'ymax'</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>)) <span class="op">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  geom_point(alpha <span class="op">=</span> <span class="fl">0.65</span>) <span class="op">+</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  labs(title<span class="op">=</span><span class="st">'Importancia de las Variables'</span>, x<span class="op">=</span><span class="st">'Variable'</span>, y<span class="op">=</span><span class="st">'Importancia'</span>) <span class="op">+</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  coord_flip() <span class="op">+</span>theme_minimal()</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-40-40.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>