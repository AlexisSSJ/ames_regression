<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Uriel Alexis Luna López">

<title>EDA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="EDA_files/libs/clipboard/clipboard.min.js"></script>
<script src="EDA_files/libs/quarto-html/quarto.js"></script>
<script src="EDA_files/libs/quarto-html/popper.min.js"></script>
<script src="EDA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="EDA_files/libs/quarto-html/anchor.min.js"></script>
<link href="EDA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="EDA_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="EDA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="EDA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="EDA_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">EDA</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Uriel Alexis Luna López </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="analisís-de-las-variables" class="level1">
<h1>Analisís de las variables</h1>
<section id="descripción-de-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="descripción-de-las-variables">Descripción de las variables</h2>
<section id="variables-continuas-y-númericas" class="level3">
<h3 class="anchored" data-anchor-id="variables-continuas-y-númericas">Variables continuas y númericas</h3>
<table class="table">
<colgroup>
<col style="width: 31%">
<col style="width: 68%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th style="text-align: left;">Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Lot_Frontage (Continua)</td>
<td style="text-align: left;">Loguitud que conectan la calle con la propiedad (en pies)</td>
</tr>
<tr class="even">
<td>Lot Area (Continua)</td>
<td style="text-align: left;">Tamaño del lote en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Mas Vnr Area (Continua)</td>
<td style="text-align: left;">Área de revestimiento de mampostería en pies cuadrados</td>
</tr>
<tr class="even">
<td>BsmtFin SF 1 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 1 en pies cuadrados</td>
</tr>
<tr class="odd">
<td>BsmtFin SF 2 (Continua)</td>
<td style="text-align: left;">Area del sótano terminada Tipo 2 en pies cuadrados</td>
</tr>
<tr class="even">
<td>Bsmt Unf SF (Continua)</td>
<td style="text-align: left;">Área sin terminar del sótano en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Total Bsmt SF (Continua)</td>
<td style="text-align: left;">Área total del sótano</td>
</tr>
<tr class="even">
<td>1st Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrqados del primer piso</td>
</tr>
<tr class="odd">
<td>2nd Flr SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados del segundo piso</td>
</tr>
<tr class="even">
<td>Low Qual Area SF (Continua)</td>
<td style="text-align: left;">Pies cuadrados terminados de baja calidad</td>
</tr>
<tr class="odd">
<td>Gr Liv Area (Continua)</td>
<td style="text-align: left;">Superficie habitable sobre el nivel del suelo en pies cuadrados</td>
</tr>
<tr class="even">
<td>Wood Deck SF (Continua)</td>
<td style="text-align: left;">Área de cubierta de madera en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Open Porch SF (Continua)</td>
<td style="text-align: left;">Área abierta del porche en pies cuadrados</td>
</tr>
<tr class="even">
<td>Enclose Porch (Continua)</td>
<td style="text-align: left;">Área cerrada del proche en pies cuadrados</td>
</tr>
<tr class="odd">
<td>3-Ssn Porch (Continua)</td>
<td style="text-align: left;">Área de porche de tres estaciones en pies cuadrados</td>
</tr>
<tr class="even">
<td>Screen Porch (Continua)</td>
<td style="text-align: left;">Área del porche cubierto en pies cuadrados</td>
</tr>
<tr class="odd">
<td>Pool Area (Continua)</td>
<td style="text-align: left;">Área de la piscina en pies cuadrados</td>
</tr>
<tr class="even">
<td>Misc Val (Continua)</td>
<td style="text-align: left;">Valor de la característica miscelanea</td>
</tr>
<tr class="odd">
<td><strong>Sale_Price (Continua)</strong></td>
<td style="text-align: left;">Precio de venta.</td>
</tr>
<tr class="even">
<td>Year Built (Discreta)</td>
<td style="text-align: left;">Año original de construcción</td>
</tr>
<tr class="odd">
<td>Year Remod/Add (Discreta)</td>
<td style="text-align: left;">Fecha de remodelación (la misma que la fecha de construcción si no se ha remodelado)</td>
</tr>
<tr class="even">
<td>Bsmt Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos en el sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños en el sótano</td>
</tr>
<tr class="even">
<td>Full Bath (Discreta)</td>
<td style="text-align: left;">Baños completos sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>Half Bath (Discreta)</td>
<td style="text-align: left;">Medios baños sobre el nivel del suelo</td>
</tr>
<tr class="even">
<td>Kitchen (Discreta)</td>
<td style="text-align: left;">Concinas sobre el nivel del suelo</td>
</tr>
<tr class="odd">
<td>TotRmsAbvGrd</td>
<td style="text-align: left;">Total de habitaciones sobre el nivel del suelo (no incluye baños)</td>
</tr>
<tr class="even">
<td>Fireplaces (Discreta)</td>
<td style="text-align: left;">Número de chimeneas</td>
</tr>
<tr class="odd">
<td>Garage Yr Blt (Discreta)</td>
<td style="text-align: left;">Año en que se construyó el garage</td>
</tr>
<tr class="even">
<td>Garage Cars (Discreta)</td>
<td style="text-align: left;">Tamaño del garage en cuanto a capacidad para autos.</td>
</tr>
<tr class="odd">
<td>Mo Sold (Discreta)</td>
<td style="text-align: left;">Mes de la venta (MM)</td>
</tr>
<tr class="even">
<td>Yr Sold (Discreta)</td>
<td style="text-align: left;">Año de la venta (YYYY)</td>
</tr>
</tbody>
</table>
</section>
<section id="varaibles-categóricas" class="level3">
<h3 class="anchored" data-anchor-id="varaibles-categóricas">Varaibles categóricas</h3>
<table class="table">
<colgroup>
<col style="width: 30%">
<col style="width: 69%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Descrición</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MS_Subclass (Nominal)</td>
<td>Identifica el tipo de vivienda de la venta</td>
</tr>
<tr class="even">
<td>MS_Zoning (Nominal)</td>
<td>Identifica la clasificación de la zona asociada a la venta</td>
</tr>
<tr class="odd">
<td>Street (Nominal)</td>
<td>Tipo de camino de acceso a la propiedad</td>
</tr>
<tr class="even">
<td>Alley (Nominal)</td>
<td>Tipo de callejón de acceso a la propiedad</td>
</tr>
<tr class="odd">
<td>Lot Contour (Nominal)</td>
<td>Planitud de la propiedad</td>
</tr>
<tr class="even">
<td>Lot Config (Nominal)</td>
<td>Configurarición del lote</td>
</tr>
<tr class="odd">
<td>Neightboorhood (Nominal)</td>
<td>Ubicación física dentro de los límites de la ciudad de Ames</td>
</tr>
<tr class="even">
<td>Condition 1 (Nominal)</td>
<td>Proximidad a varias condiciones</td>
</tr>
<tr class="odd">
<td>Condition 2 (Nominal)</td>
<td>Proximidad a varias condiciones (Si más de una es presente)</td>
</tr>
<tr class="even">
<td>Bldg Type (Nominal)</td>
<td>Tipo de vivienda</td>
</tr>
<tr class="odd">
<td>House Style (Nominal)</td>
<td>Estilo de la vivienda</td>
</tr>
<tr class="even">
<td>Roof Style (Nominal)</td>
<td>Tipo de techo</td>
</tr>
<tr class="odd">
<td>Roof Matl (Nominal)</td>
<td>Material del techo</td>
</tr>
<tr class="even">
<td>Exterior 1 (Nominal)</td>
<td>Revestimiento exterior de la casa</td>
</tr>
<tr class="odd">
<td>Exterior 2 (Nominal)</td>
<td>Revestimiento exterior de la casa (Si hay más de un material)</td>
</tr>
<tr class="even">
<td>Mas Vnr Type (Nominal)</td>
<td>Tipo de revestimiento de mampostería</td>
</tr>
<tr class="odd">
<td>Foundation (Nominal)</td>
<td>Tipo de cimentación</td>
</tr>
<tr class="even">
<td>Heating (Nominal)</td>
<td>Tipo de calefacción</td>
</tr>
<tr class="odd">
<td>Central Air (Nominal)</td>
<td>Aire acondicionado centralizado</td>
</tr>
<tr class="even">
<td>Garage Type (Nominal)</td>
<td>Ubicación del garage</td>
</tr>
<tr class="odd">
<td>Misc Feature (Nominal)</td>
<td>Característica miscelánea no cubierta en otras categorías</td>
</tr>
<tr class="even">
<td>Sale Type (Nominal)</td>
<td>Tipo de venta</td>
</tr>
<tr class="odd">
<td>Sale Condition (Nominal)</td>
<td>Condicón de la venta.</td>
</tr>
<tr class="even">
<td>Functional (Ordinal)</td>
<td>Funcionalidad del hogar (suponga que es típico a menos que se justifiquen deducciones)</td>
</tr>
<tr class="odd">
<td>FireplaceQu (Ordinal)</td>
<td>Calidad de las chimeneas</td>
</tr>
<tr class="even">
<td>Lot Shape (Ordinal)</td>
<td>Forma general de la propiedad</td>
</tr>
<tr class="odd">
<td>Pool QC (Ordinal)</td>
<td>Calidad de la piscina</td>
</tr>
<tr class="even">
<td>Utilities (Ordinal)</td>
<td>Tipo de utilidades disponibles</td>
</tr>
<tr class="odd">
<td>Land Slope (Ordinal)</td>
<td>Pendiente de la propiedad</td>
</tr>
<tr class="even">
<td>Overall Qual (Ordinal)</td>
<td>Califica el material general y el acabado de la casa.</td>
</tr>
<tr class="odd">
<td>Overall Cond (Ordinal)</td>
<td>Califica la condición general de la casa</td>
</tr>
<tr class="even">
<td>Exter Qual (Ordinal)</td>
<td>Evalua la calidad materiales de los exteriores</td>
</tr>
<tr class="odd">
<td>Exter Cond (Ordinal)</td>
<td>Evalua la condición presente del materia en el exterior</td>
</tr>
<tr class="even">
<td>Bsmt Qua (Ordinal)</td>
<td>Evalua la altura del sótano</td>
</tr>
<tr class="odd">
<td>Bsmt Cond (Ordinal)</td>
<td>Evalua la condición general del sótano</td>
</tr>
<tr class="even">
<td>Bsmt Exposure (Ordinal)</td>
<td>Se refiere a paredes a nivel de jardín o de salida</td>
</tr>
<tr class="odd">
<td>BsmtFin Type 1 (Ordinal)</td>
<td>Calificación del area terminada del sótano</td>
</tr>
<tr class="even">
<td>BsmtFin Type 2 (Ordinal)</td>
<td>Clasificación del área terminada del sótano (si hay varios tipos)</td>
</tr>
<tr class="odd">
<td>Heating QC (Ordinal)</td>
<td>Calidad y condición de la calefacción</td>
</tr>
<tr class="even">
<td>Electrical (Ordinal)</td>
<td>Sistema electrico</td>
</tr>
<tr class="odd">
<td>Kitchen Qaul (Ordinal)</td>
<td>Calidad de la cocina</td>
</tr>
<tr class="even">
<td>Garage Qual (Ordinal)</td>
<td>Calidad del Garage</td>
</tr>
<tr class="odd">
<td>Garage cond (Ordinal)</td>
<td>Condicón del garage</td>
</tr>
<tr class="even">
<td>Paved Drive (Ordinal)</td>
<td>Camino pavimentado.</td>
</tr>
<tr class="odd">
<td>Garage Finish (Ordnal)</td>
<td>El interior del garage esta terminado</td>
</tr>
<tr class="even">
<td>Fence (Ordinal)</td>
<td>Calidad de la cerca.</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">py_run_file</span>(<span class="st">'Custom_functions_ ames.py'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="analísis-de-sale-price" class="level2">
<h2 class="anchored" data-anchor-id="analísis-de-sale-price">Analísis de Sale Price</h2>
<p>A continuación se muestra el split inicial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ames <span class="op">=</span> (pd.read_excel( <span class="st">'../data/proyecto_ames_train.xlsx'</span>  ).rename(columns <span class="op">=</span> <span class="kw">lambda</span> x: x.replace (<span class="st">' '</span>,<span class="st">'_'</span>) )</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                <span class="op">&gt;&gt;</span> mutate (Price_4_GLA <span class="op">=</span> _.SalePrice<span class="op">/</span>_.Gr_Liv_Area))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ames.drop(index<span class="op">=</span> <span class="dv">821</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ames <span class="op">&gt;&gt;</span>  pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> select(ames, <span class="op">-</span>_.SalePrice, <span class="op">-</span>_.Price_4_GLA)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>numeric_column <span class="op">=</span> ames <span class="op">&gt;&gt;</span> pull(<span class="st">"Price_4_GLA"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>quartiles <span class="op">=</span> np.percentile(numeric_column, [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>])</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Crea una nueva variable categórica basada en los cuartiles</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a> numeric_column, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>ames_x_train, ames_x, ames_y_train, ames_y <span class="op">=</span> train_test_split(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                       X, y, </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                       test_size <span class="op">=</span> <span class="fl">0.30</span>, </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>stratify_variable <span class="op">=</span> pd.cut(</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a> ames_y , </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a> bins<span class="op">=</span>[<span class="bu">float</span>(<span class="st">'-inf'</span>), quartiles[<span class="dv">0</span>], quartiles[<span class="dv">1</span>], quartiles[<span class="dv">2</span>], <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a> labels<span class="op">=</span>[<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>]</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>ames_x_test, ames_x_val, ames_y_test, ames_y_val <span class="op">=</span> train_test_split(</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>       ames_x, ames_y, </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>       test_size <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>       random_state <span class="op">=</span> <span class="dv">12345</span>, </span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>       stratify <span class="op">=</span> stratify_variable</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>Sale_Price_train<span class="op">=</span> ames_y_train <span class="op">*</span> np.array(ames_x_train.Gr_Liv_Area)</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>Sale_Price_test <span class="op">=</span> ames_y_test <span class="op">*</span> ames_x_test.Gr_Liv_Area</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>Sale_Price_validation <span class="op">=</span> ames_y_val <span class="op">*</span> ames_x_val.Gr_Liv_Area</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Totales:</span><span class="ch">\t</span><span class="st">'</span>, ames.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Training:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_train.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Testing:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_test.shape[<span class="dv">0</span>],<span class="st">'</span><span class="ch">\n</span><span class="st">Validation:</span><span class="ch">\t</span><span class="st">'</span>, ames_y_val.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Totales:     1392 
Training:    974 
Testing:     209 
Validation:  209</code></pre>
</div>
</div>
<p>Cómo se observa, la distribución de los precios de venta se encuentra sesgada a la derecha, tienendo el 75% de las casas vendidas a un precio menor a $212,075 y aclumulando un la mitad de estos entre $129K y 212K. También en el siguiente qqplot podemos ver que la distribución de los precios de venta no parece seguir una distribución normal.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure()</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>Sale_Price_train, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                annotate(<span class="st">'text'</span>,x<span class="op">=</span><span class="fl">0.3</span>,y<span class="op">=</span><span class="dv">500000</span>, label<span class="op">=</span>summary,ymax<span class="op">=</span><span class="dv">400000</span>)<span class="op">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_dist-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qqplot_Sale_Price-3.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>A diferencia de la distribución de los precios se venta de la casa, el precio por pie cuadrado habitable de la casa parece tener un comportamiento más normal:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>summary <span class="op">=</span> <span class="st">"count: 974</span><span class="ch">\n</span><span class="st">mean: $122.11</span><span class="ch">\n</span><span class="st">std: $32.60</span><span class="ch">\n</span><span class="st">Q1: $100.69</span><span class="ch">\n</span><span class="st">Q2:$120.64</span><span class="ch">\n</span><span class="st">Q3: $141.27</span><span class="ch">\n</span><span class="st">min: $17.87</span><span class="ch">\n</span><span class="st">max:$276.25"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure()</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span><span class="dv">0</span>))<span class="op">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                geom_violin( fill<span class="op">=</span><span class="st">'#702C27'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                style<span class="op">=</span><span class="st">'right'</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                                alpha<span class="op">=</span><span class="fl">0.6</span>)<span class="op">+</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                geom_jitter(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                            size<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                            alpha<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                            color<span class="op">=</span><span class="st">'#006DC8'</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                            width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                            random_state<span class="op">=</span><span class="dv">7</span>)<span class="op">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                geom_boxplot(aes(x<span class="op">=</span>np.zeros(<span class="dv">974</span> )<span class="op">-</span><span class="fl">0.21</span>),width<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                    color<span class="op">=</span><span class="st">'#182E40'</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                    alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                    outlier_alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                                    outlier_color<span class="op">=</span><span class="st">'#235C6C'</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                                    outlier_size<span class="op">=</span><span class="fl">1.5</span>)<span class="op">+</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                coord_flip()<span class="op">+</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                theme_classic()<span class="op">+</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">'Distribución de los precios de venta'</span>)<span class="op">+</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>))<span class="op">+</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                ylab(<span class="st">'Precio de venta'</span>)<span class="op">+</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                annotate(<span class="st">'text'</span>,x<span class="op">=</span><span class="fl">0.3</span>,y<span class="op">=</span><span class="dv">200</span>, label<span class="op">=</span>summary,ymax<span class="op">=</span><span class="dv">200</span>)<span class="op">+</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                geom_text(ha<span class="op">=</span><span class="st">'left'</span>,label<span class="op">=</span>summary, x<span class="op">=</span><span class="fl">0.3</span>, y<span class="op">=</span><span class="dv">500000</span>, size<span class="op">=</span><span class="dv">10</span>, fontweight<span class="op">=</span><span class="dv">1</span>)<span class="op">+</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                theme(axis_ticks_minor_y<span class="op">=</span>element_blank(),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                        axis_ticks_major_y<span class="op">=</span>element_blank(),</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                        axis_text_y<span class="op">=</span>element_blank()</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                        )<span class="op">+</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                theme(figure_size<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/sale_price_GLA_DIST-5.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>params<span class="op">=</span>{<span class="st">'loc'</span>:ames_y_train.mean(), <span class="st">'scale'</span>:ames_y_train.std()}</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                ggplot(aes(sample<span class="op">=</span>ames_y_train))<span class="op">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>,distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params)<span class="op">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                stat_qq_line(distribution<span class="op">=</span><span class="st">'norm'</span>, dparams<span class="op">=</span>params,color <span class="op">=</span> <span class="st">"red"</span>)<span class="op">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                xlab(<span class="st">"Cuantilies de la dist. normal teórica"</span>) <span class="op">+</span> ylab(<span class="st">"Cuantiles de Sale Price"</span>) <span class="op">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                ggtitle(<span class="st">"QQ-Plot N~(mean=180,996.79, sd=81,186.69)"</span>)<span class="op">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                theme_seaborn()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/qq%20plot%20new%20y-7.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-continuas-vs-transformación-de-sale_price" class="level2">
<h2 class="anchored" data-anchor-id="variables-continuas-vs-transformación-de-sale_price">Variables Continuas VS Transformación de Sale_Price</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ames_train <span class="op">=</span> ames_x_train.copy()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ames_train[<span class="st">'Sale_Price/Gr_Liv_Area'</span>] <span class="op">=</span> ames_y_train</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>correlation_data <span class="op">=</span> (</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().melt(  ignore_index<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                                        var_name<span class="op">=</span><span class="st">'var1'</span>).reset_index() <span class="op">&gt;&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                    select( _.var1,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                            _.var2 <span class="op">==</span> _.index,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                            _.cor <span class="op">==</span> _.value  ) </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>labels<span class="op">=</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span> case_when({_.cor.between(<span class="op">-</span><span class="fl">0.3</span>, <span class="fl">0.3</span>):<span class="st">''</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                                    _.cor<span class="op">&gt;</span><span class="fl">0.99991</span>: <span class="st">''</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="va">True</span> :_.cor.<span class="bu">round</span>(<span class="dv">2</span>).astype(<span class="bu">str</span>)})</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    correlation_data <span class="op">&gt;&gt;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        arrange(<span class="op">-</span>_.cor,_.var1) <span class="op">&gt;&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># filter (_.var1!=_.var2) &gt;&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        mutate(labb<span class="op">=</span>labels)<span class="op">&gt;&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        ggplot(aes(x<span class="op">=</span><span class="st">'var1'</span>, y<span class="op">=</span><span class="st">'var2'</span>, fill<span class="op">=</span> <span class="st">'cor'</span>))<span class="op">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        geom_tile()<span class="op">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        geom_label(aes(label<span class="op">=</span><span class="st">'labb'</span>), size<span class="op">=</span><span class="dv">6</span>)<span class="op">+</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        scale_fill_gradientn(colors<span class="op">=</span>[<span class="st">'#0092ff'</span>,<span class="st">'#e6d6c7'</span>,<span class="st">'#FF1400'</span>],</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                            limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                            name<span class="op">=</span><span class="st">'Correlación'</span>)<span class="op">+</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        ggtitle(<span class="st">'Mapa de calor de correlaciones para variables continuas'</span>)<span class="op">+</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        xlab(<span class="st">''</span>)<span class="op">+</span>ylab(<span class="st">''</span>)<span class="op">+</span><span class="co">#guides(fill=guide_legend(title="New Legend Title"))+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        theme(axis_text_x<span class="op">=</span>element_text(rotation<span class="op">=</span><span class="dv">90</span>,hjust <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                figure_size<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_heatmap_HCC-9.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Como podemos observar para ser que las varaibles de <code>'BsmtFin_SF_1', 'First_Flr_SF', 'Second_Flr_SF', 'Total_Bsmt_SF'</code> son las que tienen correlaciones más grandes con el precio de venta por el precio por pie cuadrado habitable. En el gráfico sólo se muestran etiquetas de correlaciones que no estan en el intervalo (-0.3.0.3).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ames_train[continuas].corr().reset_index(drop<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> select(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>],_.index)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> <span class="bu">filter</span>(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>] <span class="op">!=</span> <span class="dv">1</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> mutate (labels <span class="op">=</span> np.<span class="bu">round</span>(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>], <span class="dv">3</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> arrange(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>, x<span class="op">=</span><span class="st">'index'</span>, fill<span class="op">=</span><span class="st">'Sale_Price/Gr_Liv_Area'</span>))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_col()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> geom_text(aes(label <span class="op">=</span> <span class="st">'labels'</span>) , size<span class="op">=</span><span class="dv">8</span>, va<span class="op">=</span><span class="st">'center'</span>, angle<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> ylim([<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>])</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area vs otras variables'</span>, y<span class="op">=</span><span class="st">''</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> scale_fill_gradient2(low<span class="op">=</span><span class="st">'#4EB043'</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                           mid<span class="op">=</span><span class="st">'#B05F43'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                           high<span class="op">=</span> <span class="st">'#3A3AD5'</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                           midpoint<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                           limits<span class="op">=</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                           name<span class="op">=</span><span class="st">'Correlación'</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme_bw()</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/corr_sp/gla-11.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="precios-dependiendo-la-ubicación" class="level2">
<h2 class="anchored" data-anchor-id="precios-dependiendo-la-ubicación">Precios dependiendo la ubicación</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  ames_train </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> group_by(_.Neighborhood) </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> summarize(media <span class="op">=</span> np.mean(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]), desv<span class="op">=</span>np.std(_[<span class="st">'Sale_Price/Gr_Liv_Area'</span>]))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> mutate( max_err <span class="op">=</span> _.media  <span class="op">+</span> _.desv, min_err <span class="op">=</span>  _.media  <span class="op">-</span> _.desv)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> arrange(_.media)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot(aes(x<span class="op">=</span><span class="st">'reorder(Neighborhood,media)'</span>, y<span class="op">=</span><span class="st">'media'</span>) ) </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_errorbar(aes(ymin<span class="op">=</span><span class="st">'min_err'</span>, ymax<span class="op">=</span><span class="st">'max_err'</span>),width<span class="op">=</span><span class="fl">0.3</span>, position<span class="op">=</span>position_dodge(<span class="fl">0.9</span>))<span class="op">+</span>geom_point()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_bw()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme(axis_text_x<span class="op">=</span>element_text(angle<span class="op">=</span><span class="dv">90</span>))</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>coord_flip()</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>labs(y<span class="op">=</span><span class="st">'Precio  promedio por pie cuadrado de área habitable'</span>, x<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/error_bars%20por%20vecindario-13.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="variables-relacionadas-con-el-sótano" class="level2">
<h2 class="anchored" data-anchor-id="variables-relacionadas-con-el-sótano">Variables relacionadas con el sótano</h2>
<p>Se puede ver que se tiene una relación líneal creciente entre <code>Total_Bsmt_SF</code> y <code>Sale_Price\ Gr_Liv_Area</code>, en la siguiente gráfica tambien podemos ver como varios puntos se acumulan en <code>Total_Bsmt_SF = 0</code> debido a que estas casas no cuentan con sótano</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ames_x_train </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> ggplot( aes(y<span class="op">=</span>ames_y_train, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_point(size<span class="op">=</span><span class="dv">1</span>,alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">2500</span>])</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> labs(title <span class="op">=</span> <span class="st">'Total_Bsmt_SF vs  Sale Price/ Gr_Liv_Area'</span>, x<span class="op">=</span><span class="st">'Total_Bsmt_SF'</span>, y<span class="op">=</span><span class="st">'Sale Price/ Gr_Liv_Area'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">+</span> theme_538()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/price%20vs%20sf%20sotano-15.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>En cuanto a las variables categóricas relacionadas al sótano encontramos lo siguiente:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>cat_columns <span class="op">=</span> pd.Series([<span class="st">'Bldg_Type'</span>, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Exposure'</span>, </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Central_Air'</span>, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_1'</span>, </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Condition_2'</span>, </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Electrical'</span>, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Fence'</span>, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Foundation'</span>, </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Finish'</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Type'</span>, </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Feature'</span>, </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Paved_Drive'</span>, </span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Heating_QC'</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Overall_Cond'</span>,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_SubClass'</span>, </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MS_Zoning'</span>,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Cond'</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_1'</span>, </span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_Type_2'</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">'House_Style'</span>,</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Shape'</span>,</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Neighborhood'</span>])</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> category <span class="kw">in</span> cat_columns[cat_columns.<span class="bu">str</span>.contains(<span class="st">'Bsmt'</span>)]:</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  titulo<span class="op">=</span><span class="st">'Categoría analazada: </span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category) </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  (ames_train  <span class="op">&gt;&gt;</span> ggplot(aes(y<span class="op">=</span> <span class="st">'Sale_Price/Gr_Liv_Area'</span>, x<span class="op">=</span> <span class="st">'Total_Bsmt_SF'</span>, color<span class="op">=</span> <span class="st">'</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category)))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> geom_point(alpha<span class="op">=</span> <span class="fl">0.5</span>, show_legend<span class="op">=</span><span class="va">False</span>) <span class="op">+</span> geom_smooth(color<span class="op">=</span><span class="st">'black'</span>, method <span class="op">=</span> <span class="st">'lm'</span>)</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>xlim([<span class="dv">0</span>,<span class="dv">3000</span>])</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span>labs(x<span class="op">=</span><span class="st">'Área total del sótano'</span>, y<span class="op">=</span><span class="st">'Precio por pie cuadrado de área habitable bruta'</span>, title<span class="op">=</span>titulo)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>              <span class="op">+</span> facet_wrap(<span class="st">'~</span><span class="sc">{}</span><span class="st">'</span>.<span class="bu">format</span>(category))<span class="op">+</span>theme_538 ()) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-17.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-18.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-19.png" class="img-fluid" width="614"></p>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/analisis%20sotano-20.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>Puntos a considerar:</p>
<ul>
<li><p>En <code>Bsmt_Exposure</code> se puede notar que la relación positiva entre las variables se mantiene, y no parece cambiar si se altera la exposicón del sótano. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
<li><p>En <code>Bsmt_Cond</code> se puede ver que la relación de las variables si cambia dependiendo de la condición del sótano, además en la condición de Excellent y Poor se tienen muy pocas observaciones.</p></li>
<li><p>En <code>Bsmt_Type_1</code> se tienen relaciones demaciado planas en su mayoria, a excepción de GLQ y Unf.</p></li>
<li><p>En <code>Bsmt_Type_2</code> se tiene el mismo caso que en el anterior. Además se muestran elementos con <code>Total_Bmst_SF</code>&gt;0 que caen en la categoría de No basement, lo cual puede deberse a un error.</p></li>
</ul>
</section>
</section>
<section id="regresión-líneal" class="level1">
<h1>Regresión Líneal</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pd.options.display.float_format <span class="op">=</span> <span class="st">'</span><span class="sc">{:.2f}</span><span class="st">'</span>.<span class="bu">format</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> importance_from_model (test_frame, y_obs, selected_columns, pipeline, actual_mse, n_permutations<span class="op">=</span><span class="dv">50</span> ,trans_pred<span class="op">=</span> <span class="va">False</span> ):</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  performance_losses <span class="op">=</span> []</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(test_frame[selected_columns].shape[<span class="dv">1</span>]):</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    loss <span class="op">=</span> []</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(n_permutations):</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        test_frame_permuted <span class="op">=</span> test_frame[selected_columns].copy()</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        test_frame_permuted.iloc[:, i] <span class="op">=</span> np.random.permutation(test_frame_permuted.iloc[:, i])</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> trans_pred <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            y_pred_permuted <span class="op">=</span> pipeline.predict(test_frame_permuted)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>            y_pred_permuted <span class="op">=</span> pipeline.predict(test_frame_permuted)<span class="op">*</span> test_frame_permuted.Gr_Liv_Area</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        mse_permuted <span class="op">=</span> mean_squared_error(y_obs, y_pred_permuted)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>        loss.append(mse_permuted)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    performance_losses.append(loss)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  performance_losses <span class="op">=</span> performance_losses<span class="op">/</span>np.<span class="bu">sum</span>(performance_losses, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  mean_losses <span class="op">=</span> np.mean(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  std_losses <span class="op">=</span> np.std(performance_losses, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Variable'</span>: selected_columns, </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Mean_Loss'</span>: mean_losses, </span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">'Std_Loss'</span>: std_losses</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> importance_df</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adjusted_r2_score(y_true, y_pred, n, p):</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>  adjusted_r2 <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (<span class="dv">1</span> <span class="op">-</span> r2) <span class="op">*</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> adjusted_r2</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> div_columns(X, c1, c2):</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>    X[<span class="st">"c1_c2"</span>] <span class="op">=</span> X[c1]<span class="op">/</span> X[c2]</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adj_r(y_o, y_p , p, n):</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>  r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2_score(y_o, y_p))</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_metrics (y_pred, y_obs,predictors):</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>  me <span class="op">=</span> np.mean(y_obs <span class="op">-</span> y_pred)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>  mae <span class="op">=</span> mean_absolute_error(y_obs, y_pred)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>  mape <span class="op">=</span> mean_absolute_percentage_error(y_obs, y_pred)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>  mse <span class="op">=</span> mean_squared_error(y_obs, y_pred)</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>  rmse <span class="op">=</span> np.sqrt(mse)</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>  r2 <span class="op">=</span> r2_score(y_obs, y_pred)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>  n <span class="op">=</span> <span class="bu">len</span>(y_obs)  <span class="co"># Número de observaciones</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>  p <span class="op">=</span> predictors  <span class="co"># Número de predictores </span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>  r2_adj <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> (n <span class="op">-</span> <span class="dv">1</span>) <span class="op">/</span> (n <span class="op">-</span> p <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> r2)</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>  metrics_data <span class="op">=</span> {</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Metric"</span>: [<span class="st">"ME"</span>, <span class="st">"MAE"</span>, <span class="st">"MAPE"</span>, <span class="st">"MSE"</span>, <span class="st">"RMSE"</span>, <span class="st">"R2"</span>, <span class="st">"R2Adj"</span>],</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Value"</span>: [me, mae, mape, mse, rmse, r2, r2_adj]</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> pd.DataFrame(metrics_data).set_index(<span class="st">'Metric'</span>)</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rmv_elements (list_of_elements, complete_list):</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> element <span class="kw">in</span> list_of_elements:</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    complete_list.remove(element)</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> complete_list</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> validation_results(x_val,y_val,  pipeline , n_preds):</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> pipeline.predict(x_val)</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>  ames_test <span class="op">=</span> (</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    ames_x_val <span class="op">&gt;&gt;</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>    mutate(Sale_Price_Pred <span class="op">=</span> y_pred, Sale_Price <span class="op">=</span>y_val))</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>  <span class="co">##### Métricas de desempeño</span></span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>  y_obs <span class="op">=</span> ames_test[<span class="st">"Sale_Price"</span>]</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a>  y_pred <span class="op">=</span> ames_test[<span class="st">"Sale_Price_Pred"</span>]</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> get_metrics(y_pred, y_obs, n_preds)</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> intersection(lst1, lst2):</span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a>    lst3 <span class="op">=</span> [value <span class="cf">for</span> value <span class="kw">in</span> lst1 <span class="cf">if</span> value <span class="kw">in</span> lst2]</span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lst3</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_cv (df, param_p <span class="op">=</span> <span class="va">False</span>):</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> param_p <span class="op">==</span> <span class="va">False</span>:</span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a>    (df </span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span>, MAPE <span class="op">=</span> <span class="bu">abs</span> (_.mean_test_mape))</span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>                      cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'MAPE'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>                      names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a>                      values_to<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>)) </span>
<span id="cb12-104"><a href="#cb12-104" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="fl">0.9</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb12-105"><a href="#cb12-105" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb12-106"><a href="#cb12-106" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )).draw(<span class="va">True</span>)</span>
<span id="cb12-107"><a href="#cb12-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb12-108"><a href="#cb12-108" aria-hidden="true" tabindex="-1"></a>    (df </span>
<span id="cb12-109"><a href="#cb12-109" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> mutate(RMSE <span class="op">=</span> <span class="bu">abs</span>(_.mean_test_neg_mean_squared_error)<span class="op">**</span><span class="fl">0.5</span> , MAPE <span class="op">=</span> <span class="bu">abs</span> (_.mean_test_mape))</span>
<span id="cb12-110"><a href="#cb12-110" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> pivot_longer(</span>
<span id="cb12-111"><a href="#cb12-111" aria-hidden="true" tabindex="-1"></a>                      cols<span class="op">=</span>[<span class="st">'mean_test_r2'</span>, <span class="st">'MAPE'</span>,<span class="st">'RMSE'</span>],</span>
<span id="cb12-112"><a href="#cb12-112" aria-hidden="true" tabindex="-1"></a>                      names_to<span class="op">=</span><span class="st">'parameter'</span>, </span>
<span id="cb12-113"><a href="#cb12-113" aria-hidden="true" tabindex="-1"></a>                      values_to<span class="op">=</span><span class="st">'value'</span>)</span>
<span id="cb12-114"><a href="#cb12-114" aria-hidden="true" tabindex="-1"></a>      <span class="op">&gt;&gt;</span> ggplot( aes(x <span class="op">=</span> <span class="st">"param_n_neighbors"</span>, y <span class="op">=</span> <span class="st">"value"</span>, shape <span class="op">=</span> <span class="st">"param_weights"</span>, color<span class="op">=</span> <span class="st">'param_metric'</span>,size <span class="op">=</span> <span class="st">'param_p'</span>)) </span>
<span id="cb12-115"><a href="#cb12-115" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> geom_point(alpha <span class="op">=</span> <span class="fl">0.9</span>,position<span class="op">=</span>position_dodge(width<span class="op">=</span><span class="fl">0.1</span>))</span>
<span id="cb12-116"><a href="#cb12-116" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> facet_wrap(<span class="st">"~parameter"</span>,ncol <span class="op">=</span><span class="dv">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>)</span>
<span id="cb12-117"><a href="#cb12-117" aria-hidden="true" tabindex="-1"></a>      <span class="op">+</span> labs( y <span class="op">=</span> <span class="st">''</span>,x<span class="op">=</span> <span class="st">'Parámetro: vecinos cercanos K'</span> ,shape <span class="op">=</span> <span class="st">'Ponderación'</span>,color <span class="op">=</span> <span class="st">'Métrica'</span> )).draw(<span class="va">True</span>)</span>
<span id="cb12-118"><a href="#cb12-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-119"><a href="#cb12-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-120"><a href="#cb12-120" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> div_columns(X, c1, c2, feature_name ):</span>
<span id="cb12-121"><a href="#cb12-121" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> feature_name<span class="op">+</span><span class="st">'_c_'</span></span>
<span id="cb12-122"><a href="#cb12-122" aria-hidden="true" tabindex="-1"></a>    X[c1] <span class="op">=</span> X[c1].astype(<span class="bu">float</span>)</span>
<span id="cb12-123"><a href="#cb12-123" aria-hidden="true" tabindex="-1"></a>    X[c2] <span class="op">=</span> X[c2].astype(<span class="bu">float</span>)</span>
<span id="cb12-124"><a href="#cb12-124" aria-hidden="true" tabindex="-1"></a>    X[name] <span class="op">=</span> X[c1]<span class="op">/</span> X[c2]</span>
<span id="cb12-125"><a href="#cb12-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X[[name]]</span>
<span id="cb12-126"><a href="#cb12-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-127"><a href="#cb12-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-128"><a href="#cb12-128" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> div_columns2(X, c1, c2, feature_name ):</span>
<span id="cb12-129"><a href="#cb12-129" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> feature_name<span class="op">+</span><span class="st">'_c_'</span></span>
<span id="cb12-130"><a href="#cb12-130" aria-hidden="true" tabindex="-1"></a>    X[c1] <span class="op">=</span> X[c1].astype(<span class="bu">float</span>)</span>
<span id="cb12-131"><a href="#cb12-131" aria-hidden="true" tabindex="-1"></a>    X[c2] <span class="op">=</span> X[c2].astype(<span class="bu">float</span>)</span>
<span id="cb12-132"><a href="#cb12-132" aria-hidden="true" tabindex="-1"></a>    X[name] <span class="op">=</span> X[c1]<span class="op">/</span> X[c2]</span>
<span id="cb12-133"><a href="#cb12-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> X[[name]].fillna(<span class="dv">0</span>)</span>
<span id="cb12-134"><a href="#cb12-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-135"><a href="#cb12-135" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> collapse(X, c1, dic):</span>
<span id="cb12-136"><a href="#cb12-136" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> X[[c1]].replace(dic)</span>
<span id="cb12-137"><a href="#cb12-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-138"><a href="#cb12-138" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cross_interactions (X, num, cat, return_inputs <span class="op">=</span> <span class="st">'none'</span>):</span>
<span id="cb12-139"><a href="#cb12-139" aria-hidden="true" tabindex="-1"></a>    return_cols <span class="op">=</span> []</span>
<span id="cb12-140"><a href="#cb12-140" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> X.<span class="bu">filter</span>(regex<span class="op">=</span>(cat)).copy()</span>
<span id="cb12-141"><a href="#cb12-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> column <span class="kw">in</span> df.columns.to_list():</span>
<span id="cb12-142"><a href="#cb12-142" aria-hidden="true" tabindex="-1"></a>      name <span class="op">=</span> column <span class="op">+</span> <span class="st">'_x_'</span><span class="op">+</span> num</span>
<span id="cb12-143"><a href="#cb12-143" aria-hidden="true" tabindex="-1"></a>      X[name] <span class="op">=</span> df[column] <span class="op">*</span> X[num]</span>
<span id="cb12-144"><a href="#cb12-144" aria-hidden="true" tabindex="-1"></a>      return_cols.append(name)</span>
<span id="cb12-145"><a href="#cb12-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> return_inputs <span class="op">==</span> <span class="st">'none'</span>:</span>
<span id="cb12-146"><a href="#cb12-146" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols]</span>
<span id="cb12-147"><a href="#cb12-147" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'both'</span>:</span>
<span id="cb12-148"><a href="#cb12-148" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> df.columns.to_list() <span class="op">+</span> [num]]</span>
<span id="cb12-149"><a href="#cb12-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'num'</span>:</span>
<span id="cb12-150"><a href="#cb12-150" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> [num]]</span>
<span id="cb12-151"><a href="#cb12-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-152"><a href="#cb12-152" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols<span class="op">+</span> df.columns.to_list()]</span>
<span id="cb12-153"><a href="#cb12-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-154"><a href="#cb12-154" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cross_interactions2 (X, num, cat, return_inputs <span class="op">=</span> <span class="st">'none'</span>):</span>
<span id="cb12-155"><a href="#cb12-155" aria-hidden="true" tabindex="-1"></a>    return_cols <span class="op">=</span> []</span>
<span id="cb12-156"><a href="#cb12-156" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> X.<span class="bu">filter</span>(regex<span class="op">=</span>(cat)).copy()</span>
<span id="cb12-157"><a href="#cb12-157" aria-hidden="true" tabindex="-1"></a>    df2 <span class="op">=</span> X.<span class="bu">filter</span>(regex<span class="op">=</span>(num)).copy()</span>
<span id="cb12-158"><a href="#cb12-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col_num <span class="kw">in</span> df2.columns.to_list():</span>
<span id="cb12-159"><a href="#cb12-159" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> column <span class="kw">in</span> df.columns.to_list():</span>
<span id="cb12-160"><a href="#cb12-160" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> column <span class="op">+</span> <span class="st">'_x_'</span><span class="op">+</span> col_num</span>
<span id="cb12-161"><a href="#cb12-161" aria-hidden="true" tabindex="-1"></a>        X[name] <span class="op">=</span> df[column] <span class="op">*</span> X[col_num]</span>
<span id="cb12-162"><a href="#cb12-162" aria-hidden="true" tabindex="-1"></a>        return_cols.append(name)</span>
<span id="cb12-163"><a href="#cb12-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> return_inputs <span class="op">==</span> <span class="st">'none'</span>:</span>
<span id="cb12-164"><a href="#cb12-164" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols]</span>
<span id="cb12-165"><a href="#cb12-165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'both'</span>:</span>
<span id="cb12-166"><a href="#cb12-166" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> df.columns.to_list() <span class="op">+</span> df2.columns.to_list()]</span>
<span id="cb12-167"><a href="#cb12-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> return_inputs <span class="op">==</span> <span class="st">'num'</span>:</span>
<span id="cb12-168"><a href="#cb12-168" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols <span class="op">+</span> df2.columns.to_list()]</span>
<span id="cb12-169"><a href="#cb12-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb12-170"><a href="#cb12-170" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> X[return_cols<span class="op">+</span> df.columns.to_list()]</span>
<span id="cb12-171"><a href="#cb12-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-172"><a href="#cb12-172" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> antique_func(X,yb, yr):</span>
<span id="cb12-173"><a href="#cb12-173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (X <span class="op">&gt;&gt;</span> mutate (Antique_c_ <span class="op">=</span> <span class="dv">2023</span> <span class="op">-</span> _[yb], Last_remod_c_ <span class="op">=</span> <span class="dv">2023</span> <span class="op">-</span> _[yr], Antique2_c_<span class="op">=</span>(<span class="dv">2023</span> <span class="op">-</span> _[yb])<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb12-174"><a href="#cb12-174" aria-hidden="true" tabindex="-1"></a>          <span class="op">&gt;&gt;</span> select (_.contains (<span class="st">'_c_'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="imputacion-de-datos" class="level1">
<h1>Imputacion de datos</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_selector</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Sólo 4 casas tienen Piscina/ por lo tanto esta variable no es útil</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>ames_x_train <span class="op">&gt;&gt;</span> select(_.contains(<span class="st">'Pool'</span>)) <span class="op">&gt;&gt;</span> <span class="bu">filter</span> (_.Pool_Area<span class="op">==</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Pool_Area Pool_QC
1253          0     NaN
120           0     NaN
1027          0     NaN
40            0     NaN
465           0     NaN
...         ...     ...
270           0     NaN
977           0     NaN
823           0     NaN
852           0     NaN
1303          0     NaN

[970 rows x 2 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>n_usefull <span class="op">=</span> [<span class="st">'Sale_Type'</span>, <span class="st">'Sale_Condition'</span>, <span class="st">'Pool_QC'</span>, <span class="st">'Pool_Area'</span>, <span class="st">'Yr_Sold'</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># NA de Alley are no_alley ACCES</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># na de Mas_Vnr_Type es none</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># NA EN Bsmt_Qual es No_basement</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#remember quit "No_Basement" cat</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># electrical imput mode</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># no fire place imput 'No_Fireplace'</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>clean_and_imputers <span class="op">=</span> ColumnTransformer(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    [(<span class="st">'not_usefull_variables'</span>, <span class="st">'drop'</span>, n_usefull),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Alley'</span>, SimpleImputer(</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Alley_Access'</span>), [<span class="st">'Alley'</span>]),</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Mas_Vnr_Type'</span>, SimpleImputer(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'None'</span>), [<span class="st">'Mas_Vnr_Type'</span>]),</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Mas_Vnr_Area'</span>, SimpleImputer(</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), [<span class="st">'Mas_Vnr_Area'</span>]),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Lot_Frontage'</span>, SimpleImputer(</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'mean'</span>), [<span class="st">'Lot_Frontage'</span>]),</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Fireplace_Qu'</span>, SimpleImputer(</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Fireplace'</span>), [<span class="st">'Fireplace_Qu'</span>]),</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Electrical'</span>, SimpleImputer(</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'most_frequent'</span>),[<span class="st">'Electrical'</span>]),</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Bsmt_Cat'</span>, SimpleImputer(</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Basement'</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Bsmt'</span>,dtype_include <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Bsmt_Numeric'</span>, SimpleImputer(</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Bsmt'</span>,dtype_exclude <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Garage'</span>, SimpleImputer(</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Garage'</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Garage'</span>,dtype_include <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Garage_numeric'</span>, SimpleImputer(</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="dv">0</span>), make_column_selector(pattern <span class="op">=</span> <span class="st">'Garage'</span>,dtype_exclude <span class="op">=</span> <span class="st">'object'</span>)),</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Fence'</span>, SimpleImputer(</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'No_Fence'</span>), [<span class="st">'Fence'</span>]),</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>     (<span class="st">'Impute_Misc_Feature'</span>, SimpleImputer(</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>         missing_values<span class="op">=</span>np.nan,</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>         strategy<span class="op">=</span><span class="st">'constant'</span>, </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>         fill_value<span class="op">=</span> <span class="st">'None'</span>), [<span class="st">'Misc_Feature'</span>])</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span> <span class="st">'passthrough'</span>,</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>clean_ames_x_train <span class="op">=</span> clean_and_imputers.fit_transform(ames_x_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cond <span class="op">=</span>{<span class="dv">1</span>: <span class="st">'Poor'</span>, <span class="dv">2</span>:<span class="st">'Poor'</span>,<span class="dv">3</span>:<span class="st">'Poor'</span>,<span class="dv">4</span>:<span class="st">'Average'</span>, <span class="dv">5</span>:<span class="st">'Average'</span>,<span class="dv">6</span>:<span class="st">'Average'</span>, <span class="dv">7</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">8</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">9</span>:<span class="st">'Good_or_Excellent'</span>, <span class="dv">10</span> :<span class="st">'Good_or_Excellent'</span>}</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>feature_eng <span class="op">=</span> ColumnTransformer(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'collapse_cond'</span>,  FunctionTransformer(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                                 collapse,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Overall_Cond'</span>, <span class="st">'dic'</span> : cond }</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Overall_Cond'</span>]),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'collapse_cond2'</span>,  FunctionTransformer(</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                                 collapse,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Overall_Qual'</span>, <span class="st">'dic'</span> : cond }</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Overall_Qual'</span>]),</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Area_Per_Room'</span>,  FunctionTransformer(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Area_Per_Room'</span>}</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'TotRms_AbvGrd'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Wood_propGLA'</span>,  FunctionTransformer(</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Wood_Deck_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Wood_propGLA'</span>}</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Wood_Deck_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'MVNRA_prop'</span>,  FunctionTransformer(</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Mas_Vnr_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Lot_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'MVNRA_propLA'</span>}</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Mas_Vnr_Area'</span>, <span class="st">'Lot_Area'</span>]),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'2nd_Flr_SF_propGLA'</span>,  FunctionTransformer(</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'2nd_Flr_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'2nd_Flr_SF_propGLA'</span>}</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'2nd_Flr_SF'</span>, <span class="st">'Gr_Liv_Area'</span>]),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Bsmt_Prop'</span>,  FunctionTransformer(</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Total_Bsmt_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Bsmt_Prop'</span>}</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Total_Bsmt_SF'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Time_var'</span>,  FunctionTransformer(</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>                                 antique_func,</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'yb'</span>: <span class="st">'Year_Built'</span>, <span class="st">'yr'</span>: <span class="st">'Year_Remod/Add'</span>}</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>                                 ), [<span class="st">'Year_Built'</span>, <span class="st">'Year_Remod/Add'</span>]),</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Gr_Liv_Area / Loot_Area'</span>,  FunctionTransformer(</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Lot_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Gr_Liv_A/Loot_A'</span>}</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Gr_Liv_Area'</span>, <span class="st">'Lot_Area'</span>] ),</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'Garage_Prop_overGLA'</span>,  FunctionTransformer(</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'Garage_Area'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'Garage_Prop_overGLA'</span>}</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'Garage_Area'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'1s_Floor_prop'</span>,  FunctionTransformer(</span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>                                 div_columns,</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>                                 feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'c1'</span>: <span class="st">'1st_Flr_SF'</span>, <span class="st">'c2'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'feature_name'</span> : <span class="st">'1s_Floor_prop'</span>}</span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>                                 ),[<span class="st">'1st_Flr_SF'</span>, <span class="st">'Gr_Liv_Area'</span>] ),</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'just_select'</span>, <span class="st">'passthrough'</span>, [<span class="st">'Total_Bsmt_SF'</span>,<span class="st">'2nd_Flr_SF'</span>, <span class="st">'TotRms_AbvGrd'</span>, <span class="st">'1st_Flr_SF'</span>, <span class="st">'Year_Built'</span>, <span class="st">'Year_Remod/Add'</span>, <span class="st">'Garage_Area'</span>, <span class="st">'Lot_Area'</span>, <span class="st">'Gr_Liv_Area'</span>, <span class="st">'Mas_Vnr_Area'</span>,<span class="st">'Wood_Deck_SF'</span> ])],</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_function_transformer.py:343: UserWarning: With transform="pandas", `func` should return a DataFrame to follow the set_output API.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>feature_eng_df <span class="op">=</span> feature_eng.fit_transform(clean_ames_x_train)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>my_features <span class="op">=</span> (feature_eng_df<span class="op">&gt;&gt;</span> select (_.contains(<span class="st">'_c_'</span>))).columns.to_list()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span>[<span class="st">'Wood_Deck_SF'</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">'1st_Flr_SF'</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Open_Porch_SF'</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Enclosed_Porch'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Area'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Total_Bsmt_SF'</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Garage_Area'</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Gr_Liv_Area'</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Full_Bath'</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">'3Ssn_Porch'</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_1'</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">'BsmtFin_SF_2'</span>,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Unf_SF'</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bsmt_Half_Bath'</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Kitchen_AbvGr'</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Mas_Vnr_Area'</span>,</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Misc_Val'</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Bedroom_AbvGr'</span>]</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>preprocessor_1 <span class="op">=</span> ColumnTransformer(</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    transformers <span class="op">=</span> [</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scaler'</span>, StandardScaler(), num_cols),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'just_select'</span>, <span class="st">'passthrough'</span>, my_features ),</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'OHE'</span>, OneHotEncoder(drop<span class="op">=</span><span class="st">'first'</span>,handle_unknown<span class="op">=</span><span class="st">'infrequent_if_exist'</span> , sparse_output<span class="op">=</span><span class="va">False</span>, min_frequency <span class="op">=</span> <span class="dv">12</span>), make_column_selector(dtype_include  <span class="op">=</span> <span class="st">'object'</span>))],</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    remainder <span class="op">=</span> <span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>prep_df <span class="op">=</span> preprocessor_1.fit_transform(feature_eng_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>interactions <span class="op">=</span> ColumnTransformer(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'Garage_interaction'</span>, FunctionTransformer(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Garage_Prop_overGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Garage_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Garage_Qual|Garage_Prop_overGLA_c_'</span>)),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'inter_kitchen'</span>, FunctionTransformer(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Kitchen_AbvGr'</span>, <span class="st">'cat'</span>: <span class="st">'Kitchen_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Kitchen_Qual|Kitchen_AbvGr'</span>)),</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Last_remod_c_'</span>, FunctionTransformer(</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Gr_Liv_A/Loot_A_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Gr_Liv_A/Loot_A_c_'</span>, <span class="st">'return_inputs'</span>:<span class="st">'num'</span>}</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Gr_Liv_A/Loot_A_c_'</span>)),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'1s_Floor_prop_c_|Overall_Q'</span>, FunctionTransformer(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'1s_Floor_prop_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Overall_Q'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'1s_Floor_prop_c_|Overall_Q'</span>)),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Bsmt_Qual|Bsmt_Prop_c_'</span>, FunctionTransformer(</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Bsmt_Prop_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Bsmt_Qual'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Bsmt_Qual|Bsmt_Prop_c_'</span>)),</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Area_Per_Room_c_|Overall'</span>, FunctionTransformer(</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'2nd_Flr_SF_propGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Antique'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'2nd_Flr_SF_propGLA_c_|Antique'</span>)),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'MVNRA_propGLA_c_|Mas_Vnr_Type'</span>, FunctionTransformer(</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'MVNRA_propLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Mas_Vnr_Type'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'MVNRA_propLA_c_|Mas_Vnr_Type'</span>)),</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Wood_propGLA_c_|Fireplaces'</span>, FunctionTransformer(</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Wood_propGLA_c_'</span>, <span class="st">'cat'</span>: <span class="st">'Fireplaces'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Wood_propGLA_c_|Fireplaces'</span>)),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'Wood_propGLA_c_|Antique'</span>, FunctionTransformer(</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>                                 cross_interactions, feature_names_out <span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>                                 kw_args<span class="op">=</span>{<span class="st">'num'</span>: <span class="st">'Gr_Liv_Area'</span>, <span class="st">'cat'</span>: <span class="st">'Neighborhood'</span>, <span class="st">'return_inputs'</span>:<span class="st">'both'</span>}</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>                                 ), make_column_selector (<span class="st">'Gr_Liv_Area|Neighborhood_C|Neighborhood_[STN]'</span>)),</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'TO_DROP_'</span>, <span class="st">'drop'</span>, make_column_selector(<span class="st">'No_Basement|No_Garage|Exterior|Land|Fence'</span>)) ],</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_function_transformer.py:343: UserWarning: With transform="pandas", `func` should return a DataFrame to follow the set_output API.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>drop_cols<span class="op">=</span>[<span class="st">'2nd_Flr_SF'</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'3Ssn_Porch'</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_IDOTRR'</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_Gd'</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Alley_No_Alley_Access'</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_StoneBr_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_SF_1'</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Alley_Pave'</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_BrkSide'</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_SawyerW_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_SawyerW'</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Edwards'</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bedroom_AbvGr'</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_Fa'</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_2fmCon'</span>,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Timber_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Timber'</span>,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_NWAmes_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Somerst_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_Duplex'</span>,<span class="st">'Condition_1_infrequent_sklearn'</span>,</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_MeadowV_x_Gr_Liv_Area',</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Roof_Style_infrequent_sklearn'</span>,</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_Twnhs'</span>,</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bldg_Type_TwnhsE'</span>,</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_SF_2'</span>,</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_BLQ'</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_GLQ'</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_SWISU_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mas_Vnr_Type_None_x_MVNRA_propLA_c_'</span>,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Bsmt_Qual_Fa',</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_ClearCr'</span>,</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_LwQ'</span>,</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_Rec'</span>,</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_TA'</span>,</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'TotRms_AbvGrd',</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_1_Unf'</span>,</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_BLQ'</span>,</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_GLQ'</span>,</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_LwQ'</span>,<span class="st">'Neighborhood_CollgCr_x_Gr_Liv_Area'</span>,</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>        <span class="co"># '1st_Flr_SF',</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_None_x_MVNRA_propGLA_c_',</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_Stone_x_MVNRA_propGLA_c_',</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_Rec'</span>,</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_Mitchel_x_Gr_Liv_Area',</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_infrequent_sklearn_x_MVNRA_propGLA_c_',</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BsmtFin_Type_2_Unf'</span>,</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_TA_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Cond_Gd'</span>,</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fireplace_Qu_Po'</span>,</span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Cond_TA'</span>,</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Cond_infrequent_sklearn'</span>,</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Exposure_Mn'</span>,</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Exposure_No'</span>,</span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_PConc'</span>,</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Heating_QC_Fa',</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Functional_infrequent_sklearn',</span></span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_infrequent_sklearn',</span></span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Full_Bath'</span>,</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Half_Bath'</span>,</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Bsmt_Qual_Fa',</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Condition_1_Norm',</span></span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_Gd_x_Bsmt_Prop_c_'</span>,</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Exter_Qual_TA',</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Exter_Qual_Gd',</span></span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Exter_Qual_Fa',</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_No_Basement'</span>,</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_No_Basement_x_Bsmt_Prop_c_'</span>,</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mas_Vnr_Type_infrequent_sklearn_x_MVNRA_propLA_c_'</span>,</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Qual_TA_x_Bsmt_Prop_c_'</span>,</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Bsmt_Unf_SF'</span>,</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Neighborhood_MeadowV',</span></span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Overall_Cond_Good_or_Excellent'</span>,</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Central_Air_Y'</span>,</span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Condition_1_Feedr'</span>,</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Condition_2_infrequent_sklearn'</span>,</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Overall_Cond_Poor'</span>,</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Fireplaces'</span></span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># '1st_Flr_SF',</span></span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Functional_Typ',</span></span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Electrical_FuseF'</span>,</span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Electrical_SBrkr'</span>,</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Electrical_infrequent_sklearn'</span>,</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_infrequent_sklearn',</span></span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Mas_Vnr_Type_None',</span></span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Enclosed_Porch'</span>,</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exter_Cond_Gd'</span>,</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exter_Cond_TA'</span>,</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Fireplace_Qu_infrequent_sklearn'</span>,</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_CBlock'</span>,</span>
<span id="cb22-90"><a href="#cb22-90" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_Slab'</span>,</span>
<span id="cb22-91"><a href="#cb22-91" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Foundation_infrequent_sklearn'</span>,</span>
<span id="cb22-92"><a href="#cb22-92" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Full_Bath'</span>,</span>
<span id="cb22-93"><a href="#cb22-93" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Functional_Min2'</span>,</span>
<span id="cb22-94"><a href="#cb22-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Cars'</span>,</span>
<span id="cb22-95"><a href="#cb22-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Cond_TA'</span>,</span>
<span id="cb22-96"><a href="#cb22-96" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Cond_infrequent_sklearn'</span>,</span>
<span id="cb22-97"><a href="#cb22-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Finish_RFn'</span>,</span>
<span id="cb22-98"><a href="#cb22-98" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Finish_Unf'</span>,</span>
<span id="cb22-99"><a href="#cb22-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_No_Garage'</span>,</span>
<span id="cb22-100"><a href="#cb22-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_No_Garage_x_Garage_Prop_overGLA_c_'</span>,</span>
<span id="cb22-101"><a href="#cb22-101" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_infrequent_sklearn'</span>,</span>
<span id="cb22-102"><a href="#cb22-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_infrequent_sklearn_x_Garage_Prop_overGLA_c_'</span>,</span>
<span id="cb22-103"><a href="#cb22-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Type_BuiltIn'</span>,</span>
<span id="cb22-104"><a href="#cb22-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Type_Detchd'</span>,</span>
<span id="cb22-105"><a href="#cb22-105" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Type_infrequent_sklearn'</span>,</span>
<span id="cb22-106"><a href="#cb22-106" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Yr_Blt'</span>,</span>
<span id="cb22-107"><a href="#cb22-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Half_Bath'</span>,</span>
<span id="cb22-108"><a href="#cb22-108" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Heating_QC_Gd'</span>,</span>
<span id="cb22-109"><a href="#cb22-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Heating_QC_infrequent_sklearn'</span>,</span>
<span id="cb22-110"><a href="#cb22-110" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Heating_infrequent_sklearn'</span>,</span>
<span id="cb22-111"><a href="#cb22-111" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_1Story'</span>,</span>
<span id="cb22-112"><a href="#cb22-112" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_2Story'</span>,</span>
<span id="cb22-113"><a href="#cb22-113" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_SFoyer'</span>,</span>
<span id="cb22-114"><a href="#cb22-114" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_SLvl'</span>,</span>
<span id="cb22-115"><a href="#cb22-115" aria-hidden="true" tabindex="-1"></a>        <span class="st">'House_Style_infrequent_sklearn'</span>,</span>
<span id="cb22-116"><a href="#cb22-116" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_infrequent_sklearn'</span>,</span>
<span id="cb22-117"><a href="#cb22-117" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_infrequent_sklearn_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-118"><a href="#cb22-118" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Last_remod_c_'</span>,</span>
<span id="cb22-119"><a href="#cb22-119" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Area'</span>,</span>
<span id="cb22-120"><a href="#cb22-120" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_CulDSac'</span>,</span>
<span id="cb22-121"><a href="#cb22-121" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_FR2'</span>,</span>
<span id="cb22-122"><a href="#cb22-122" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_Inside'</span>,</span>
<span id="cb22-123"><a href="#cb22-123" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Config_infrequent_sklearn'</span>,</span>
<span id="cb22-124"><a href="#cb22-124" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Frontage'</span>,</span>
<span id="cb22-125"><a href="#cb22-125" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Shape_IR2'</span>,</span>
<span id="cb22-126"><a href="#cb22-126" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Shape_Reg'</span>,</span>
<span id="cb22-127"><a href="#cb22-127" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Lot_Shape_infrequent_sklearn'</span>,</span>
<span id="cb22-128"><a href="#cb22-128" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Low_Qual_Fin_SF'</span>,</span>
<span id="cb22-129"><a href="#cb22-129" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_SubClass'</span>,</span>
<span id="cb22-130"><a href="#cb22-130" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_Zoning_RL'</span>,</span>
<span id="cb22-131"><a href="#cb22-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_Zoning_RM'</span>,</span>
<span id="cb22-132"><a href="#cb22-132" aria-hidden="true" tabindex="-1"></a>        <span class="st">'MS_Zoning_infrequent_sklearn'</span>,</span>
<span id="cb22-133"><a href="#cb22-133" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mas_Vnr_Area'</span>,</span>
<span id="cb22-134"><a href="#cb22-134" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Misc_Feature_Shed'</span>,</span>
<span id="cb22-135"><a href="#cb22-135" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mo_Sold'</span>,</span>
<span id="cb22-136"><a href="#cb22-136" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Crawfor'</span>,</span>
<span id="cb22-137"><a href="#cb22-137" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_NoRidge'</span>,</span>
<span id="cb22-138"><a href="#cb22-138" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_NridgHt'</span>,</span>
<span id="cb22-139"><a href="#cb22-139" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_Somerst'</span>,</span>
<span id="cb22-140"><a href="#cb22-140" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Neighborhood_infrequent_sklearn'</span>,</span>
<span id="cb22-141"><a href="#cb22-141" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Open_Porch_SF'</span>,</span>
<span id="cb22-142"><a href="#cb22-142" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Overall_Qual_Poor_x_1s_Floor_prop_c_'</span>,</span>
<span id="cb22-143"><a href="#cb22-143" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Paved_Drive_P'</span>,</span>
<span id="cb22-144"><a href="#cb22-144" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Paved_Drive_Y'</span>,</span>
<span id="cb22-145"><a href="#cb22-145" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Roof_Style_Hip'</span>,</span>
<span id="cb22-146"><a href="#cb22-146" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Roof_Matl_infrequent_sklearn'</span>,</span>
<span id="cb22-147"><a href="#cb22-147" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'Functional_infrequent_sklearn',</span></span>
<span id="cb22-148"><a href="#cb22-148" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Wood_Deck_SF'</span>,</span>
<span id="cb22-149"><a href="#cb22-149" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Area'</span>,<span class="st">'Kitchen_Qual_Gd_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-150"><a href="#cb22-150" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Screen_Porch'</span>,</span>
<span id="cb22-151"><a href="#cb22-151" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Street_infrequent_sklearn'</span>,</span>
<span id="cb22-152"><a href="#cb22-152" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Total_Bsmt_SF'</span>,</span>
<span id="cb22-153"><a href="#cb22-153" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Garage_Qual_TA'</span>,</span>
<span id="cb22-154"><a href="#cb22-154" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Kitchen_Qual_Fa_x_Kitchen_AbvGr'</span>,</span>
<span id="cb22-155"><a href="#cb22-155" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Utilities_infrequent_sklearn'</span></span>
<span id="cb22-156"><a href="#cb22-156" aria-hidden="true" tabindex="-1"></a>        <span class="co">#############removing sf</span></span>
<span id="cb22-157"><a href="#cb22-157" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb22-158"><a href="#cb22-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-159"><a href="#cb22-159" aria-hidden="true" tabindex="-1"></a><span class="co">## end</span></span>
<span id="cb22-160"><a href="#cb22-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-161"><a href="#cb22-161" aria-hidden="true" tabindex="-1"></a>step_rm <span class="op">=</span>ColumnTransformer(</span>
<span id="cb22-162"><a href="#cb22-162" aria-hidden="true" tabindex="-1"></a>  [(<span class="st">'TO_DROP'</span>, <span class="st">'drop'</span>, drop_cols )],</span>
<span id="cb22-163"><a href="#cb22-163" aria-hidden="true" tabindex="-1"></a>  verbose_feature_names_out <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb22-164"><a href="#cb22-164" aria-hidden="true" tabindex="-1"></a>  remainder<span class="op">=</span><span class="st">'passthrough'</span>).set_output(transform <span class="op">=</span> <span class="st">'pandas'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>pipeline_linreg <span class="op">=</span> Pipeline([</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'clean_data'</span>, clean_and_imputers),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'feat_eng'</span>, feature_eng),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'preprocessor'</span>, preprocessor_1),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'interactions'</span>, interactions),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'remove'</span>, step_rm),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  (<span class="st">'regressor'</span>, LinearRegression())])</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Entrenar el pipeline</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>pipeline_linreg.fit(ames_x_train, ames_y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pipeline(steps=[('clean_data',
                 ColumnTransformer(remainder='passthrough',
                                   transformers=[('not_usefull_variables',
                                                  'drop',
                                                  ['Sale_Type',
                                                   'Sale_Condition', 'Pool_QC',
                                                   'Pool_Area', 'Yr_Sold']),
                                                 ('Impute_Alley',
                                                  SimpleImputer(fill_value='No_Alley_Access',
                                                                strategy='constant'),
                                                  ['Alley']),
                                                 ('Impute_Mas_Vnr_Type',
                                                  SimpleImputer(fill_value='None',
                                                                strategy='constant'),
                                                  [...
                                                   'Condition_1_infrequent_sklearn',
                                                   'Roof_Style_infrequent_sklearn',
                                                   'Bldg_Type_Twnhs',
                                                   'Bldg_Type_TwnhsE',
                                                   'BsmtFin_SF_2',
                                                   'BsmtFin_Type_1_BLQ',
                                                   'BsmtFin_Type_1_GLQ',
                                                   'Neighborhood_SWISU_x_Gr_Liv_Area',
                                                   'Mas_Vnr_Type_None_x_MVNRA_propLA_c_',
                                                   'Neighborhood_ClearCr',
                                                   'BsmtFin_Type_1_LwQ', ...])],
                                   verbose_feature_names_out=False)),
                ('regressor', LinearRegression())])</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>transformed_df <span class="op">=</span> step_rm.fit_transform(interactions.fit_transform(prep_df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">##### Extracción de coeficientes</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> pd.DataFrame({</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">'variable'</span>:transformed_df.columns.to_list(),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">'coefs'</span>: pipeline_linreg.named_steps[<span class="st">'regressor'</span>].coef_.<span class="bu">round</span>(<span class="dv">5</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(ames_y_train, sm.add_constant(transformed_df) ).fit()</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>p_vals <span class="op">=</span> (</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        model.pvalues.reset_index()</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> select( _.variable <span class="op">==</span> _.index, _.p_val <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> mutate (s <span class="op">=</span> case_when({</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>              _.p_val<span class="op">&lt;</span><span class="fl">0.025</span>:<span class="st">'***'</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>              _.p_val<span class="op">&lt;</span><span class="fl">0.05</span>:<span class="st">'**'</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>              _.p_val<span class="op">&lt;</span><span class="fl">0.1</span>:<span class="st">'*'</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>              <span class="va">True</span>:<span class="st">''</span>}))</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span> arrange (_.s,<span class="op">-</span> _.p_val)</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">&gt;&gt;</span>left_join(_, coefs, on <span class="op">=</span> <span class="st">'variable'</span>)</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_rows'</span>, <span class="dv">100</span>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>p_vals <span class="op">&gt;&gt;</span> select (_.variable,_.coefs, _.p_val,_.s) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                             variable   coefs  p_val    s
0                                        Bsmt_Qual_Fa    1.06   0.89     
1                               2nd_Flr_SF_propGLA_c_    5.55   0.81     
2                                         Antique2_c_    0.00   0.57     
3                                  Neighborhood_NAmes   -1.42   0.46     
4                                 Neighborhood_NWAmes   -2.01   0.45     
5                      Overall_Qual_Good_or_Excellent   -4.39   0.39     
6                              Garage_Prop_overGLA_c_    9.38   0.35     
7                Mas_Vnr_Type_Stone_x_MVNRA_propLA_c_ -119.98   0.30     
8                                Neighborhood_MeadowV   -4.91   0.30     
9                 Antique2_c__x_2nd_Flr_SF_propGLA_c_   -0.00   0.30     
10                               Neighborhood_OldTown   -2.80   0.25     
11                 Neighborhood_ClearCr_x_Gr_Liv_Area   -5.69   0.22     
12                                 Neighborhood_SWISU   -5.65   0.18     
13                                Neighborhood_Sawyer   -5.37   0.17     
14            Garage_Qual_TA_x_Garage_Prop_overGLA_c_   14.27   0.13     
15                                      Heating_QC_Fa   -4.99   0.12     
16                        Bsmt_Qual_Fa_x_Bsmt_Prop_c_  -20.49   0.07    *
17                 Antique_c__x_2nd_Flr_SF_propGLA_c_    0.74   0.05    *
18                                     Functional_Typ    4.82   0.05    *
19                               Neighborhood_Mitchel   -5.56   0.05    *
20                                    MVNRA_propLA_c_   47.72   0.03   **
21  Overall_Qual_Good_or_Excellent_x_1s_Floor_prop_c_   13.95   0.03   **
22                          Fireplace_Qu_No_Fireplace    6.38   0.03   **
23                               Neighborhood_SawyerW   -5.92   0.03   **
24                 Neighborhood_Crawfor_x_Gr_Liv_Area    5.98   0.03   **
25                  Neighborhood_Sawyer_x_Gr_Liv_Area   -8.87   0.03   **
26                      Exter_Cond_infrequent_sklearn  -16.10   0.02  ***
27                                    Fireplace_Qu_Gd    5.83   0.02  ***
28                                      Kitchen_AbvGr   -1.49   0.01  ***
29                       Fireplaces_x_Wood_propGLA_c_  -21.95   0.01  ***
30                                 Mas_Vnr_Type_Stone    9.77   0.01  ***
31                    Misc_Feature_infrequent_sklearn   36.92   0.01  ***
32                                    Fireplace_Qu_TA    6.50   0.01  ***
33                 Neighborhood_NoRidge_x_Gr_Liv_Area    4.76   0.01  ***
34                                   Area_Per_Room_c_ 5584.89   0.01  ***
35                                  Mas_Vnr_Type_None    4.02   0.01  ***
36                      Functional_infrequent_sklearn  -13.59   0.01  ***
37                    Mas_Vnr_Type_infrequent_sklearn  -15.68   0.00  ***
38            Gr_Liv_A/Loot_A_c__x_Gr_Liv_A/Loot_A_c_   57.50   0.00  ***
39                                       Bsmt_Qual_Gd   -6.84   0.00  ***
40                               Neighborhood_Gilbert   -8.04   0.00  ***
41                                   1s_Floor_prop_c_   72.25   0.00  ***
42                                      Heating_QC_TA   -4.12   0.00  ***
43                               Neighborhood_CollgCr   -6.50   0.00  ***
44                                        Gr_Liv_Area   10.11   0.00  ***
45                                       Bsmt_Qual_TA   -9.29   0.00  ***
46                                      TotRms_AbvGrd   -4.80   0.00  ***
47                   Neighborhood_NAmes_x_Gr_Liv_Area   -6.19   0.00  ***
48                                    Wood_propGLA_c_   28.99   0.00  ***
49                 Neighborhood_NridgHt_x_Gr_Liv_Area    8.91   0.00  ***
50                                         Antique_c_   -0.17   0.00  ***
51                                   Condition_1_Norm    6.70   0.00  ***
52                                         1st_Flr_SF  -10.93   0.00  ***
53                               Neighborhood_StoneBr   18.82   0.00  ***
54                                         Fireplaces    9.21   0.00  ***
55                                           Misc_Val   -4.39   0.00  ***
56                                              const     NaN   0.00  ***
57                                 Gr_Liv_A/Loot_A_c_  -83.99   0.00  ***
58                                  Overall_Qual_Poor  -25.06   0.00  ***
59                                         Year_Built    0.17   0.00  ***
60                                      Exter_Qual_Fa  -40.47   0.00  ***
61                                      Exter_Qual_Gd  -24.38   0.00  ***
62                                   Bsmt_Exposure_Gd   11.86   0.00  ***
63                                       Bsmt_Prop_c_   23.84   0.00  ***
64                                     Year_Remod/Add    0.27   0.00  ***
65                                      Exter_Qual_TA  -30.67   0.00  ***</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">## PREDICCIONES</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline_linreg.predict(ames_x_test) <span class="op">*</span> ames_x_test.Gr_Liv_Area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [14, 16, 40] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>y_obs <span class="op">=</span> Sale_Price_test</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">##### Métricas de desempeño</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>predictores <span class="op">=</span> transformed_df.shape[<span class="dv">1</span>]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred, y_obs, predictores )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Value
Metric             
ME         -1363.72
MAE        15202.04
MAPE           0.10
MSE    479763294.16
RMSE       21903.50
R2             0.94
R2Adj          0.91</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.DataFrame() <span class="op">&gt;&gt;</span> mutate (Sale_Price <span class="op">=</span> y_obs, Sale_Price_Pred <span class="op">=</span> y_pred)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> y_pred, y <span class="op">=</span>y_obs)) <span class="op">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    geom_point() <span class="op">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) ) <span class="op">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) ) <span class="op">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)<span class="op">+</span>theme_tufte()</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-26-25.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">&gt;&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)<span class="op">+</span>theme_tufte()</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 26'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-26-26.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">&gt;&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>) <span class="op">+</span>theme_tufte()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-26-27.png" class="img-fluid" width="614"></p>
</div>
</div>
<p>El modelo muestra una <span class="math inline">\(R^2_{adj}=0.85\)</span> con los datos de test, y tienen un error aproximado del <span class="math inline">\(\pm10\%\)</span> con respecto del precio real.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> pipeline_linreg.predict(ames_x_val)<span class="op">*</span>ames_x_val.Gr_Liv_Area</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [6, 7, 26, 32, 40] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>get_metrics(y_pred,Sale_Price_validation,<span class="bu">len</span>(transformed_df.columns ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Value
Metric             
ME         -2750.42
MAE        15593.31
MAPE           0.10
MSE    455806378.93
RMSE       21349.62
R2             0.93
R2Adj          0.90</code></pre>
</div>
</div>
<p>En cuanto al análisis de los residuos, no parece seguir completamente los supuestos, pues visualmete se puede detectar heterocedasticidad, lo cual puede afectar el preformance del modelo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>validation <span class="op">=</span> pd.DataFrame() <span class="op">&gt;&gt;</span> mutate (Sale_Price <span class="op">=</span> Sale_Price_validation, Sale_Price_Pred <span class="op">=</span> pipeline_linreg.predict(ames_x_val)<span class="op">*</span>ames_x_val.Gr_Liv_Area )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\sklearn\preprocessing\_encoders.py:202: UserWarning: Found unknown categories in columns [6, 7, 26, 32, 40] during transform. These unknown categories will be encoded as all zeros</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  validation <span class="op">&gt;&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    ggplot(aes(x <span class="op">=</span> <span class="st">"Sale_Price_Pred"</span>, y <span class="op">=</span> <span class="st">"Sale_Price"</span>)) <span class="op">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    geom_point() <span class="op">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    scale_y_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>) ) <span class="op">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    scale_x_continuous(labels <span class="op">=</span> dollar_format(digits<span class="op">=</span><span class="dv">0</span>, big_mark<span class="op">=</span><span class="st">','</span>)) <span class="op">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    geom_abline(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    coord_equal() <span class="op">+</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    labs(</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>      title <span class="op">=</span> <span class="st">"Comparación entre predicción y observación"</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> <span class="st">"Predicción"</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> <span class="st">"Observación"</span>)<span class="op">+</span>theme_tufte()</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-28-31.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>validation <span class="op">&gt;&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(x <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  geom_histogram(color <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"black"</span>) <span class="op">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  geom_vline(xintercept <span class="op">=</span> <span class="dv">0</span>, color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  scale_x_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits<span class="op">=</span><span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  ylab(<span class="st">"Conteos de clase"</span>) <span class="op">+</span> xlab(<span class="st">"Errores"</span>) <span class="op">+</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"Distribución de error"</span>)<span class="op">+</span>theme_tufte()</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;

C:\Users\HP\DOCUME~1\VIRTUA~1\CD_AMA~1\lib\site-packages\plotnine\stats\stat_bin.py:109: PlotnineWarning: 'stat_bin()' using 'bins = 23'. Pick better value with 'binwidth'.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-28-32.png" class="img-fluid" width="614"></p>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>validation <span class="op">&gt;&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  select(_.Sale_Price, _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  mutate(error <span class="op">=</span> _.Sale_Price <span class="op">-</span> _.Sale_Price_Pred) <span class="op">&gt;&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  ggplot(aes(sample <span class="op">=</span> <span class="st">"error"</span>)) <span class="op">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  geom_qq(alpha <span class="op">=</span> <span class="fl">0.3</span>) <span class="op">+</span> stat_qq_line(color <span class="op">=</span> <span class="st">"red"</span>) <span class="op">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  scale_y_continuous(labels<span class="op">=</span>dollar_format(big_mark<span class="op">=</span><span class="st">','</span>, digits <span class="op">=</span> <span class="dv">0</span>)) <span class="op">+</span> </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  xlab(<span class="st">"Distribución normal"</span>) <span class="op">+</span> ylab(<span class="st">"Distribución de errores"</span>) <span class="op">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  ggtitle(<span class="st">"QQ-Plot"</span>) <span class="op">+</span>theme_tufte()</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure Size: (640 x 480)&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="EDA_files/figure-html/unnamed-chunk-28-33.png" class="img-fluid" width="614"></p>
</div>
</div>
</section>
<section id="regresión-con-knn" class="level1">
<h1>Regresión con Knn</h1>
<section id="cross-validation-con-todas-las-variables" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation-con-todas-las-variables">Cross validation con todas las variables</h2>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>